<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Skript Block Editor</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: sans-serif;
        }

        #container {
            display: flex;
            height: 100vh;
            width: 100vw;
        }

        #blocklyArea {
            flex: 1;
            height: 100%;
            min-width: 200px;
        }

        #resizer {
            width: 5px;
            background: #ccc;
            cursor: col-resize;
            transition: background 0.2s;
        }

        #resizer:hover {
            background: #4a90e2;
        }

        #rightPanel {
            width: 450px;
            min-width: 200px;
            display: flex;
            flex-direction: column;
            background: #f9f9f9;
            border-left: 2px solid #ddd;
        }

        #toolbar {
            background: #4a90e2;
            color: white;
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
        }

        #toolbar h3 {
            margin: 0;
            font-size: 18px;
        }

        #toolbar button {
            background: white;
            color: #4a90e2;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            margin-left: 8px;
        }

        #toolbar button:hover {
            background: #e8f4ff;
        }

        #codeArea {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            min-height: 100px;
        }

        #codeHeader {
            background: #2d2d2d;
            color: #fff;
            padding: 10px 15px;
            font-size: 14px;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
        }

        #copyBtn {
            background: #5cb85c;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
        }
        /* Search menu styles */
        .searchable-dropdown {
            position: relative;
            display: inline-block;
            width: 100%;
        }

        .searchable-dropdown input {
            width: 100%;
            padding: 4px 8px;
            margin-bottom: 5px;
            border: 1px solid #ccc;
            border-radius: 3px;
            font-size: 12px;
            box-sizing: border-box;
        }

        .searchable-dropdown select {
            width: 100%;
            max-height: 200px;
            overflow-y: auto;
        }

        .searchable-dropdown option {
            padding: 4px 8px;
        }

        .searchable-dropdown .no-results {
            padding: 8px;
            color: #999;
            font-style: italic;
            text-align: center;
        }
        #copyBtn:hover {
            background: #4cae4c;
        }

        #codeContent {
            flex: 1;
            overflow: auto;
            background: #1e1e1e;
            padding: 15px;
        }

        #generatedCode {
            margin: 0;
            color: #d4d4d4;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.6;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .skript-string { color: #ce9178; }
        .skript-number { color: #b5cea8; }
        .skript-comment { color: #6a9955; }
        .skript-variable { color: #9cdcfe; }
        .skript-command { color: #569cd6; }
        .skript-function { color: #dcdcaa; }
        .skript-event { color: #c586c0; }
        .skript-object { color: #4EC9B0; }

        #stats {
            background: #f0f0f0;
            padding: 10px 15px;
            font-size: 12px;
            color: #666;
            border-top: 1px solid #ddd;
            flex-shrink: 0;
        }

        .warning {
            background: #fff3cd;
            border: 1px solid #ffc107;
            color: #856404;
            padding: 8px 12px;
            margin: 10px 15px;
            border-radius: 4px;
            font-size: 12px;
        }

        .hint-text {
            color: #666;
            font-style: italic;
            font-size: 11px;
            margin-top: 5px;
        }

        .blocklyFlyout {
            z-index: 1000;
        }
    </style>

    <script src="https://unpkg.com/blockly@10.4.3/blockly_compressed.js"></script>
    <script src="https://unpkg.com/blockly@10.4.3/msg/en.js"></script>
    <script src="https://unpkg.com/blockly@10.4.3/blocks_compressed.js"></script>
    <script src="https://unpkg.com/blockly@10.4.3/javascript_compressed.js"></script>
</head>
<body>
<div id="container">
    <div id="blocklyArea"></div>
    <div id="resizer"></div>

    <div id="rightPanel">
        <div id="toolbar">
            <h3>ðŸŽ® Skript Block Editor</h3>
            <div>
                <button id="saveBtn" title="Save blocks to file">ðŸ’¾ Save</button>
                <button id="loadBtn" title="Load blocks from file">ðŸ“‚ Load</button>
                <input type="file" id="fileInput" style="display:none" accept=".xml">
            </div>
        </div>

        <div id="warningArea"></div>

        <div id="codeArea">
            <div id="codeHeader">
                <span>ðŸ“„ Generated Skript Code</span>
                <button id="copyBtn">Copy to Clipboard</button>
            </div>
            <div id="codeContent">
                <pre id="generatedCode"># Your Skript code will appear here
# Drag an EVENT or FUNCTION block from the left to get started!</pre>
            </div>
            <div id="stats">
                <span id="blockCount">Blocks: 0</span> â€¢
                <span id="lineCount">Lines: 0</span>
            </div>
        </div>
    </div>
</div>

<xml id="toolbox" style="display: none">
    <category name="ðŸ”® Events" colour="#FFAB19">
        <block type="skript_on_join"></block>
        <block type="skript_on_rightclick"></block>
        <block type="skript_on_break"></block>
        <block type="skript_on_death"></block>
        <block type="skript_on_chat"></block>
        <block type="skript_on_inv_click"></block>
        <block type="skript_every_second"></block>
        <block type="skript_on_time"></block>
        <block type="skript_periodical"></block>
        <block type="skript_periodical_world"></block>
        <block type="skript_uncommon_events"></block>
    </category>
    <category name="ðŸŽ­ Effects" colour="#9B59B6">
        <!-- Common Effects -->
        <block type="skript_send_actionbar"></block>
        <block type="skript_send_message"></block>
        <block type="skript_broadcast"></block>
        <block type="skript_teleport"></block>
        <block type="skript_kill"></block>
        <block type="skript_give"></block>
        <block type="skript_set_variable"></block>
        <block type="skript_cancel_event"></block>
        <block type="skript_play_sound"></block>
        <block type="skript_play_effect"></block>
        <block type="skript_send_title"></block>
        <block type="skript_potion_effect"></block>
        <block type="skript_damage"></block>
        <block type="skript_heal"></block>
        <block type="skript_wait"></block>
        <block type="skript_command"></block>

        <!-- Uncommon Effects Block -->
        <block type="skript_uncommon_effects"></block>
    </category>
    <category name="âš¡ Commands" colour="#FF6B19">
        <block type="skript_on_command"></block>
        <block type="skript_if_arg"></block>
        <block type="skript_get_arg_1"></block>
        <block type="skript_get_arg_2"></block>
        <block type="skript_get_arg_3"></block>
        <block type="skript_get_arg_custom"></block>
    </category>


    <!-- Update your Conditions category in the toolbox -->
    <category name="ðŸ” Conditions" colour="#5BA55B">
        <!-- Existing common conditions -->
        <block type="skript_if_permission"></block>
        <block type="skript_if_else"></block>
        <block type="skript_if_variable_set"></block>
        <block type="skript_if_inv_name"></block>
        <block type="skript_if_slot_clicked"></block>
        <block type="skript_if_click_action"></block>

        <!-- New common conditions -->
        <block type="skript_has_permission"></block>
        <block type="skript_is_online"></block>
        <block type="skript_is_sneaking"></block>
        <block type="skript_is_flying"></block>
        <block type="skript_is_sprinting"></block>
        <block type="skript_is_swimming"></block>
        <block type="skript_is_gliding"></block>
        <block type="skript_is_sleeping"></block>
        <block type="skript_is_riding"></block>
        <block type="skript_is_burning"></block>
        <block type="skript_is_on_ground"></block>
        <block type="skript_is_in_world"></block>
        <block type="skript_is_enchanted"></block>
        <block type="skript_is_wearing"></block>
        <block type="skript_is_holding"></block>
        <block type="skript_contains"></block>
        <block type="skript_is_empty"></block>
        <block type="skript_chance"></block>

        <!-- Special block for all other conditions -->
        <block type="skript_uncommon_conditions"></block>
    </category>

    <category name="ðŸ”„ Loops" colour="#FFBF00">
        <block type="skript_loop_times"></block>
        <block type="skript_loop_players"></block>
    </category>

    <category name="ðŸ“¦ Objects" colour="#4EC9B0">
        <block type="skript_player"></block>
        <block type="skript_event_player"></block>
        <block type="skript_loop_player"></block>
        <block type="skript_clicked_slot"></block>
        <block type="skript_item"></block>
        <block type="skript_player_name"></block>
        <block type="skript_player_uuid"></block>
        <block type="skript_variable"></block>
        <block type="skript_event_world"></block>
        <block type="skript_event_entity"></block>
        <block type="skript_event_location"></block>
        <block type="skript_event_block"></block>
        <block type="skript_event_inventory"></block>
        <block type="skript_event_item"></block>
        <block type="skript_attacker"></block>
        <block type="skript_attacked"></block>
        <block type="skript_shooter"></block>
        <block type="skript_console"></block>
        <block type="skript_drops"></block>
        <block type="skript_command_sender"></block>
        <block type="skript_attribute_type"></block>
        <block type="skript_banner_pattern_type"></block>
        <block type="skript_damage_cause"></block>
        <block type="skript_enchantment_type"></block>
        <block type="skript_potion_effect_type"></block>
        <block type="skript_sound_category"></block>
        <block type="skript_entity_type"></block>
        <block type="skript_visual_effect"></block>
        <block type="skript_firework_effect"></block>
        <block type="skript_inventory_type"></block>
        <block type="skript_uncommon_objects"></block>
    </category>

    <category name="ðŸ”¢ Values" colour="#59C059">
        <block type="skript_text"></block>
        <block type="skript_number"></block>
        <block type="skript_math_op"></block>
        <block type="skript_compare"></block>
        <block type="skript_string_concat"></block>
        <block type="skript_round_up"></block>
        <block type="skript_any_of"></block>
        <block type="skript_default_value"></block>
        <block type="skript_ternary"></block>
        <block type="skript_uncommon_values"></block>
    </category>

    <category name="ðŸ“œ Functions" colour="#9A5CA6">
        <block type="skript_function"></block>
        <block type="skript_return"></block>
        <block type="skript_call_function"></block>
        <!-- Math Functions -->
        <block type="skript_function_abs"></block>
        <block type="skript_function_ceil"></block>
        <block type="skript_function_floor"></block>
        <block type="skript_function_round"></block>
        <block type="skript_function_sqrt"></block>
        <block type="skript_function_sin"></block>
        <block type="skript_function_cos"></block>
        <block type="skript_function_tan"></block>
        <block type="skript_function_min"></block>
        <block type="skript_function_max"></block>
        <block type="skript_function_sum"></block>
        <block type="skript_function_mod"></block>

        <!-- Utility Functions -->
        <block type="skript_function_location"></block>
        <block type="skript_function_vector"></block>
        <block type="skript_function_world"></block>
        <block type="skript_function_player"></block>
        <block type="skript_function_offlineplayer"></block>
        <block type="skript_function_uuid"></block>
        <block type="skript_function_rgb"></block>

        <!-- Advanced Math -->
        <block type="skript_function_factorial"></block>
        <block type="skript_function_mean"></block>
        <block type="skript_function_median"></block>
        <block type="skript_function_clamp"></block>
    </category>
    <!-- Add this new category to your toolbox -->
    <category name="ðŸ”— Sections" colour="#FF6B6B">
        <block type="skript_section_catch_errors"></block>
        <block type="skript_section_filter"></block>
        <block type="skript_section_foreach"></block>
        <block type="skript_section_while"></block>
        <block type="skript_section_dowhile"></block>
        <block type="skript_section_spawn"></block>
        <block type="skript_section_shoot"></block>
        <block type="skript_section_parse_if"></block>
        <block type="skript_section_else_parse_if"></block>
    </category>
    <!-- Add this new category to your toolbox -->
    <category name="ðŸ—ï¸ Structures" colour="#8B4513">
        <block type="skript_structure_options"></block>
        <block type="skript_structure_variables"></block>
        <block type="skript_structure_aliases"></block>
        <block type="skript_structure_auto_reload"></block>
        <block type="skript_structure_experimental"></block>
        <block type="skript_structure_command_enhanced"></block>
        <block type="skript_structure_event_enhanced"></block>
        <block type="skript_structure_function_enhanced"></block>
    </category>
</xml>

<script>
    // ========================================
    // RESIZABLE PANEL
    // ========================================

    (function() {
        var resizer = document.getElementById('resizer');
        var rightPanel = document.getElementById('rightPanel');
        var isResizing = false;

        resizer.addEventListener('mousedown', function(e) {
            isResizing = true;
            document.body.style.cursor = 'col-resize';
            document.body.style.userSelect = 'none';
        });

        document.addEventListener('mousemove', function(e) {
            if (!isResizing) return;

            var containerWidth = document.getElementById('container').offsetWidth;
            var newWidth = containerWidth - e.clientX;

            if (newWidth > 200 && newWidth < containerWidth - 200) {
                rightPanel.style.width = newWidth + 'px';
                Blockly.svgResize(workspace);
            }
        });

        document.addEventListener('mouseup', function() {
            isResizing = false;
            document.body.style.cursor = '';
            document.body.style.userSelect = '';
        });
    })();
    // ========================================
    // NEW OBJECT BLOCKS
    // ========================================
    // ========================================
    // NEW SKRIPT HUB SECTION BLOCKS
    // ========================================

    // CATCH ERRORS SECTION
    Blockly.Blocks['skript_section_catch_errors'] = {
        init: function() {
            this.setColour("#FF6B6B");
            this.appendDummyInput()
                .appendField("catch runtime errors:");
            this.appendStatementInput("DO")
                .setCheck(null);
            this.setTooltip("Catches any runtime errors produced by code within this section");
        }
    };
    // ========================================
    // NEW SKRIPT HUB STRUCTURE BLOCKS
    // ========================================

    // OPTIONS STRUCTURE
    Blockly.Blocks['skript_structure_options'] = {
        init: function() {
            this.setColour("#8B4513");
            this.appendDummyInput()
                .appendField("options:");
            this.appendStatementInput("OPTIONS")
                .setCheck(null);
            this.setTooltip("Define script options for text replacement");
        }
    };

    // VARIABLES STRUCTURE
    Blockly.Blocks['skript_structure_variables'] = {
        init: function() {
            this.setColour("#8B4513");
            this.appendDummyInput()
                .appendField("variables:");
            this.appendStatementInput("VARIABLES")
                .setCheck(null);
            this.setTooltip("Define default variables for the script");
        }
    };

    // ALIASES STRUCTURE
    Blockly.Blocks['skript_structure_aliases'] = {
        init: function() {
            this.setColour("#8B4513");
            this.appendDummyInput()
                .appendField("aliases:");
            this.appendStatementInput("ALIASES")
                .setCheck(null);
            this.setTooltip("Register custom item aliases");
        }
    };

    // AUTO RELOAD STRUCTURE
    Blockly.Blocks['skript_structure_auto_reload'] = {
        init: function() {
            this.setColour("#8B4513");
            this.appendDummyInput()
                .appendField("auto reload:");

            // Recipients input
            this.appendDummyInput("RECIPIENTS")
                .appendField("recipients:")
                .appendField(new Blockly.FieldTextInput("console"), "RECIPIENTS_VALUE");

            // Permission input
            this.appendDummyInput("PERMISSION")
                .appendField("permission:")
                .appendField(new Blockly.FieldTextInput(""), "PERMISSION_VALUE");

            this.setTooltip("Enable automatic script reloading with configuration");
        }
    };

    // USING EXPERIMENTAL FEATURE STRUCTURE
    Blockly.Blocks['skript_structure_experimental'] = {
        init: function() {
            this.setColour("#8B4513");
            this.appendDummyInput()
                .appendField("using experimental feature");
            this.appendDummyInput()
                .appendField(new Blockly.FieldDropdown([
                    ["entity data", "entity_data"],
                    ["async effects", "async_effects"],
                    ["parallel events", "parallel_events"],
                    ["custom events", "custom_events"],
                    ["advanced math", "advanced_math"],
                    ["enhanced loops", "enhanced_loops"]
                ]), "FEATURE");
            this.setTooltip("Enable experimental Skript features");
        }
    };

    // ENHANCED COMMAND STRUCTURE (with more options)
    Blockly.Blocks['skript_structure_command_enhanced'] = {
        init: function() {
            this.setColour("#8B4513");

            // Command name
            this.appendDummyInput("COMMAND_NAME")
                .appendField("command /")
                .appendField(new Blockly.FieldTextInput("mycommand"), "CMD");

            // Usage
            this.appendDummyInput("USAGE")
                .appendField("usage:")
                .appendField(new Blockly.FieldTextInput(""), "USAGE_VALUE");

            // Description
            this.appendDummyInput("DESCRIPTION")
                .appendField("description:")
                .appendField(new Blockly.FieldTextInput(""), "DESCRIPTION_VALUE");

            // Permission
            this.appendDummyInput("PERMISSION")
                .appendField("permission:")
                .appendField(new Blockly.FieldTextInput(""), "PERM_VALUE");

            // Permission message
            this.appendDummyInput("PERMISSION_MESSAGE")
                .appendField("permission message:")
                .appendField(new Blockly.FieldTextInput(""), "PERM_MESSAGE_VALUE");

            // Aliases
            this.appendDummyInput("ALIASES")
                .appendField("aliases:")
                .appendField(new Blockly.FieldTextInput(""), "ALIASES_VALUE");

            // Executable by
            this.appendDummyInput("EXECUTABLE_BY")
                .appendField("executable by:")
                .appendField(new Blockly.FieldDropdown([
                    ["players", "players"],
                    ["console", "console"],
                    ["both", "console and players"]
                ]), "EXECUTABLE_BY_VALUE");

            // Cooldown
            this.appendDummyInput("COOLDOWN")
                .appendField("cooldown:")
                .appendField(new Blockly.FieldTextInput(""), "COOLDOWN_VALUE");

            // Cooldown message
            this.appendDummyInput("COOLDOWN_MESSAGE")
                .appendField("cooldown message:")
                .appendField(new Blockly.FieldTextInput(""), "COOLDOWN_MESSAGE_VALUE");

            // Trigger section
            this.appendDummyInput("TRIGGER")
                .appendField("trigger:");
            this.appendStatementInput("DO")
                .setCheck(null);

            this.setTooltip("Enhanced command structure with all options");
        }
    };

    // ENHANCED EVENT STRUCTURE (with priority)
    Blockly.Blocks['skript_structure_event_enhanced'] = {
        init: function() {
            this.setColour("#8B4513");
            this.appendDummyInput()
                .appendField("on")
                .appendField(new Blockly.FieldDropdown([
                    ["any", "any"],
                    ["uncancelled", "uncancelled"],
                    ["cancelled", "cancelled"]
                ]), "EVENT_STATE");

            this.appendDummyInput()
                .appendField(new SearchableDropdown([
                    ["join", "join"],
                    ["quit", "quit"],
                    ["chat", "chat"],
                    ["break", "break"],
                    ["place", "place"],
                    ["click", "click"],
                    ["right click", "right click"],
                    ["death", "death"],
                    ["respawn", "respawn"],
                    ["damage", "damage"],
                    ["shoot", "shoot"],
                    ["inventory click", "inventory click"],
                    ["command", "command"],
                    ["move", "move"],
                    ["teleport", "teleport"],
                    ["world change", "world change"]
                ]), "EVENT_TYPE");

            this.appendDummyInput()
                .appendField("with priority")
                .appendField(new Blockly.FieldDropdown([
                    ["lowest", "lowest"],
                    ["low", "low"],
                    ["normal", "normal"],
                    ["high", "high"],
                    ["highest", "highest"],
                    ["monitor", "monitor"]
                ]), "PRIORITY");

            this.appendStatementInput("DO")
                .setCheck(null);

            this.setTooltip("Event structure with cancellation state and priority");
        }
    };

    // ENHANCED FUNCTION STRUCTURE (with local option)
    Blockly.Blocks['skript_structure_function_enhanced'] = {
        init: function() {
            this.setColour("#8B4513");

            // Local/global option
            this.appendDummyInput("FUNCTION_SCOPE")
                .appendField(new Blockly.FieldDropdown([
                    ["function", "function"],
                    ["local function", "local function"]
                ]), "SCOPE");

            // Function name and parameters
            this.appendDummyInput("FUNCTION_NAME")
                .appendField(new Blockly.FieldTextInput("myFunction"), "NAME")
                .appendField("(");

            // Hint for right-click
            var hintInput = this.appendDummyInput("HINT");
            hintInput.appendField(new Blockly.FieldLabel("Right-click to add/remove args"), "HINT_TEXT");

            // Arguments container - starts empty
            this.argCount_ = 0;
            this.arguments_ = [];

            // Close parenthesis and return type
            this.appendDummyInput("RETURN_TYPE")
                .appendField(") returns ")
                .appendField(new Blockly.FieldDropdown([
                    ["text", "text"],
                    ["number", "number"],
                    ["boolean", "boolean"],
                    ["player", "player"],
                    ["location", "location"],
                    ["item", "item"],
                    ["none", "none"]
                ]), "RETURN")
                .appendField(":");

            // Function body
            this.appendStatementInput("DO")
                .setCheck(null);

            this.setTooltip("Enhanced function structure with local/global scope");

            // Add context menu for arguments
            this.customContextMenu = function(options) {
                var addOption = {
                    text: "âž• Add Argument",
                    enabled: true,
                    callback: function() {
                        this.addArgument();
                    }.bind(this)
                };
                options.push(addOption);

                if (this.argCount_ > 0) {
                    var removeOption = {
                        text: "âž– Remove Argument",
                        enabled: true,
                        callback: function() {
                            this.removeArgument();
                        }.bind(this)
                    };
                    options.push(removeOption);
                }
            };
        },

        addArgument: function() {
            var index = this.argCount_;
            var argInput = this.appendDummyInput("ARG_" + index)
                .appendField(index === 0 ? "" : ", ")
                .appendField(new Blockly.FieldTextInput("arg" + (index + 1)), "ARG_NAME_" + index)
                .appendField(": ")
                .appendField(new Blockly.FieldDropdown([
                    ["text", "text"],
                    ["number", "number"],
                    ["boolean", "boolean"],
                    ["player", "player"],
                    ["location", "location"],
                    ["item", "item"]
                ]), "ARG_TYPE_" + index);

            this.arguments_.push(index);
            this.argCount_++;

            this.moveInputBefore("ARG_" + index, "RETURN_TYPE");

            if (this.workspace) {
                this.workspace.resize();
            }
        },

        removeArgument: function() {
            if (this.argCount_ > 0) {
                var index = this.argCount_ - 1;
                this.removeInput("ARG_" + index);
                this.arguments_.pop();
                this.argCount_--;

                if (this.workspace) {
                    this.workspace.resize();
                }
            }
        },

        mutationToDom: function() {
            var container = document.createElement('mutation');
            container.setAttribute('args', this.argCount_);
            for (var i = 0; i < this.argCount_; i++) {
                var argName = this.getFieldValue('ARG_NAME_' + i);
                var argType = this.getFieldValue('ARG_TYPE_' + i);
                container.setAttribute('arg_name_' + i, argName);
                container.setAttribute('arg_type_' + i, argType);
            }
            return container;
        },

        domToMutation: function(xmlElement) {
            var argCount = parseInt(xmlElement.getAttribute('args'), 10) || 0;

            while (this.argCount_ > 0) {
                this.removeArgument();
            }

            for (var i = 0; i < argCount; i++) {
                this.addArgument();
                var savedName = xmlElement.getAttribute('arg_name_' + i);
                var savedType = xmlElement.getAttribute('arg_type_' + i);
                if (savedName) {
                    this.setFieldValue(savedName, 'ARG_NAME_' + i);
                }
                if (savedType) {
                    this.setFieldValue(savedType, 'ARG_TYPE_' + i);
                }
            }
        }
    };
    // FILTER SECTION
    Blockly.Blocks['skript_section_filter'] = {
        init: function() {
            this.setColour("#FF6B6B");
            this.appendValueInput("LIST")
                .setCheck(null)
                .appendField("filter");
            this.appendDummyInput()
                .appendField("to match")
                .appendField(new Blockly.FieldDropdown([
                    ["any", "any"],
                    ["all", "all"]
                ]), "MATCH_TYPE");
            this.appendStatementInput("CONDITIONS")
                .setCheck(null);
            this.setTooltip("Filters a list based on conditions");
        }
    };

    // FOR EACH LOOP SECTION
    Blockly.Blocks['skript_section_foreach'] = {
        init: function() {
            this.setColour("#FFBF00");
            this.appendDummyInput()
                .appendField("for each");
            this.appendDummyInput()
                .appendField(new Blockly.FieldDropdown([
                    ["value", "value"],
                    ["key", "key"],
                    ["key and value", "key_value"]
                ]), "LOOP_TYPE");
            this.appendValueInput("VARIABLE")
                .setCheck(null);
            this.appendDummyInput()
                .appendField("in");
            this.appendValueInput("LIST")
                .setCheck(null);
            this.appendStatementInput("DO")
                .setCheck(null);
            this.setTooltip("Loop through each element in a list with key/value access");
        }
    };

    // WHILE LOOP SECTION
    Blockly.Blocks['skript_section_while'] = {
        init: function() {
            this.setColour("#FFBF00");
            this.appendValueInput("CONDITION")
                .setCheck("Boolean")
                .appendField("while");
            this.appendStatementInput("DO")
                .setCheck(null);
            this.setTooltip("Repeat code while condition is true");
        }
    };

    // DO WHILE LOOP SECTION
    Blockly.Blocks['skript_section_dowhile'] = {
        init: function() {
            this.setColour("#FFBF00");
            this.appendDummyInput()
                .appendField("do:");
            this.appendStatementInput("DO")
                .setCheck(null);
            this.appendDummyInput()
                .appendField("while");
            this.appendValueInput("CONDITION")
                .setCheck("Boolean");
            this.setTooltip("Execute code once, then repeat while condition is true");
        }
    };

    // SPAWN SECTION
    Blockly.Blocks['skript_section_spawn'] = {
        init: function() {
            this.setColour("#FF6B6B");
            this.appendValueInput("ENTITY_TYPE")
                .setCheck("String")
                .appendField("spawn");
            this.appendValueInput("AMOUNT")
                .setCheck("Number")
                .appendField("of");
            this.appendValueInput("LOCATION")
                .setCheck("String")
                .appendField("at");
            this.appendStatementInput("DO")
                .setCheck(null);
            this.setTooltip("Spawn entities with custom configuration");
        }
    };

    // SHOOT SECTION
    Blockly.Blocks['skript_section_shoot'] = {
        init: function() {
            this.setColour("#FF6B6B");
            this.appendValueInput("PROJECTILE")
                .setCheck("String")
                .appendField("shoot");
            this.appendValueInput("FROM")
                .setCheck("String")
                .appendField("from");
            this.appendValueInput("SPEED")
                .setCheck("Number")
                .appendField("with speed");
            this.appendValueInput("DIRECTION")
                .setCheck("String")
                .appendField("in direction");
            this.appendStatementInput("DO")
                .setCheck(null);
            this.setTooltip("Shoot projectiles with custom configuration");
        }
    };

    // CONDITIONAL PARSE SECTION
    Blockly.Blocks['skript_section_parse_if'] = {
        init: function() {
            this.setColour("#5BA55B");
            this.appendValueInput("CONDITION")
                .setCheck("Boolean")
                .appendField("parse if");
            this.appendStatementInput("THEN")
                .setCheck(null);
            this.setTooltip("Condition that only parses code if condition is true");
        }
    };

    // ELSE PARSE IF SECTION
    Blockly.Blocks['skript_section_else_parse_if'] = {
        init: function() {
            this.setColour("#5BA55B");
            this.appendValueInput("CONDITION")
                .setCheck("Boolean")
                .appendField("else parse if");
            this.appendStatementInput("THEN")
                .setCheck(null);
            this.setTooltip("Else if that only parses code if condition is true");
        }
    };
    Blockly.Blocks['skript_attacker'] = {
        init: function() {
            this.setColour("#4EC9B0");
            this.appendDummyInput()
                .appendField("attacker");
            this.setOutput(true, "String");
            this.setTooltip("The entity that attacked in a damage event");
        }
    };

    Blockly.Blocks['skript_attacked'] = {
        init: function() {
            this.setColour("#4EC9B0");
            this.appendDummyInput()
                .appendField("attacked");
            this.setOutput(true, "String");
            this.setTooltip("The entity that was attacked in a damage event");
        }
    };

    Blockly.Blocks['skript_shooter'] = {
        init: function() {
            this.setColour("#4EC9B0");
            this.appendDummyInput()
                .appendField("shooter");
            this.setOutput(true, "String");
            this.setTooltip("The shooter of a projectile");
        }
    };

    Blockly.Blocks['skript_console'] = {
        init: function() {
            this.setColour("#4EC9B0");
            this.appendDummyInput()
                .appendField("console");
            this.setOutput(true, "String");
            this.setTooltip("The server console");
        }
    };

    Blockly.Blocks['skript_drops'] = {
        init: function() {
            this.setColour("#4EC9B0");
            this.appendDummyInput()
                .appendField("drops");
            this.setOutput(true, "String");
            this.setTooltip("The drops in death and harvest events");
        }
    };

    Blockly.Blocks['skript_command_sender'] = {
        init: function() {
            this.setColour("#4EC9B0");
            this.appendDummyInput()
                .appendField("command sender");
            this.setOutput(true, "String");
            this.setTooltip("The sender of a command");
        }
    };

    // UNCOMMON OBJECTS BLOCK
    // UNCOMMON OBJECTS BLOCK WITH DYNAMIC INPUTS
    Blockly.Blocks['skript_uncommon_objects'] = {
        init: function() {
            this.setColour("#4EC9B0");

            this.appendDummyInput()
                .appendField(new SearchableDropdown([
                    // Entity expressions
                    ["absorbed blocks", "absorbed blocks"],
                    ["active item", "active item"],
                    ["active item use time", "active item use time"],
                    ["affected entities", "affected entities"],
                    ["age of block/entity", "age of block/entity"],
                    ["allay duplication cooldown", "allay duplication cooldown"],
                    ["allay target jukebox", "allay target jukebox"],
                    ["armor change item", "armor change item"],
                    ["armor slot", "armor slot"],
                    ["arrow attached block", "arrow attached block"],
                    ["arrow knockback strength", "arrow knockback strength"],
                    ["arrows stuck", "arrows stuck"],
                    ["attack cooldown", "attack cooldown"],
                    ["beehive honey level", "beehive honey level"],
                    ["beehive target flower", "beehive target flower"],
                    ["breeding family", "breeding family"],
                    ["buried item", "buried item"],
                    ["damage", "damage"],
                    ["damage cause", "damage cause"],
                    ["damage source", "damage source"],
                    ["enderman carrying blockdata", "enderman carrying blockdata"],
                    ["entity ai", "entity ai"],
                    ["entity attribute", "entity attribute"],
                    ["entity fire burn duration", "entity fire burn duration"],
                    ["entity owner", "entity owner"],
                    ["entity size", "entity size"],
                    ["entity snapshot", "entity snapshot"],
                    ["entity sound", "entity sound"],
                    ["entity storage entity count", "entity storage entity count"],
                    ["exact item", "exact item"],
                    ["fall distance", "fall distance"],
                    ["freeze time", "freeze time"],
                    ["gliding state", "gliding state"],
                    ["glowing", "glowing"],
                    ["gravity", "gravity"],
                    ["hatching entity type", "hatching entity type"],
                    ["hatching number", "hatching number"],
                    ["heal amount", "heal amount"],
                    ["heal reason", "heal reason"],
                    ["health", "health"],
                    ["horse domestication", "horse domestication"],
                    ["last attacker", "last attacker"],
                    ["last damage", "last damage"],
                    ["last damage cause", "last damage cause"],
                    ["leash holder", "leash holder"],
                    ["love time", "love time"],
                    ["max health", "max health"],
                    ["no damage ticks", "no damage ticks"],
                    ["no damage time", "no damage time"],
                    ["panda gene", "panda gene"],
                    ["passenger", "passenger"],
                    ["pickup delay", "pickup delay"],
                    ["portal cooldown", "portal cooldown"],
                    ["remaining air", "remaining air"],
                    ["spawn reason", "spawn reason"],
                    ["spectator target", "spectator target"],
                    ["speed", "speed"],
                    ["target", "target"],
                    ["time lived of entity", "time lived of entity"],
                    ["tool", "tool"],
                    ["total experience", "total experience"],
                    ["transform reason", "transform reason"],
                    ["vehicle", "vehicle"],
                    ["villager level/experience", "villager level/experience"],
                    ["villager profession", "villager profession"],
                    ["villager type", "villager type"],
                    ["warden anger level", "warden anger level"],
                    ["warden most angered at", "warden most angered at"],

                    // Block expressions
                    ["block break speed", "block break speed"],
                    ["block data", "block data"],
                    ["block hardness", "block hardness"],
                    ["block sound", "block sound"],
                    ["brewing stand fuel level", "brewing stand fuel level"],
                    ["brewing time", "brewing time"],
                    ["burn/cook time", "burn/cook time"],
                    ["dusted stage", "dusted stage"],
                    ["explosion block yield", "explosion block yield"],
                    ["explosion yield", "explosion yield"],
                    ["explosive yield", "explosive yield"],
                    ["fertilized blocks", "fertilized blocks"],
                    ["furnace times", "furnace times"],
                    ["light level", "light level"],
                    ["redstone block power", "redstone block power"],
                    ["resonating time", "resonating time"],
                    ["respawn anchor charges", "respawn anchor charges"],
                    ["ringing time", "ringing time"],
                    ["sea pickles", "sea pickles"],
                    ["sign text", "sign text"],
                    ["spawner type", "spawner type"],
                    ["targeted block", "targeted block"],

                    // Player expressions
                    ["all banned players/ips", "all banned players/ips"],
                    ["all operators", "all operators"],
                    ["all permissions", "all permissions"],
                    ["bed", "bed"],
                    ["compass target", "compass target"],
                    ["ender chest", "ender chest"],
                    ["exhaustion", "exhaustion"],
                    ["flight mode", "flight mode"],
                    ["food level", "food level"],
                    ["game mode", "game mode"],
                    ["group", "group"],
                    ["hidden players", "hidden players"],
                    ["hotbar slot", "hotbar slot"],
                    ["last death location", "last death location"],
                    ["last resource pack response", "last resource pack response"],
                    ["level", "level"],
                    ["level progress", "level progress"],
                    ["money", "money"],
                    ["offline players", "offline players"],
                    ["ping", "ping"],
                    ["player chat completions", "player chat completions"],
                    ["player input keys", "player input keys"],
                    ["player list header and footer", "player list header and footer"],
                    ["player protocol version", "player protocol version"],
                    ["player skull", "player skull"],
                    ["player weather", "player weather"],
                    ["respawn location", "respawn location"],
                    ["saturation", "saturation"],
                    ["scoreboard tags", "scoreboard tags"],
                    ["tab list name", "tab list name"],
                    ["tablisted players", "tablisted players"],
                    ["time played", "time played"],
                    ["view distance", "view distance"],
                    ["view distance of client", "view distance of client"],

                    // World expressions
                    ["biome", "biome"],
                    ["difficulty", "difficulty"],
                    ["gamerule value", "gamerule value"],
                    ["moon phase", "moon phase"],
                    ["sea level", "sea level"],
                    ["spawn", "spawn"],
                    ["time", "time"],
                    ["weather", "weather"],
                    ["world border", "world border"],
                    ["world environment", "world environment"],
                    ["world seed", "world seed"],
                    ["worlds", "worlds"],

                    // Item expressions
                    ["amount", "amount"],
                    ["amount of items", "amount of items"],
                    ["anvil repair cost", "anvil repair cost"],
                    ["anvil text input", "anvil text input"],
                    ["applied beacon effect", "applied beacon effect"],
                    ["applied enchantments", "applied enchantments"],
                    ["banner pattern", "banner pattern"],
                    ["banner pattern item", "banner pattern item"],
                    ["banner patterns", "banner patterns"],
                    ["barter drops", "barter drops"],
                    ["barter input", "barter input"],
                    ["beacon effects", "beacon effects"],
                    ["beacon range", "beacon range"],
                    ["beacon tier", "beacon tier"],
                    ["book author", "book author"],
                    ["book pages", "book pages"],
                    ["book title", "book title"],
                    ["brewing results", "brewing results"],
                    ["color of", "color of"],
                    ["consumed item", "consumed item"],
                    ["cursor slot", "cursor slot"],
                    ["custom model data", "custom model data"],
                    ["damage value/durability", "damage value/durability"],
                    ["damaged item", "damaged item"],
                    ["enchant item", "enchant item"],
                    ["enchanting experience cost", "enchanting experience cost"],
                    ["enchantment bonus", "enchantment bonus"],
                    ["enchantment level", "enchantment level"],
                    ["enchantment offer", "enchantment offer"],
                    ["enchantment offer cost", "enchantment offer cost"],
                    ["first empty slot in inventory", "first empty slot in inventory"],
                    ["fishing approach angle", "fishing approach angle"],
                    ["fishing bite time", "fishing bite time"],
                    ["fishing hook", "fishing hook"],
                    ["fishing hooked entity", "fishing hooked entity"],
                    ["fishing wait time", "fishing wait time"],
                    ["furnace event items", "furnace event items"],
                    ["item amount", "item amount"],
                    ["item cooldown", "item cooldown"],
                    ["item enchantments", "item enchantments"],
                    ["item flags", "item flags"],
                    ["item of an entity", "item of an entity"],
                    ["items in", "items in"],
                    ["lore", "lore"],
                    ["max durability", "max durability"],
                    ["max item use time", "max item use time"],
                    ["maximum stack size", "maximum stack size"],
                    ["mending repair amount", "mending repair amount"],
                    ["plain item", "plain item"],
                    ["potion effect", "potion effect"],
                    ["potion effect tier", "potion effect tier"],
                    ["potion effects", "potion effects"],
                    ["readied arrow/bow", "readied arrow/bow"],
                    ["skull owner", "skull owner"],
                    ["spawn egg entity", "spawn egg entity"],
                    ["unbreakable items", "unbreakable items"],
                    ["with fire resistance", "with fire resistance"],

                    // Location expressions
                    ["altitude", "altitude"],
                    ["center of world border", "center of world border"],
                    ["chunk", "chunk"],
                    ["coordinate", "coordinate"],
                    ["distance", "distance"],
                    ["head location", "head location"],
                    ["highest solid block", "highest solid block"],
                    ["location", "location"],
                    ["lowest/highest solid block", "lowest/highest solid block"],
                    ["middle of location", "middle of location"],
                    ["midpoint", "midpoint"],
                    ["targeted block", "targeted block"],
                    ["yaw / pitch", "yaw / pitch"],

                    // List expressions
                    ["all commands", "all commands"],
                    ["all groups", "all groups"],
                    ["all scripts", "all scripts"],
                    ["all tags of a type", "all tags of a type"],
                    ["block sphere", "block sphere"],
                    ["blocks", "blocks"],
                    ["blocks in region", "blocks in region"],
                    ["elements", "elements"],
                    ["entities", "entities"],
                    ["except", "except"],
                    ["exploded blocks", "exploded blocks"],
                    ["filter", "filter"],
                    ["items", "items"],
                    ["moved blocks", "moved blocks"],
                    ["nearest entity", "nearest entity"],
                    ["numbers", "numbers"],
                    ["online player count", "online player count"],
                    ["portal", "portal"],
                    ["region", "region"],
                    ["region members & owners", "region members & owners"],
                    ["regions at", "regions at"],
                    ["sets", "sets"],
                    ["source block", "source block"],
                    ["whitelist", "whitelist"],
                    ["x times", "x times"]
                ]), "OBJECT_TYPE");

            this.setOutput(true, "String");
            this.setTooltip("Select from various uncommon Skript objects");

            // Initialize with no additional inputs
            this.updateShape_();

            // Update inputs when object type changes
            this.setOnChange(function(changeEvent) {
                if (changeEvent.type === Blockly.Events.BLOCK_CHANGE &&
                    changeEvent.element === 'field' &&
                    changeEvent.name === 'OBJECT_TYPE') {
                    this.updateShape_();
                }
            }.bind(this));
        },

        updateShape_: function() {
            var objectType = this.getFieldValue('OBJECT_TYPE');

            // Remove all inputs except the first one (OBJECT_TYPE)
            while (this.inputList.length > 1) {
                this.removeInput(this.inputList[this.inputList.length - 1].name);
            }

            // Add appropriate inputs based on object type
            switch(objectType) {
                // Entity inputs
                case "age of block/entity":
                case "allay duplication cooldown":
                case "allay target jukebox":
                case "armor change item":
                case "armor slot":
                case "arrow knockback strength":
                case "arrows stuck":
                case "attack cooldown":
                case "beehive honey level":
                case "beehive target flower":
                case "entity ai":
                case "entity attribute":
                case "entity fire burn duration":
                case "entity owner":
                case "entity size":
                case "entity snapshot":
                case "entity sound":
                case "fall distance":
                case "freeze time":
                case "gliding state":
                case "glowing":
                case "gravity":
                case "health":
                case "horse domestication":
                case "last attacker":
                case "last damage":
                case "last damage cause":
                case "leash holder":
                case "love time":
                case "max health":
                case "no damage ticks":
                case "no damage time":
                case "panda gene":
                case "pickup delay":
                case "portal cooldown":
                case "remaining air":
                case "speed":
                case "target":
                case "time lived of entity":
                case "tool":
                case "total experience":
                case "vehicle":
                case "villager level/experience":
                case "villager profession":
                case "villager type":
                case "warden anger level":
                case "warden most angered at":
                    this.appendValueInput("ENTITY")
                        .setCheck("String")
                        .appendField("entity:");
                    break;

                // Player inputs
                case "bed":
                case "compass target":
                case "ender chest":
                case "exhaustion":
                case "flight mode":
                case "food level":
                case "game mode":
                case "group":
                case "hidden players":
                case "hotbar slot":
                case "last death location":
                case "last resource pack response":
                case "level":
                case "level progress":
                case "money":
                case "ping":
                case "player chat completions":
                case "player input keys":
                case "player list header and footer":
                case "player protocol version":
                case "player skull":
                case "player weather":
                case "respawn location":
                case "saturation":
                case "scoreboard tags":
                case "tab list name":
                case "tablisted players":
                case "time played":
                case "view distance":
                case "view distance of client":
                    this.appendValueInput("PLAYER")
                        .setCheck("String")
                        .appendField("player:");
                    break;

                // Block inputs
                case "block break speed":
                case "block data":
                case "block hardness":
                case "block sound":
                case "brewing stand fuel level":
                case "brewing time":
                case "burn/cook time":
                case "dusted stage":
                case "fertilized blocks":
                case "furnace times":
                case "light level":
                case "redstone block power":
                case "resonating time":
                case "respawn anchor charges":
                case "ringing time":
                case "sea pickles":
                case "sign text":
                case "spawner type":
                case "targeted block":
                    this.appendValueInput("BLOCK")
                        .setCheck("String")
                        .appendField("block:");
                    break;

                // World inputs
                case "biome":
                case "difficulty":
                case "gamerule value":
                case "moon phase":
                case "sea level":
                case "spawn":
                case "time":
                case "weather":
                case "world border":
                case "world environment":
                case "world seed":
                    this.appendValueInput("WORLD")
                        .setCheck("String")
                        .appendField("world:");
                    break;

                // Item inputs
                case "amount":
                case "amount of items":
                case "anvil repair cost":
                case "anvil text input":
                case "applied beacon effect":
                case "applied enchantments":
                case "banner patterns":
                case "book author":
                case "book pages":
                case "book title":
                case "color of":
                case "custom model data":
                case "damage value/durability":
                case "enchantment level":
                case "first empty slot in inventory":
                case "item amount":
                case "item cooldown":
                case "item enchantments":
                case "item flags":
                case "lore":
                case "max durability":
                case "max item use time":
                case "maximum stack size":
                case "potion effect tier":
                case "potion effects":
                case "skull owner":
                case "unbreakable items":
                    this.appendValueInput("ITEM")
                        .setCheck("String")
                        .appendField("item:");
                    break;

                // Location inputs
                case "altitude":
                case "center of world border":
                case "chunk":
                case "coordinate":
                case "distance":
                case "head location":
                case "highest solid block":
                case "location":
                case "lowest/highest solid block":
                case "middle of location":
                case "midpoint":
                case "yaw / pitch":
                    this.appendValueInput("LOCATION")
                        .setCheck("String")
                        .appendField("location:");
                    break;

                // Multiple inputs
                case "age of block/entity":
                    this.appendValueInput("TARGET")
                        .setCheck("String")
                        .appendField("target:");
                    break;

                case "distance":
                    this.appendValueInput("LOCATION1")
                        .setCheck("String")
                        .appendField("location 1:");
                    this.appendValueInput("LOCATION2")
                        .setCheck("String")
                        .appendField("location 2:");
                    break;

                case "warden anger level":
                    this.appendValueInput("WARDEN")
                        .setCheck("String")
                        .appendField("warden:");
                    this.appendValueInput("TARGET")
                        .setCheck("String")
                        .appendField("target:");
                    break;

                // Default case for simple objects
                default:
                    // For most objects, no additional inputs needed
                    break;
            }

            // Update the block's appearance
            if (this.workspace) {
                this.workspace.resize();
            }
        },

        mutationToDom: function() {
            var container = document.createElement('mutation');
            container.setAttribute('object_type', this.getFieldValue('OBJECT_TYPE'));
            return container;
        },

        domToMutation: function(xmlElement) {
            var objectType = xmlElement.getAttribute('object_type');
            if (objectType) {
                this.setFieldValue(objectType, 'OBJECT_TYPE');
                this.updateShape_();
            }
        }
    };

    // UNCOMMON VALUES BLOCK WITH DYNAMIC INPUTS
    // UNCOMMON VALUES BLOCK WITH DYNAMIC INPUTS
    Blockly.Blocks['skript_uncommon_values'] = {
        init: function() {
            this.setColour("#59C059");

            this.appendDummyInput()
                .appendField(new SearchableDropdown([
                    // Math expressions
                    ["difference", "difference"],
                    ["infinity", "infinity"],
                    ["nan", "nan"],
                    ["negative infinity", "negative infinity"],
                    ["percent of", "percent of"],
                    ["pi", "pi"],
                    ["round down", "round down"],
                    ["round", "round"],
                    ["round up", "round up"],

                    // String expressions
                    ["uppercase", "uppercase"],
                    ["lowercase", "lowercase"],
                    ["capitalize", "capitalize"],
                    ["colored text", "colored text"],
                    ["uncolored text", "uncolored text"],
                    ["hash", "hash"],
                    ["join", "join"],
                    ["split", "split"],
                    ["new line", "new line"],
                    ["random character", "random character"],
                    ["raw string", "raw string"],
                    ["repeat string", "repeat string"],
                    ["substring", "substring"],
                    ["characters between", "characters between"],

                    // List expressions
                    ["alphabetical sort", "alphabetical sort"],
                    ["first element", "first element"],
                    ["last element", "last element"],
                    ["random element", "random element"],
                    ["random", "random"],
                    ["reversed list", "reversed list"],
                    ["shuffled list", "shuffled list"],
                    ["sorted list", "sorted list"],

                    // Date/Time expressions
                    ["now", "now"],
                    ["formatted date", "formatted date"],
                    ["unix timestamp", "unix timestamp"],

                    // Other expressions
                    ["random uuid", "random uuid"],
                    ["parse error", "parse error"]
                ]), "VALUE_TYPE");

            this.setOutput(true, null);
            this.setTooltip("Select from various uncommon Skript values");

            // Initialize with no additional inputs
            this.updateShape_();

            // Update inputs when value type changes
            this.setOnChange(function(changeEvent) {
                if (changeEvent.type === Blockly.Events.BLOCK_CHANGE &&
                    changeEvent.element === 'field' &&
                    changeEvent.name === 'VALUE_TYPE') {
                    this.updateShape_();
                }
            }.bind(this));
        },

        updateShape_: function() {
            var valueType = this.getFieldValue('VALUE_TYPE');

            // Remove all inputs except the first one (VALUE_TYPE)
            while (this.inputList.length > 1) {
                this.removeInput(this.inputList[this.inputList.length - 1].name);
            }

            // Add appropriate inputs based on value type
            switch(valueType) {
                // String inputs
                case "uppercase":
                case "lowercase":
                case "capitalize":
                case "colored text":
                case "uncolored text":
                case "hash":
                case "raw string":
                    this.appendValueInput("TEXT")
                        .setCheck("String")
                        .appendField("text:");
                    break;

                case "repeat string":
                    this.appendValueInput("TEXT")
                        .setCheck("String")
                        .appendField("text:");
                    this.appendValueInput("TIMES")
                        .setCheck("Number")
                        .appendField("times:");
                    break;

                case "substring":
                    this.appendValueInput("TEXT")
                        .setCheck("String")
                        .appendField("text:");
                    this.appendValueInput("FROM")
                        .setCheck("Number")
                        .appendField("from:");
                    this.appendValueInput("TO")
                        .setCheck("Number")
                        .appendField("to:");
                    break;

                case "join":
                    this.appendValueInput("LIST")
                        .setCheck(null)
                        .appendField("list:");
                    this.appendValueInput("DELIMITER")
                        .setCheck("String")
                        .appendField("with:");
                    break;

                case "split":
                    this.appendValueInput("TEXT")
                        .setCheck("String")
                        .appendField("text:");
                    this.appendValueInput("DELIMITER")
                        .setCheck("String")
                        .appendField("at:");
                    break;

                // Number inputs
                case "difference":
                    this.appendValueInput("NUMBER1")
                        .setCheck("Number")
                        .appendField("between:");
                    this.appendValueInput("NUMBER2")
                        .setCheck("Number")
                        .appendField("and:");
                    break;

                case "percent of":
                    this.appendValueInput("PERCENT")
                        .setCheck("Number")
                        .appendField("percent:");
                    this.appendValueInput("NUMBER")
                        .setCheck("Number")
                        .appendField("of:");
                    break;

                case "round down":
                case "round":
                case "round up":
                    this.appendValueInput("NUMBER")
                        .setCheck("Number")
                        .appendField("number:");
                    break;

                // List inputs
                case "alphabetical sort":
                case "reversed list":
                case "shuffled list":
                case "sorted list":
                    this.appendValueInput("LIST")
                        .setCheck(null)
                        .appendField("list:");
                    break;

                case "first element":
                case "last element":
                case "random element":
                    this.appendValueInput("LIST")
                        .setCheck(null)
                        .appendField("of:");
                    break;

                case "random":
                    this.appendValueInput("LIST")
                        .setCheck(null)
                        .appendField("from:");
                    break;

                // Date inputs
                case "formatted date":
                    this.appendValueInput("DATE")
                        .setCheck(null)
                        .appendField("date:");
                    this.appendValueInput("FORMAT")
                        .setCheck("String")
                        .appendField("format:");
                    break;

                case "unix timestamp":
                    this.appendValueInput("DATE")
                        .setCheck(null)
                        .appendField("of:");
                    break;

                // Multiple inputs
                case "characters between":
                    this.appendValueInput("CHAR1")
                        .setCheck("String")
                        .appendField("from:");
                    this.appendValueInput("CHAR2")
                        .setCheck("String")
                        .appendField("to:");
                    break;

                // Default case for simple values (no inputs)
                default:
                    // For most values, no additional inputs needed
                    break;
            }

            // Update the block's appearance
            if (this.workspace) {
                this.workspace.resize();
            }
        },

        mutationToDom: function() {
            var container = document.createElement('mutation');
            container.setAttribute('value_type', this.getFieldValue('VALUE_TYPE'));
            return container;
        },

        domToMutation: function(xmlElement) {
            var valueType = xmlElement.getAttribute('value_type');
            if (valueType) {
                this.setFieldValue(valueType, 'VALUE_TYPE');
                this.updateShape_();
            }
        }
    };

    // ========================================
    // NEW VALUE BLOCKS
    // ========================================

    Blockly.Blocks['skript_any_of'] = {
        init: function() {
            this.setColour("#59C059");
            this.appendDummyInput()
                .appendField("any of");
            this.appendValueInput("VALUES")
                .setCheck(null);
            this.setOutput(true, null);
            this.setTooltip("Returns an 'or list' composed of the given objects");
        }
    };

    Blockly.Blocks['skript_default_value'] = {
        init: function() {
            this.setColour("#59C059");
            this.appendValueInput("PRIMARY")
                .setCheck(null);
            this.appendDummyInput()
                .appendField("otherwise");
            this.appendValueInput("SECONDARY")
                .setCheck(null);
            this.setInputsInline(true);
            this.setOutput(true, null);
            this.setTooltip("Returns primary value if set, otherwise secondary value");
        }
    };

    Blockly.Blocks['skript_ternary'] = {
        init: function() {
            this.setColour("#59C059");
            this.appendValueInput("TRUE_VALUE")
                .setCheck(null);
            this.appendDummyInput()
                .appendField("if");
            this.appendValueInput("CONDITION")
                .setCheck("Boolean");
            this.appendDummyInput()
                .appendField("otherwise");
            this.appendValueInput("FALSE_VALUE")
                .setCheck(null);
            this.setInputsInline(true);
            this.setOutput(true, null);
            this.setTooltip("Returns first value if condition is true, otherwise second value");
        }
    };


    // ========================================
    // BLOCK DEFINITIONS
    // ========================================
    // ========================================
    // COMMON EFFECT BLOCK DEFINITIONS
    // ========================================
    // ========================================
    // NEW SKRIPT HUB FUNCTION BLOCKS
    // ========================================

    // MATH FUNCTION BLOCKS
    Blockly.Blocks['skript_function_abs'] = {
        init: function() {
            this.setColour("#9A5CA6");
            this.appendValueInput("NUMBER")
                .setCheck("Number")
                .appendField("abs(");
            this.appendDummyInput()
                .appendField(")");
            this.setInputsInline(true);
            this.setOutput(true, "Number");
            this.setTooltip("Returns the absolute value (makes positive)");
        }
    };

    Blockly.Blocks['skript_function_ceil'] = {
        init: function() {
            this.setColour("#9A5CA6");
            this.appendValueInput("NUMBER")
                .setCheck("Number")
                .appendField("ceil(");
            this.appendDummyInput()
                .appendField(")");
            this.setInputsInline(true);
            this.setOutput(true, "Number");
            this.setTooltip("Rounds a number up to the nearest integer");
        }
    };

    Blockly.Blocks['skript_function_floor'] = {
        init: function() {
            this.setColour("#9A5CA6");
            this.appendValueInput("NUMBER")
                .setCheck("Number")
                .appendField("floor(");
            this.appendDummyInput()
                .appendField(")");
            this.setInputsInline(true);
            this.setOutput(true, "Number");
            this.setTooltip("Rounds a number down to the nearest integer");
        }
    };

    Blockly.Blocks['skript_function_round'] = {
        init: function() {
            this.setColour("#9A5CA6");
            this.appendValueInput("NUMBER")
                .setCheck("Number")
                .appendField("round(");
            this.appendValueInput("DECIMALS")
                .setCheck("Number")
                .appendField(", decimals:");
            this.appendDummyInput()
                .appendField(")");
            this.setInputsInline(true);
            this.setOutput(true, "Number");
            this.setTooltip("Rounds a number to specified decimal places");
        }
    };

    Blockly.Blocks['skript_function_sqrt'] = {
        init: function() {
            this.setColour("#9A5CA6");
            this.appendValueInput("NUMBER")
                .setCheck("Number")
                .appendField("sqrt(");
            this.appendDummyInput()
                .appendField(")");
            this.setInputsInline(true);
            this.setOutput(true, "Number");
            this.setTooltip("Square root function");
        }
    };

    Blockly.Blocks['skript_function_sin'] = {
        init: function() {
            this.setColour("#9A5CA6");
            this.appendValueInput("ANGLE")
                .setCheck("Number")
                .appendField("sin(");
            this.appendDummyInput()
                .appendField("Â°)");
            this.setInputsInline(true);
            this.setOutput(true, "Number");
            this.setTooltip("Sine function (degrees)");
        }
    };

    Blockly.Blocks['skript_function_cos'] = {
        init: function() {
            this.setColour("#9A5CA6");
            this.appendValueInput("ANGLE")
                .setCheck("Number")
                .appendField("cos(");
            this.appendDummyInput()
                .appendField("Â°)");
            this.setInputsInline(true);
            this.setOutput(true, "Number");
            this.setTooltip("Cosine function (degrees)");
        }
    };

    Blockly.Blocks['skript_function_tan'] = {
        init: function() {
            this.setColour("#9A5CA6");
            this.appendValueInput("ANGLE")
                .setCheck("Number")
                .appendField("tan(");
            this.appendDummyInput()
                .appendField("Â°)");
            this.setInputsInline(true);
            this.setOutput(true, "Number");
            this.setTooltip("Tangent function (degrees)");
        }
    };

    Blockly.Blocks['skript_function_min'] = {
        init: function() {
            this.setColour("#9A5CA6");
            this.appendValueInput("NUMBERS")
                .setCheck(null)
                .appendField("min(");
            this.appendDummyInput()
                .appendField(")");
            this.setInputsInline(true);
            this.setOutput(true, "Number");
            this.setTooltip("Returns the smallest number from a list");
        }
    };

    Blockly.Blocks['skript_function_max'] = {
        init: function() {
            this.setColour("#9A5CA6");
            this.appendValueInput("NUMBERS")
                .setCheck(null)
                .appendField("max(");
            this.appendDummyInput()
                .appendField(")");
            this.setInputsInline(true);
            this.setOutput(true, "Number");
            this.setTooltip("Returns the largest number from a list");
        }
    };

    Blockly.Blocks['skript_function_sum'] = {
        init: function() {
            this.setColour("#9A5CA6");
            this.appendValueInput("NUMBERS")
                .setCheck(null)
                .appendField("sum(");
            this.appendDummyInput()
                .appendField(")");
            this.setInputsInline(true);
            this.setOutput(true, "Number");
            this.setTooltip("Sums a list of numbers");
        }
    };

    Blockly.Blocks['skript_function_mod'] = {
        init: function() {
            this.setColour("#9A5CA6");
            this.appendValueInput("DIVIDEND")
                .setCheck("Number")
                .appendField("mod(");
            this.appendValueInput("DIVISOR")
                .setCheck("Number")
                .appendField(",");
            this.appendDummyInput()
                .appendField(")");
            this.setInputsInline(true);
            this.setOutput(true, "Number");
            this.setTooltip("Modulo operation (remainder)");
        }
    };

    // UTILITY FUNCTION BLOCKS
    Blockly.Blocks['skript_function_location'] = {
        init: function() {
            this.setColour("#9A5CA6");
            this.appendValueInput("X")
                .setCheck("Number")
                .appendField("location(");
            this.appendValueInput("Y")
                .setCheck("Number")
                .appendField(",");
            this.appendValueInput("Z")
                .setCheck("Number")
                .appendField(",");
            this.appendValueInput("WORLD")
                .setCheck("String")
                .appendField(",");
            this.appendDummyInput()
                .appendField(")");
            this.setInputsInline(true);
            this.setOutput(true, "String");
            this.setTooltip("Creates a location from coordinates and world");
        }
    };

    Blockly.Blocks['skript_function_vector'] = {
        init: function() {
            this.setColour("#9A5CA6");
            this.appendValueInput("X")
                .setCheck("Number")
                .appendField("vector(");
            this.appendValueInput("Y")
                .setCheck("Number")
                .appendField(",");
            this.appendValueInput("Z")
                .setCheck("Number")
                .appendField(",");
            this.appendDummyInput()
                .appendField(")");
            this.setInputsInline(true);
            this.setOutput(true, "String");
            this.setTooltip("Creates a 3D vector");
        }
    };

    Blockly.Blocks['skript_function_world'] = {
        init: function() {
            this.setColour("#9A5CA6");
            this.appendValueInput("NAME")
                .setCheck("String")
                .appendField("world(");
            this.appendDummyInput()
                .appendField(")");
            this.setInputsInline(true);
            this.setOutput(true, "String");
            this.setTooltip("Gets a world by name");
        }
    };

    Blockly.Blocks['skript_function_player'] = {
        init: function() {
            this.setColour("#9A5CA6");
            this.appendValueInput("NAME_OR_UUID")
                .setCheck("String")
                .appendField("player(");
            this.appendDummyInput()
                .appendField(", exact match:");
            this.appendDummyInput()
                .appendField(new Blockly.FieldCheckbox("FALSE"), "EXACT")
                .appendField(")");
            this.setInputsInline(true);
            this.setOutput(true, "String");
            this.setTooltip("Gets an online player by name or UUID");
        }
    };

    Blockly.Blocks['skript_function_offlineplayer'] = {
        init: function() {
            this.setColour("#9A5CA6");
            this.appendValueInput("NAME_OR_UUID")
                .setCheck("String")
                .appendField("offlineplayer(");
            this.appendDummyInput()
                .appendField(", allow lookups:");
            this.appendDummyInput()
                .appendField(new Blockly.FieldCheckbox("TRUE"), "LOOKUPS")
                .appendField(")");
            this.setInputsInline(true);
            this.setOutput(true, "String");
            this.setTooltip("Gets an offline player by name or UUID");
        }
    };

    Blockly.Blocks['skript_function_uuid'] = {
        init: function() {
            this.setColour("#9A5CA6");
            this.appendValueInput("UUID_STRING")
                .setCheck("String")
                .appendField("uuid(");
            this.appendDummyInput()
                .appendField(")");
            this.setInputsInline(true);
            this.setOutput(true, "String");
            this.setTooltip("Creates a UUID from string");
        }
    };

    Blockly.Blocks['skript_function_rgb'] = {
        init: function() {
            this.setColour("#9A5CA6");
            this.appendValueInput("RED")
                .setCheck("Number")
                .appendField("rgb(");
            this.appendValueInput("GREEN")
                .setCheck("Number")
                .appendField(",");
            this.appendValueInput("BLUE")
                .setCheck("Number")
                .appendField(",");
            this.appendValueInput("ALPHA")
                .setCheck("Number")
                .appendField(",");
            this.appendDummyInput()
                .appendField(")");
            this.setInputsInline(true);
            this.setOutput(true, "String");
            this.setTooltip("Creates RGB color");
        }
    };

    // ADVANCED MATH FUNCTIONS
    Blockly.Blocks['skript_function_factorial'] = {
        init: function() {
            this.setColour("#9A5CA6");
            this.appendValueInput("NUMBER")
                .setCheck("Number")
                .appendField("factorial(");
            this.appendDummyInput()
                .appendField(")");
            this.setInputsInline(true);
            this.setOutput(true, "Number");
            this.setTooltip("Calculates factorial of a number");
        }
    };

    Blockly.Blocks['skript_function_mean'] = {
        init: function() {
            this.setColour("#9A5CA6");
            this.appendValueInput("NUMBERS")
                .setCheck(null)
                .appendField("mean(");
            this.appendDummyInput()
                .appendField(")");
            this.setInputsInline(true);
            this.setOutput(true, "Number");
            this.setTooltip("Calculates average of numbers");
        }
    };

    Blockly.Blocks['skript_function_median'] = {
        init: function() {
            this.setColour("#9A5CA6");
            this.appendValueInput("NUMBERS")
                .setCheck(null)
                .appendField("median(");
            this.appendDummyInput()
                .appendField(")");
            this.setInputsInline(true);
            this.setOutput(true, "Number");
            this.setTooltip("Finds median value");
        }
    };

    Blockly.Blocks['skript_function_clamp'] = {
        init: function() {
            this.setColour("#9A5CA6");
            this.appendValueInput("VALUE")
                .setCheck("Number")
                .appendField("clamp(");
            this.appendValueInput("MIN")
                .setCheck("Number")
                .appendField(", min:");
            this.appendValueInput("MAX")
                .setCheck("Number")
                .appendField(", max:");
            this.appendDummyInput()
                .appendField(")");
            this.setInputsInline(true);
            this.setOutput(true, "Number");
            this.setTooltip("Clamps value between min and max");
        }
    };
    // Send actionbar
    Blockly.Blocks['skript_send_actionbar'] = {
        init: function() {
            this.setColour("#9B59B6");
            this.appendValueInput("TEXT")
                .setCheck("String")
                .appendField("send actionbar");
            this.appendValueInput("PLAYERS")
                .setCheck("String")
                .appendField("to");
            this.setInputsInline(true);
            this.setPreviousStatement(true, null);
            this.setNextStatement(true, null);
            this.setTooltip("Send actionbar message to players");
        }
    };
    // Give item block - ADD THIS
    Blockly.Blocks['skript_give'] = {
        init: function() {
            this.setColour("#9B59B6");
            this.appendValueInput("ITEM")
                .setCheck("String")
                .appendField("give");
            this.appendValueInput("PLAYER")
                .setCheck("String")
                .appendField("to");
            this.setInputsInline(true);
            this.setPreviousStatement(true, null);
            this.setNextStatement(true, null);
            this.setTooltip("Give item to player");
        }
    };
    // Send message
    Blockly.Blocks['skript_send_message'] = {
        init: function() {
            this.setColour("#9B59B6");
            this.appendValueInput("MESSAGE")
                .setCheck("String")
                .appendField("send message");
            this.appendValueInput("PLAYERS")
                .setCheck("String")
                .appendField("to");
            this.setInputsInline(true);
            this.setPreviousStatement(true, null);
            this.setNextStatement(true, null);
            this.setTooltip("Send message to players");
        }
    };

    // Play sound
    Blockly.Blocks['skript_play_sound'] = {
        init: function() {
            this.setColour("#9B59B6");
            this.appendValueInput("SOUND")
                .setCheck("String")
                .appendField("play sound");
            this.appendValueInput("LOCATION")
                .setCheck("String")
                .appendField("at");
            this.appendValueInput("PLAYERS")
                .setCheck("String")
                .appendField("to");
            this.setInputsInline(true);
            this.setPreviousStatement(true, null);
            this.setNextStatement(true, null);
            this.setTooltip("Play sound at location for players");
        }
    };

    // Play effect
    Blockly.Blocks['skript_play_effect'] = {
        init: function() {
            this.setColour("#9B59B6");
            this.appendValueInput("EFFECT")
                .setCheck("String")
                .appendField("play effect");
            this.appendValueInput("LOCATION")
                .setCheck("String")
                .appendField("at");
            this.appendValueInput("PLAYERS")
                .setCheck("String")
                .appendField("to");
            this.setInputsInline(true);
            this.setPreviousStatement(true, null);
            this.setNextStatement(true, null);
            this.setTooltip("Play visual effect at location for players");
        }
    };

    // Send title
    Blockly.Blocks['skript_send_title'] = {
        init: function() {
            this.setColour("#9B59B6");
            this.appendValueInput("TITLE")
                .setCheck("String")
                .appendField("send title");
            this.appendValueInput("SUBTITLE")
                .setCheck("String")
                .appendField("with subtitle");
            this.appendValueInput("PLAYERS")
                .setCheck("String")
                .appendField("to");
            this.setInputsInline(true);
            this.setPreviousStatement(true, null);
            this.setNextStatement(true, null);
            this.setTooltip("Send title and subtitle to players");
        }
    };

    // Potion effect
    Blockly.Blocks['skript_potion_effect'] = {
        init: function() {
            this.setColour("#9B59B6");
            this.appendValueInput("EFFECT")
                .setCheck("String")
                .appendField("apply potion effect");
            this.appendValueInput("ENTITY")
                .setCheck("String")
                .appendField("to");
            this.appendValueInput("DURATION")
                .setCheck("Number")
                .appendField("for");
            this.appendDummyInput()
                .appendField("seconds");
            this.setInputsInline(true);
            this.setPreviousStatement(true, null);
            this.setNextStatement(true, null);
            this.setTooltip("Apply potion effect to entity");
        }
    };
    // ========================================
    // MISSING EFFECT BLOCK DEFINITIONS
    // ========================================

    // Broadcast block
    Blockly.Blocks['skript_broadcast'] = {
        init: function() {
            this.setColour("#9B59B6");
            this.appendValueInput("MESSAGE")
                .setCheck("String")
                .appendField("broadcast");
            this.setInputsInline(true);
            this.setPreviousStatement(true, null);
            this.setNextStatement(true, null);
            this.setTooltip("Broadcast message to all players");
        }
    };

    // Teleport block
    Blockly.Blocks['skript_teleport'] = {
        init: function() {
            this.setColour("#9B59B6");
            this.appendValueInput("ENTITY")
                .setCheck("String")
                .appendField("teleport");
            this.appendValueInput("LOCATION")
                .setCheck("String")
                .appendField("to");
            this.setInputsInline(true);
            this.setPreviousStatement(true, null);
            this.setNextStatement(true, null);
            this.setTooltip("Teleport entity to location");
        }
    };

    // Kill block
    Blockly.Blocks['skript_kill'] = {
        init: function() {
            this.setColour("#9B59B6");
            this.appendValueInput("ENTITY")
                .setCheck("String")
                .appendField("kill");
            this.setInputsInline(true);
            this.setPreviousStatement(true, null);
            this.setNextStatement(true, null);
            this.setTooltip("Kill entity");
        }
    };

    // Set variable block
    Blockly.Blocks['skript_set_variable'] = {
        init: function() {
            this.setColour("#9B59B6");
            this.appendDummyInput()
                .appendField("set {")
                .appendField(new Blockly.FieldTextInput("_variable"), "VAR")
                .appendField("} to");
            this.appendValueInput("VALUE")
                .setCheck(null);
            this.setInputsInline(true);
            this.setPreviousStatement(true, null);
            this.setNextStatement(true, null);
            this.setTooltip("Set variable value");
        }
    };

    // Cancel event block
    Blockly.Blocks['skript_cancel_event'] = {
        init: function() {
            this.setColour("#9B59B6");
            this.appendDummyInput()
                .appendField("cancel event");
            this.setPreviousStatement(true, null);
            this.setNextStatement(true, null);
            this.setTooltip("Cancel the current event");
        }
    };

    // Wait block
    Blockly.Blocks['skript_wait'] = {
        init: function() {
            this.setColour("#9B59B6");
            this.appendValueInput("TIME")
                .setCheck("String")
                .appendField("wait");
            this.setInputsInline(true);
            this.setPreviousStatement(true, null);
            this.setNextStatement(true, null);
            this.setTooltip("Wait for specified time");
        }
    };
    // Damage
    Blockly.Blocks['skript_damage'] = {
        init: function() {
            this.setColour("#9B59B6");
            this.appendValueInput("ENTITY")
                .setCheck("String")
                .appendField("damage");
            this.appendValueInput("AMOUNT")
                .setCheck("Number")
                .appendField("by");
            this.appendDummyInput()
                .appendField("hearts");
            this.setInputsInline(true);
            this.setPreviousStatement(true, null);
            this.setNextStatement(true, null);
            this.setTooltip("Damage entity");
        }
    };

    // Heal
    Blockly.Blocks['skript_heal'] = {
        init: function() {
            this.setColour("#9B59B6");
            this.appendValueInput("ENTITY")
                .setCheck("String")
                .appendField("heal");
            this.appendValueInput("AMOUNT")
                .setCheck("Number")
                .appendField("by");
            this.appendDummyInput()
                .appendField("hearts");
            this.setInputsInline(true);
            this.setPreviousStatement(true, null);
            this.setNextStatement(true, null);
            this.setTooltip("Heal entity");
        }
    };

    // Execute command
    Blockly.Blocks['skript_command'] = {
        init: function() {
            this.setColour("#9B59B6");
            this.appendValueInput("COMMAND")
                .setCheck("String")
                .appendField("execute command");
            this.setInputsInline(true);
            this.setPreviousStatement(true, null);
            this.setNextStatement(true, null);
            this.setTooltip("Execute console command");
        }
    };
    // UNCOMMON EFFECTS BLOCK
    Blockly.Blocks['skript_uncommon_effects'] = {
        init: function() {
            this.setColour("#9B59B6");

            this.appendDummyInput()
                .appendField(new SearchableDropdown([
                    // Entity effects
                    ["allow entity to duplicate", "allow entity to duplicate"],
                    ["prevent entity from duplicating", "prevent entity from duplicating"],
                    ["lock age of entity", "lock age of entity"],
                    ["allow entity to age", "allow entity to age"],
                    ["make entity breedable", "make entity breedable"],
                    ["make entity not breedable", "make entity not breedable"],
                    ["apply bone meal", "apply bone meal"],
                    ["cancel active item", "cancel active item"],
                    ["charge creeper", "charge creeper"],
                    ["uncharge creeper", "uncharge creeper"],
                    ["clear entity storage", "clear entity storage"],
                    ["color items", "color items"],
                    ["make command block conditional", "make command block conditional"],
                    ["make command block unconditional", "make command block unconditional"],
                    ["connect player to server", "connect player to server"],
                    ["consume brewing fuel", "consume brewing fuel"],
                    ["prevent brewing fuel consumption", "prevent brewing fuel consumption"],
                    ["continue loop", "continue loop"],
                    ["copy into variable", "copy into variable"],
                    ["make entity dance", "make entity dance"],
                    ["make entity stop dancing", "make entity stop dancing"],
                    ["detonate entity", "detonate entity"],
                    ["drop items", "drop items"],
                    ["enable script", "enable script"],
                    ["disable script", "disable script"],
                    ["enchant item", "enchant item"],
                    ["disenchant item", "disenchant item"],
                    ["enderman teleport", "enderman teleport"],
                    ["enforce whitelist", "enforce whitelist"],
                    ["unenforce whitelist", "unenforce whitelist"],
                    ["make entity despawn", "make entity despawn"],
                    ["prevent entity from despawning", "prevent entity from despawning"],
                    ["hide entity", "hide entity"],
                    ["reveal entity", "reveal entity"],
                    ["equip entity", "equip entity"],
                    ["unequip entity", "unequip entity"],
                    ["exit trigger", "exit trigger"],
                    ["expand world border", "expand world border"],
                    ["shrink world border", "shrink world border"],
                    ["explode creeper", "explode creeper"],
                    ["create explosion", "create explosion"],
                    ["feed player", "feed player"],
                    ["force entity to attack", "force entity to attack"],
                    ["force entity to eat", "force entity to eat"],
                    ["force entity to stop eating", "force entity to stop eating"],
                    ["force item to glint", "force item to glint"],
                    ["prevent item from glinting", "prevent item from glinting"],
                    ["force panda on back", "force panda on back"],
                    ["force panda off back", "force panda off back"],
                    ["force respawn", "force respawn"],
                    ["generate loot", "generate loot"],
                    ["remove goat horns", "remove goat horns"],
                    ["regrow goat horns", "regrow goat horns"],
                    ["make entity left-handed", "make entity left-handed"],
                    ["make entity right-handed", "make entity right-handed"],
                    ["hide player from server list", "hide player from server list"],
                    ["ignite entity", "ignite entity"],
                    ["extinguish entity", "extinguish entity"],
                    ["insert entity into storage", "insert entity into storage"],
                    ["prevent item despawn", "prevent item despawn"],
                    ["allow item despawn", "allow item despawn"],
                    ["show item tooltip", "show item tooltip"],
                    ["hide item tooltip", "hide item tooltip"],
                    ["keep inventory", "keep inventory"],
                    ["keep experience", "keep experience"],
                    ["kick player", "kick player"],
                    ["ban player", "ban player"],
                    ["unban player", "unban player"],
                    ["apply knockback", "apply knockback"],
                    ["launch firework", "launch firework"],
                    ["leash entity", "leash entity"],
                    ["unleash entity", "unleash entity"],
                    ["strike lightning", "strike lightning"],
                    ["load world", "load world"],
                    ["unload world", "unload world"],
                    ["make entity look at", "make entity look at"],
                    ["make entity adult", "make entity adult"],
                    ["make entity baby", "make entity baby"],
                    ["make allay duplicate", "make allay duplicate"],
                    ["make entity sense disturbance", "make entity sense disturbance"],
                    ["make egg hatch", "make egg hatch"],
                    ["prevent egg from hatching", "prevent egg from hatching"],
                    ["make entity scream", "make entity scream"],
                    ["make entity stop screaming", "make entity stop screaming"],
                    ["make item fire resistant", "make item fire resistant"],
                    ["force player to fly", "force player to fly"],
                    ["make goat ram", "make goat ram"],
                    ["make explosion incendiary", "make explosion incendiary"],
                    ["make entity invisible", "make entity invisible"],
                    ["make entity visible", "make entity visible"],
                    ["make entity invulnerable", "make entity invulnerable"],
                    ["make entity vulnerable", "make entity vulnerable"],
                    ["make panda roll", "make panda roll"],
                    ["make panda stop rolling", "make panda stop rolling"],
                    ["make panda sneeze", "make panda sneeze"],
                    ["make panda stop sneezing", "make panda stop sneezing"],
                    ["make player say", "make player say"],
                    ["make sign glow", "make sign glow"],
                    ["make sign not glow", "make sign not glow"],
                    ["op player", "op player"],
                    ["deop player", "deop player"],
                    ["open book", "open book"],
                    ["open inventory", "open inventory"],
                    ["close inventory", "close inventory"],
                    ["open lid", "open lid"],
                    ["close lid", "close lid"],
                    ["make entity pathfind", "make entity pathfind"],
                    ["stop entity pathfinding", "stop entity pathfinding"],
                    ["make entity persistent", "make entity persistent"],
                    ["make entity not persistent", "make entity not persistent"],
                    ["make axolotl play dead", "make axolotl play dead"],
                    ["make axolotl stop playing dead", "make axolotl stop playing dead"],
                    ["poison entity", "poison entity"],
                    ["cure entity", "cure entity"],
                    ["pull in hooked entity", "pull in hooked entity"],
                    ["push entity", "push entity"],
                    ["enable PvP", "enable PvP"],
                    ["disable PvP", "disable PvP"],
                    ["register tag", "register tag"],
                    ["release entity from storage", "release entity from storage"],
                    ["replace text", "replace text"],
                    ["return value", "return value"],
                    ["ring bell", "ring bell"],
                    ["rotate display", "rotate display"],
                    ["save world", "save world"],
                    ["send block change", "send block change"],
                    ["send resource pack", "send resource pack"],
                    ["shear entity", "shear entity"],
                    ["unshear entity", "unshear entity"],
                    ["shoot projectile", "shoot projectile"],
                    ["silence entity", "silence entity"],
                    ["unsilence entity", "unsilence entity"],
                    ["sort list", "sort list"],
                    ["spawn entity", "spawn entity"],
                    ["make player sprint", "make player sprint"],
                    ["make player stop sprinting", "make player stop sprinting"],
                    ["stop server", "stop server"],
                    ["restart server", "restart server"],
                    ["stop sound", "stop sound"],
                    ["make strider shiver", "make strider shiver"],
                    ["make strider stop shivering", "make strider stop shivering"],
                    ["swing hand", "swing hand"],
                    ["tame entity", "tame entity"],
                    ["untame entity", "untame entity"],
                    ["force teleport", "force teleport"],
                    ["apply drop shadow to text", "apply drop shadow to text"],
                    ["remove drop shadow from text", "remove drop shadow from text"],
                    ["make text visible through blocks", "make text visible through blocks"],
                    ["prevent text from being visible through blocks", "prevent text from being visible through blocks"],
                    ["reset title", "reset title"],
                    ["toggle block", "toggle block"],
                    ["show custom name", "show custom name"],
                    ["hide custom name", "hide custom name"],
                    ["allow flight", "allow flight"],
                    ["disallow flight", "disallow flight"],
                    ["allow picking up items", "allow picking up items"],
                    ["disallow picking up items", "disallow picking up items"],
                    ["transform list", "transform list"],
                    ["grow tree", "grow tree"],
                    ["update block", "update block"],
                    ["rotate vector", "rotate vector"],
                    ["make entity ride", "make entity ride"],
                    ["make entity dismount", "make entity dismount"],
                    ["make entity sleep", "make entity sleep"],
                    ["make entity wake up", "make entity wake up"],
                    ["zombify villager", "zombify villager"],
                    ["unzombify villager", "unzombify villager"]
                ]), "EFFECT_TYPE");

            this.setPreviousStatement(true, null);
            this.setNextStatement(true, null);
            this.setTooltip("Select from various uncommon effects");

            // Initialize with no additional inputs
            this.updateShape_();

            // Update inputs when effect type changes
            this.setOnChange(function(changeEvent) {
                if (changeEvent.type === Blockly.Events.BLOCK_CHANGE &&
                    changeEvent.element === 'field' &&
                    changeEvent.name === 'EFFECT_TYPE') {
                    this.updateShape_();
                }
            }.bind(this));
        },

        updateShape_: function() {
            var effectType = this.getFieldValue('EFFECT_TYPE');

            // Remove all inputs except the first one (EFFECT_TYPE)
            while (this.inputList.length > 1) {
                this.removeInput(this.inputList[this.inputList.length - 1].name);
            }

            // Add appropriate inputs based on effect type
            switch(effectType) {
                // No input effects
                case "continue loop":
                case "exit trigger":
                case "enforce whitelist":
                case "unenforce whitelist":
                case "stop server":
                case "restart server":
                case "reset title":
                    // No inputs to add
                    break;

                // Entity input only
                case "lock age of entity":
                case "allow entity to age":
                case "make entity breedable":
                case "make entity not breedable":
                case "charge creeper":
                case "uncharge creeper":
                case "make entity dance":
                case "make entity stop dancing":
                case "detonate entity":
                case "enderman teleport":
                case "make entity despawn":
                case "prevent entity from despawning":
                case "hide entity":
                case "reveal entity":
                case "explode creeper":
                case "force entity to eat":
                case "force entity to stop eating":
                case "force respawn":
                case "make entity left-handed":
                case "make entity right-handed":
                case "ignite entity":
                case "extinguish entity":
                case "make entity adult":
                case "make entity baby":
                case "make allay duplicate":
                case "make entity scream":
                case "make entity stop screaming":
                case "make entity invisible":
                case "make entity visible":
                case "make entity invulnerable":
                case "make entity vulnerable":
                case "make panda roll":
                case "make panda stop rolling":
                case "make panda sneeze":
                case "make panda stop sneezing":
                case "make entity persistent":
                case "make entity not persistent":
                case "make axolotl play dead":
                case "make axolotl stop playing dead":
                case "poison entity":
                case "cure entity":
                case "silence entity":
                case "unsilence entity":
                case "tame entity":
                case "untame entity":
                case "make entity sleep":
                case "make entity wake up":
                case "zombify villager":
                case "unzombify villager":
                    this.appendValueInput("ENTITY")
                        .setCheck("String")
                        .appendField("entity:");
                    break;

                // Player input only
                case "hide player from server list":
                case "feed player":
                case "force player to fly":
                case "make player say":
                case "op player":
                case "deop player":
                case "make player sprint":
                case "make player stop sprinting":
                case "allow flight":
                case "disallow flight":
                    this.appendValueInput("PLAYER")
                        .setCheck("String")
                        .appendField("player:");
                    break;

                // Item input only
                case "disenchant item":
                case "make item fire resistant":
                case "force item to glint":
                case "prevent item from glinting":
                case "show item tooltip":
                case "hide item tooltip":
                    this.appendValueInput("ITEM")
                        .setCheck("String")
                        .appendField("item:");
                    break;

                // Block input only
                case "clear entity storage":
                case "make command block conditional":
                case "make command block unconditional":
                case "make sign glow":
                case "make sign not glow":
                case "open lid":
                case "close lid":
                case "ring bell":
                case "toggle block":
                case "update block":
                    this.appendValueInput("BLOCK")
                        .setCheck("String")
                        .appendField("block:");
                    break;

                // Multiple inputs
                case "allow entity to duplicate":
                case "prevent entity from duplicating":
                    this.appendValueInput("ENTITY")
                        .setCheck("String")
                        .appendField("entity:");
                    break;

                case "apply bone meal":
                    this.appendValueInput("BLOCK")
                        .setCheck("String")
                        .appendField("to block:");
                    break;

                case "cancel active item":
                    this.appendValueInput("ENTITY")
                        .setCheck("String")
                        .appendField("entity:");
                    break;

                case "color items":
                    this.appendValueInput("ITEM")
                        .setCheck("String")
                        .appendField("item:");
                    this.appendValueInput("COLOR")
                        .setCheck("String")
                        .appendField("color:");
                    break;

                case "connect player to server":
                    this.appendValueInput("PLAYER")
                        .setCheck("String")
                        .appendField("player:");
                    this.appendValueInput("SERVER")
                        .setCheck("String")
                        .appendField("server:");
                    break;

                case "copy into variable":
                    this.appendValueInput("SOURCE")
                        .setCheck("String")
                        .appendField("source:");
                    this.appendValueInput("TARGET")
                        .setCheck("String")
                        .appendField("target:");
                    break;

                case "drop items":
                    this.appendValueInput("ITEMS")
                        .setCheck("String")
                        .appendField("items:");
                    this.appendValueInput("LOCATION")
                        .setCheck("String")
                        .appendField("at:");
                    break;

                case "enchant item":
                    this.appendValueInput("ITEM")
                        .setCheck("String")
                        .appendField("item:");
                    this.appendValueInput("ENCHANTMENT")
                        .setCheck("String")
                        .appendField("enchantment:");
                    break;

                case "equip entity":
                    this.appendValueInput("ENTITY")
                        .setCheck("String")
                        .appendField("entity:");
                    this.appendValueInput("ITEM")
                        .setCheck("String")
                        .appendField("item:");
                    break;

                case "force entity to attack":
                    this.appendValueInput("ATTACKER")
                        .setCheck("String")
                        .appendField("attacker:");
                    this.appendValueInput("TARGET")
                        .setCheck("String")
                        .appendField("target:");
                    break;

                case "make entity sense disturbance":
                    this.appendValueInput("ENTITY")
                        .setCheck("String")
                        .appendField("entity:");
                    this.appendValueInput("LOCATION")
                        .setCheck("String")
                        .appendField("location:");
                    break;

                case "make goat ram":
                    this.appendValueInput("GOAT")
                        .setCheck("String")
                        .appendField("goat:");
                    this.appendValueInput("TARGET")
                        .setCheck("String")
                        .appendField("target:");
                    break;

                case "open book":
                    this.appendValueInput("BOOK")
                        .setCheck("String")
                        .appendField("book:");
                    this.appendValueInput("PLAYER")
                        .setCheck("String")
                        .appendField("player:");
                    break;

                case "make entity look at":
                    this.appendValueInput("ENTITY")
                        .setCheck("String")
                        .appendField("entity:");
                    this.appendValueInput("TARGET")
                        .setCheck("String")
                        .appendField("target:");
                    break;

                case "push entity":
                    this.appendValueInput("ENTITY")
                        .setCheck("String")
                        .appendField("entity:");
                    this.appendValueInput("DIRECTION")
                        .setCheck("String")
                        .appendField("direction:");
                    break;

                case "spawn entity":
                    this.appendValueInput("ENTITY_TYPE")
                        .setCheck("String")
                        .appendField("entity type:");
                    this.appendValueInput("LOCATION")
                        .setCheck("String")
                        .appendField("at:");
                    break;

                case "force teleport":
                    this.appendValueInput("ENTITY")
                        .setCheck("String")
                        .appendField("entity:");
                    this.appendValueInput("LOCATION")
                        .setCheck("String")
                        .appendField("to:");
                    break;

                // Default case for simple effects
                default:
                    // For most effects, add a generic value input
                    this.appendValueInput("VALUE")
                        .setCheck("String")
                        .appendField("value:");
            }

            // Update the block's appearance
            if (this.workspace) {
                this.workspace.resize();
            }
        },

        mutationToDom: function() {
            var container = document.createElement('mutation');
            container.setAttribute('effect_type', this.getFieldValue('EFFECT_TYPE'));
            return container;
        },

        domToMutation: function(xmlElement) {
            var effectType = xmlElement.getAttribute('effect_type');
            if (effectType) {
                this.setFieldValue(effectType, 'EFFECT_TYPE');
                this.updateShape_();
            }
        }
    };
    // EVENT BLOCKS
    Blockly.Blocks['skript_on_join'] = {
        init: function() {
            this.setColour("#FFAB19");
            this.appendDummyInput()
                .appendField("on player join:");
            this.appendStatementInput("DO")
                .setCheck(null);
            this.setTooltip("Triggered when a player joins");
        }
    };

    Blockly.Blocks['skript_on_rightclick'] = {
        init: function() {
            this.setColour("#FFAB19");
            this.appendDummyInput()
                .appendField("on right click");
            this.appendStatementInput("DO")
                .setCheck(null);
            this.setTooltip("Triggered on right click");
        }
    };

    Blockly.Blocks['skript_on_break'] = {
        init: function() {
            this.setColour("#FFAB19");
            this.appendDummyInput()
                .appendField("on break:");
            this.appendStatementInput("DO")
                .setCheck(null);
            this.setTooltip("Triggered when block is broken");
        }
    };

    Blockly.Blocks['skript_on_death'] = {
        init: function() {
            this.setColour("#FFAB19");
            this.appendDummyInput()
                .appendField("on death:");
            this.appendStatementInput("DO")
                .setCheck(null);
            this.setTooltip("Triggered when player dies");
        }
    };

    Blockly.Blocks['skript_on_chat'] = {
        init: function() {
            this.setColour("#FFAB19");
            this.appendDummyInput()
                .appendField("on chat:");
            this.appendStatementInput("DO")
                .setCheck(null);
            this.setTooltip("Triggered when player chats");
        }
    };

    Blockly.Blocks['skript_on_inv_click'] = {
        init: function() {
            this.setColour("#FFAB19");
            this.appendDummyInput()
                .appendField("on inventory click:");
            this.appendStatementInput("DO")
                .setCheck(null);
            this.setTooltip("Triggered when player clicks in inventory");
        }
    };

    Blockly.Blocks['skript_every_second'] = {
        init: function() {
            this.setColour("#FFAB19");
            this.appendDummyInput()
                .appendField("every second:");
            this.appendStatementInput("DO")
                .setCheck(null);
            this.setTooltip("Triggered every second");
        }
    };

    Blockly.Blocks['skript_on_time'] = {
        init: function() {
            this.setColour("#FFAB19");
            this.appendDummyInput()
                .appendField("at")
                .appendField(new Blockly.FieldTextInput("18:00"), "TIME");
            this.appendDummyInput()
                .appendField("in")
                .appendField(new Blockly.FieldTextInput("world"), "WORLD");
            this.appendStatementInput("DO")
                .setCheck(null);
            this.setTooltip("Triggered at specific time in specific world");
        }
    };

    Blockly.Blocks['skript_periodical'] = {
        init: function() {
            this.setColour("#FFAB19");
            this.appendDummyInput()
                .appendField("every")
                .appendField(new Blockly.FieldTextInput("1 second"), "TIME");
            this.appendStatementInput("DO")
                .setCheck(null);
            this.setTooltip("Triggered periodically");
        }
    };

    Blockly.Blocks['skript_periodical_world'] = {
        init: function() {
            this.setColour("#FFAB19");
            this.appendDummyInput()
                .appendField("every")
                .appendField(new Blockly.FieldTextInput("1 second"), "TIME")
                .appendField("in world")
                .appendField(new Blockly.FieldTextInput("world"), "WORLD");
            this.appendStatementInput("DO")
                .setCheck(null);
            this.setTooltip("Triggered periodically in specific world");
        }
    };

    // UNCOMMON EVENTS BLOCK
    Blockly.Blocks['skript_uncommon_events'] = {
        init: function() {
            this.setColour("#FFAB19");
            this.appendDummyInput()
                .appendField("on")
                .appendField(new SearchableDropdown([
                    ["book sign", "book sign"],
                    ["break/mine", "break/mine"],
                    ["brewing complete", "brewing complete"],
                    ["brewing fuel", "brewing fuel"],
                    ["brewing start", "brewing start"],
                    ["broadcast", "broadcast"],
                    ["bucket catch entity", "bucket catch entity"],
                    ["bucket empty", "bucket empty"],
                    ["bucket fill", "bucket fill"],
                    ["burn", "burn"],
                    ["can build check", "can build check"],
                    ["chunk generate", "chunk generate"],
                    ["chunk load", "chunk load"],
                    ["chunk unload", "chunk unload"],
                    ["combust", "combust"],
                    ["connect", "connect"],
                    ["consume", "consume"],
                    ["craft", "craft"],
                    ["creeper power", "creeper power"],
                    ["damage", "damage"],
                    ["dispense", "dispense"],
                    ["drop", "drop"],
                    ["egg throw", "egg throw"],
                    ["elytra boost", "elytra boost"],
                    ["enchant", "enchant"],
                    ["enchant prepare", "enchant prepare"],
                    ["enderman enrage", "enderman enrage"],
                    ["enderman/sheep/silverfish", "enderman/sheep/silverfish"],
                    ["entity breed", "entity breed"],
                    ["entity dismount", "entity dismount"],
                    ["entity jump", "entity jump"],
                    ["entity mount", "entity mount"],
                    ["entity portal", "entity portal"],
                    ["entity potion effect", "entity potion effect"],
                    ["entity shoot bow", "entity shoot bow"],
                    ["entity transform", "entity transform"],
                    ["experience change", "experience change"],
                    ["experience cooldown change", "experience cooldown change"],
                    ["experience spawn", "experience spawn"],
                    ["explode", "explode"],
                    ["explosion prime", "explosion prime"],
                    ["fade", "fade"],
                    ["firework explode", "firework explode"],
                    ["first join", "first join"],
                    ["fishing", "fishing"],
                    ["flight toggle", "flight toggle"],
                    ["flow", "flow"],
                    ["form", "form"],
                    ["fuel burn", "fuel burn"],
                    ["furnace item extract", "furnace item extract"],
                    ["gamemode change", "gamemode change"],
                    ["gliding state change", "gliding state change"],
                    ["hand item swap", "hand item swap"],
                    ["harvest block", "harvest block"],
                    ["heal", "heal"],
                    ["horse jump", "horse jump"],
                    ["hunger meter change", "hunger meter change"],
                    ["ignition", "ignition"],
                    ["inventory close", "inventory close"],
                    ["inventory drag", "inventory drag"],
                    ["inventory item move", "inventory item move"],
                    ["inventory open", "inventory open"],
                    ["inventory pickup", "inventory pickup"],
                    ["inventory slot change", "inventory slot change"],
                    ["item break", "item break"],
                    ["item damage", "item damage"],
                    ["item despawn", "item despawn"],
                    ["item mend", "item mend"],
                    ["item merge", "item merge"],
                    ["item spawn", "item spawn"],
                    ["kick", "kick"],
                    ["language change", "language change"],
                    ["leash/unleash", "leash/unleash"],
                    ["leaves decay", "leaves decay"],
                    ["level change", "level change"],
                    ["lightning strike", "lightning strike"],
                    ["loot generate", "loot generate"],
                    ["love mode enter", "love mode enter"],
                    ["move/rotate", "move/rotate"],
                    ["move on", "move on"],
                    ["physics", "physics"],
                    ["pick up", "pick up"],
                    ["pig zap", "pig zap"],
                    ["piglin barter", "piglin barter"],
                    ["piston extend", "piston extend"],
                    ["piston retract", "piston retract"],
                    ["player chunk enter", "player chunk enter"],
                    ["player deep sleep", "player deep sleep"],
                    ["player input", "player input"],
                    ["player pickup arrow", "player pickup arrow"],
                    ["player trade", "player trade"],
                    ["player world change", "player world change"],
                    ["portal create", "portal create"],
                    ["portal enter", "portal enter"],
                    ["prepare craft", "prepare craft"],
                    ["pressure plate/trip", "pressure plate/trip"],
                    ["projectile collide", "projectile collide"],
                    ["projectile hit", "projectile hit"],
                    ["quit", "quit"],
                    ["ready arrow", "ready arrow"],
                    ["redstone", "redstone"],
                    ["region enter/leave", "region enter/leave"],
                    ["resource pack response", "resource pack response"],
                    ["respawn", "respawn"],
                    ["resurrect attempt", "resurrect attempt"],
                    ["riptide", "riptide"],
                    ["script load/unload", "script load/unload"],
                    ["send command list", "send command list"],
                    ["server list ping", "server list ping"],
                    ["server start/stop", "server start/stop"],
                    ["sheep regrow wool", "sheep regrow wool"],
                    ["shoot", "shoot"],
                    ["sign change", "sign change"],
                    ["slime split", "slime split"],
                    ["smelt", "smelt"],
                    ["sneak toggle", "sneak toggle"],
                    ["spawn change", "spawn change"],
                    ["spectate", "spectate"],
                    ["sponge absorb", "sponge absorb"],
                    ["sprint toggle", "sprint toggle"],
                    ["start smelt", "start smelt"],
                    ["stonecutter recipe select", "stonecutter recipe select"],
                    ["stop using item", "stop using item"],
                    ["swim toggle", "swim toggle"],
                    ["system time", "system time"],
                    ["tame", "tame"],
                    ["target", "target"],
                    ["throwing egg", "throwing egg"],
                    ["tool change", "tool change"],
                    ["vehicle collision", "vehicle collision"],
                    ["vehicle create", "vehicle create"],
                    ["vehicle damage", "vehicle damage"],
                    ["vehicle destroy", "vehicle destroy"],
                    ["vehicle enter", "vehicle enter"],
                    ["vehicle exit", "vehicle exit"],
                    ["vehicle move", "vehicle move"],
                    ["weather change", "weather change"],
                    ["world border bounds change", "world border bounds change"],
                    ["world border bounds finish change", "world border bounds finish change"],
                    ["world border center change", "world border center change"],
                    ["world init", "world init"],
                    ["world load", "world load"],
                    ["world save", "world save"],
                    ["world unload", "world unload"],
                    ["zombie break door", "zombie break door"],
                    ["anvil damage", "anvil damage"],
                    ["anvil prepare", "anvil prepare"],
                    ["AoE cloud effect", "AoE cloud effect"],
                    ["arm swing", "arm swing"],
                    ["armor change", "armor change"],
                    ["bat toggle sleep", "bat toggle sleep"],
                    ["beacon change effect", "beacon change effect"],
                    ["beacon effect", "beacon effect"],
                    ["beacon toggle", "beacon toggle"],
                    ["bed enter", "bed enter"],
                    ["bed leave", "bed leave"],
                    ["bell resonate", "bell resonate"],
                    ["bell ring", "bell ring"],
                    ["block damage", "block damage"],
                    ["block drop", "block drop"],
                    ["block fertilize", "block fertilize"],
                    ["block growth", "block growth"],
                    ["book edit", "book edit"]
                ]), "EVENT_TYPE");
            this.appendStatementInput("DO")
                .setCheck(null);
            this.setTooltip("Select from various uncommon events");
        }
    };

    // COMMAND BLOCK WITH CONTEXT MENU AND HINT
    Blockly.Blocks['skript_on_command'] = {
        init: function() {
            this.setColour("#FF6B19");

            // Command name
            this.appendDummyInput("COMMAND_NAME")
                .appendField("command /")
                .appendField(new Blockly.FieldTextInput("mycommand"), "CMD");

            // Hint for right-click
            var hintInput = this.appendDummyInput("HINT");
            hintInput.appendField(new Blockly.FieldLabel("Right-click to add/remove arguments"), "HINT_TEXT");

            // Arguments container - starts empty
            this.argCount_ = 0;
            this.arguments_ = [];

            // Permission input (optional)
            this.appendDummyInput("PERMISSION")
                .appendField("permission:")
                .appendField(new Blockly.FieldTextInput(""), "PERM");

            // Trigger section
            this.appendDummyInput("TRIGGER")
                .appendField("trigger:");
            this.appendStatementInput("DO")
                .setCheck(null);

            this.setTooltip("Right-click this block to add/remove arguments. Use arg-1, arg-2 blocks to access arguments.");
            this.setPreviousStatement(false);
            this.setNextStatement(false);

            // Add context menu
            this.customContextMenu = function(options) {
                // Add argument option
                var addOption = {
                    text: "âž• Add Argument",
                    enabled: true,
                    callback: function() {
                        this.addArgument();
                    }.bind(this)
                };
                options.push(addOption);

                // Remove argument option (if we have any)
                if (this.argCount_ > 0) {
                    var removeOption = {
                        text: "âž– Remove Argument",
                        enabled: true,
                        callback: function() {
                            this.removeArgument();
                        }.bind(this)
                    };
                    options.push(removeOption);
                }
            };
        },

        addArgument: function() {
            var index = this.argCount_;
            var argInput = this.appendDummyInput("ARG_" + index)
                .appendField("arg " + (index + 1) + ":")
                .appendField(new Blockly.FieldDropdown([
                    ["<text>", "<text>"],
                    ["<number>", "<number>"],
                    ["<player>", "<player>"],
                    ["<location>", "<location>"],
                    ["[<text>]", "[<text>]"],
                    ["[<number>]", "[<number>]"],
                    ["[<player>]", "[<player>]"],
                    ["[<location>]", "[<location>]"]
                ]), "ARG_TYPE_" + index);

            this.arguments_.push(index);
            this.argCount_++;

            // Move this input before PERMISSION
            this.moveInputBefore("ARG_" + index, "PERMISSION");

            // Update the workspace to refresh the block
            if (this.workspace) {
                this.workspace.resize();
            }
        },

        removeArgument: function() {
            if (this.argCount_ > 0) {
                var index = this.argCount_ - 1;
                this.removeInput("ARG_" + index);
                this.arguments_.pop();
                this.argCount_--;

                // Update the workspace to refresh the block
                if (this.workspace) {
                    this.workspace.resize();
                }
            }
        },

        mutationToDom: function() {
            var container = document.createElement('mutation');
            container.setAttribute('args', this.argCount_);
            for (var i = 0; i < this.argCount_; i++) {
                var argType = this.getFieldValue('ARG_TYPE_' + i);
                container.setAttribute('arg_type_' + i, argType);
            }
            return container;
        },

        domToMutation: function(xmlElement) {
            var argCount = parseInt(xmlElement.getAttribute('args'), 10) || 0;

            // Clear existing arguments
            while (this.argCount_ > 0) {
                this.removeArgument();
            }

            // Add saved arguments
            for (var i = 0; i < argCount; i++) {
                this.addArgument();
                var savedType = xmlElement.getAttribute('arg_type_' + i);
                if (savedType) {
                    this.setFieldValue(savedType, 'ARG_TYPE_' + i);
                }
            }
        }
    };

    // ARGUMENT USAGE BLOCKS - NOW IN COMMANDS CATEGORY
    Blockly.Blocks['skript_if_arg'] = {
        init: function() {
            this.setColour("#FF6B19");
            this.appendDummyInput()
                .appendField("if argument")
                .appendField(new Blockly.FieldNumber(1, 1), "ARG_INDEX")
                .appendField("is");
            this.appendValueInput("VALUE")
                .setCheck("String");
            this.appendStatementInput("THEN")
                .setCheck(null)
                .appendField("then:");
            this.setPreviousStatement(true, null);
            this.setNextStatement(true, null);
            this.setTooltip("Check if a command argument equals a value");
        }
    };

    // SPECIFIC ARGUMENT BLOCKS
    Blockly.Blocks['skript_get_arg_1'] = {
        init: function() {
            this.setColour("#FF6B19");
            this.appendDummyInput()
                .appendField("arg-1");
            this.setOutput(true, "String");
            this.setTooltip("Get the value of argument 1");
        }
    };

    Blockly.Blocks['skript_get_arg_2'] = {
        init: function() {
            this.setColour("#FF6B19");
            this.appendDummyInput()
                .appendField("arg-2");
            this.setOutput(true, "String");
            this.setTooltip("Get the value of argument 2");
        }
    };

    Blockly.Blocks['skript_get_arg_3'] = {
        init: function() {
            this.setColour("#FF6B19");
            this.appendDummyInput()
                .appendField("arg-3");
            this.setOutput(true, "String");
            this.setTooltip("Get the value of argument 3");
        }
    };

    Blockly.Blocks['skript_get_arg_custom'] = {
        init: function() {
            this.setColour("#FF6B19");
            this.appendDummyInput()
                .appendField("arg-")
                .appendField(new Blockly.FieldNumber(1, 1), "ARG_INDEX");
            this.setOutput(true, "String");
            this.setTooltip("Get the value of a specific argument");
        }
    };



    // ========================================
    // COMMON CONDITION BLOCK DEFINITIONS
    // ========================================
    // CONDITION BLOCKS
    Blockly.Blocks['skript_if_permission'] = {
        init: function() {
            this.setColour("#5BA55B");
            this.appendValueInput("PERMISSION")
                .setCheck("String")
                .appendField("if player has permission");
            this.appendStatementInput("THEN")
                .setCheck(null)
                .appendField("then:");
            this.setPreviousStatement(true, null);
            this.setNextStatement(true, null);
            this.setTooltip("Check permission");
        }
    };

    Blockly.Blocks['skript_if_else'] = {
        init: function() {
            this.setColour("#5BA55B");
            this.appendValueInput("CONDITION")
                .appendField("if");
            this.appendStatementInput("THEN")
                .setCheck(null)
                .appendField("then:");
            this.appendStatementInput("ELSE")
                .setCheck(null)
                .appendField("else:");
            this.setPreviousStatement(true, null);
            this.setNextStatement(true, null);
            this.setTooltip("If-else condition");
        }
    };

    Blockly.Blocks['skript_if_variable_set'] = {
        init: function() {
            this.setColour("#5BA55B");
            this.appendDummyInput()
                .appendField("if")
                .appendField(new Blockly.FieldTextInput("_variable"), "VAR")
                .appendField("is not set:");
            this.appendStatementInput("THEN")
                .setCheck(null);
            this.setPreviousStatement(true, null);
            this.setNextStatement(true, null);
            this.setTooltip("Check if variable is not set");
        }
    };

    Blockly.Blocks['skript_if_inv_name'] = {
        init: function() {
            this.setColour("#5BA55B");
            this.appendValueInput("NAME")
                .setCheck("String")
                .appendField("if name of event-inventory is");
            this.appendStatementInput("THEN")
                .setCheck(null)
                .appendField("then:");
            this.setPreviousStatement(true, null);
            this.setNextStatement(true, null);
            this.setTooltip("Check inventory name");
        }
    };

    Blockly.Blocks['skript_if_slot_clicked'] = {
        init: function() {
            this.setColour("#5BA55B");
            this.appendValueInput("SLOT")
                .setCheck("Number")
                .appendField("if event-slot is");
            this.appendStatementInput("THEN")
                .setCheck(null)
                .appendField("then:");
            this.setPreviousStatement(true, null);
            this.setNextStatement(true, null);
            this.setTooltip("Check if specific slot was clicked");
        }
    };

    Blockly.Blocks['skript_if_click_action'] = {
        init: function() {
            this.setColour("#5BA55B");
            this.appendDummyInput()
                .appendField("click action is")
                .appendField(new Blockly.FieldDropdown([
                    ["left mouse button", "left mouse button"],
                    ["right mouse button", "right mouse button"],
                    ["middle mouse button", "middle mouse button"]
                ]), "ACTION");
            this.setPreviousStatement(true, null);
            this.setNextStatement(true, null);
            this.setTooltip("Check click action");
        }
    };
    // Has permission condition
    Blockly.Blocks['skript_has_permission'] = {
        init: function() {
            this.setColour("#5BA55B");
            this.appendValueInput("PLAYER")
                .setCheck("String")
                .appendField("");
            this.appendDummyInput()
                .appendField(new Blockly.FieldDropdown([
                    ["has", "has"],
                    ["does not have", "does not have"]
                ]), "HAS_PERM")
                .appendField("permission");
            this.appendValueInput("PERMISSION")
                .setCheck("String");
            this.setInputsInline(true);
            this.setOutput(true, "Boolean");
            this.setTooltip("Check if player has permission");
        }
    };

    // Is online condition
    Blockly.Blocks['skript_is_online'] = {
        init: function() {
            this.setColour("#5BA55B");
            this.appendValueInput("PLAYER")
                .setCheck("String")
                .appendField("");
            this.appendDummyInput()
                .appendField(new Blockly.FieldDropdown([
                    ["is", "is"],
                    ["is not", "is not"]
                ]), "IS_ONLINE")
                .appendField("online");
            this.setInputsInline(true);
            this.setOutput(true, "Boolean");
            this.setTooltip("Check if player is online");
        }
    };

    // Is sneaking condition
    Blockly.Blocks['skript_is_sneaking'] = {
        init: function() {
            this.setColour("#5BA55B");
            this.appendValueInput("PLAYER")
                .setCheck("String")
                .appendField("");
            this.appendDummyInput()
                .appendField(new Blockly.FieldDropdown([
                    ["is", "is"],
                    ["is not", "is not"]
                ]), "IS_SNEAKING")
                .appendField("sneaking");
            this.setInputsInline(true);
            this.setOutput(true, "Boolean");
            this.setTooltip("Check if player is sneaking");
        }
    };

    // Is flying condition
    Blockly.Blocks['skript_is_flying'] = {
        init: function() {
            this.setColour("#5BA55B");
            this.appendValueInput("PLAYER")
                .setCheck("String")
                .appendField("");
            this.appendDummyInput()
                .appendField(new Blockly.FieldDropdown([
                    ["is", "is"],
                    ["is not", "is not"]
                ]), "IS_FLYING")
                .appendField("flying");
            this.setInputsInline(true);
            this.setOutput(true, "Boolean");
            this.setTooltip("Check if player is flying");
        }
    };

    // Is sprinting condition
    Blockly.Blocks['skript_is_sprinting'] = {
        init: function() {
            this.setColour("#5BA55B");
            this.appendValueInput("PLAYER")
                .setCheck("String")
                .appendField("");
            this.appendDummyInput()
                .appendField(new Blockly.FieldDropdown([
                    ["is", "is"],
                    ["is not", "is not"]
                ]), "IS_SPRINTING")
                .appendField("sprinting");
            this.setInputsInline(true);
            this.setOutput(true, "Boolean");
            this.setTooltip("Check if player is sprinting");
        }
    };

    // Is swimming condition
    Blockly.Blocks['skript_is_swimming'] = {
        init: function() {
            this.setColour("#5BA55B");
            this.appendValueInput("ENTITY")
                .setCheck("String")
                .appendField("");
            this.appendDummyInput()
                .appendField(new Blockly.FieldDropdown([
                    ["is", "is"],
                    ["is not", "is not"]
                ]), "IS_SWIMMING")
                .appendField("swimming");
            this.setInputsInline(true);
            this.setOutput(true, "Boolean");
            this.setTooltip("Check if entity is swimming");
        }
    };

    // Is gliding condition
    Blockly.Blocks['skript_is_gliding'] = {
        init: function() {
            this.setColour("#5BA55B");
            this.appendValueInput("ENTITY")
                .setCheck("String")
                .appendField("");
            this.appendDummyInput()
                .appendField(new Blockly.FieldDropdown([
                    ["is", "is"],
                    ["is not", "is not"]
                ]), "IS_GLIDING")
                .appendField("gliding");
            this.setInputsInline(true);
            this.setOutput(true, "Boolean");
            this.setTooltip("Check if entity is gliding");
        }
    };

    // Is sleeping condition
    Blockly.Blocks['skript_is_sleeping'] = {
        init: function() {
            this.setColour("#5BA55B");
            this.appendValueInput("ENTITY")
                .setCheck("String")
                .appendField("");
            this.appendDummyInput()
                .appendField(new Blockly.FieldDropdown([
                    ["is", "is"],
                    ["is not", "is not"]
                ]), "IS_SLEEPING")
                .appendField("sleeping");
            this.setInputsInline(true);
            this.setOutput(true, "Boolean");
            this.setTooltip("Check if entity is sleeping");
        }
    };

    // Is riding condition
    Blockly.Blocks['skript_is_riding'] = {
        init: function() {
            this.setColour("#5BA55B");
            this.appendValueInput("ENTITY")
                .setCheck("String")
                .appendField("");
            this.appendDummyInput()
                .appendField(new Blockly.FieldDropdown([
                    ["is", "is"],
                    ["is not", "is not"]
                ]), "IS_RIDING")
                .appendField("riding");
            this.setInputsInline(true);
            this.setOutput(true, "Boolean");
            this.setTooltip("Check if entity is riding something");
        }
    };

    // Is burning condition
    Blockly.Blocks['skript_is_burning'] = {
        init: function() {
            this.setColour("#5BA55B");
            this.appendValueInput("ENTITY")
                .setCheck("String")
                .appendField("");
            this.appendDummyInput()
                .appendField(new Blockly.FieldDropdown([
                    ["is", "is"],
                    ["is not", "is not"]
                ]), "IS_BURNING")
                .appendField("burning");
            this.setInputsInline(true);
            this.setOutput(true, "Boolean");
            this.setTooltip("Check if entity is on fire");
        }
    };

    // Is on ground condition
    Blockly.Blocks['skript_is_on_ground'] = {
        init: function() {
            this.setColour("#5BA55B");
            this.appendValueInput("ENTITY")
                .setCheck("String")
                .appendField("");
            this.appendDummyInput()
                .appendField(new Blockly.FieldDropdown([
                    ["is", "is"],
                    ["is not", "is not"]
                ]), "IS_ON_GROUND")
                .appendField("on ground");
            this.setInputsInline(true);
            this.setOutput(true, "Boolean");
            this.setTooltip("Check if entity is on ground");
        }
    };

    // Is in world condition
    Blockly.Blocks['skript_is_in_world'] = {
        init: function() {
            this.setColour("#5BA55B");
            this.appendValueInput("ENTITY")
                .setCheck("String")
                .appendField("");
            this.appendDummyInput()
                .appendField(new Blockly.FieldDropdown([
                    ["is", "is"],
                    ["is not", "is not"]
                ]), "IS_IN_WORLD")
                .appendField("in world");
            this.appendValueInput("WORLD")
                .setCheck("String");
            this.setInputsInline(true);
            this.setOutput(true, "Boolean");
            this.setTooltip("Check if entity is in specific world");
        }
    };

    // Is enchanted condition
    Blockly.Blocks['skript_is_enchanted'] = {
        init: function() {
            this.setColour("#5BA55B");
            this.appendValueInput("ITEM")
                .setCheck("String")
                .appendField("");
            this.appendDummyInput()
                .appendField(new Blockly.FieldDropdown([
                    ["is", "is"],
                    ["is not", "is not"]
                ]), "IS_ENCHANTED")
                .appendField("enchanted");
            this.setInputsInline(true);
            this.setOutput(true, "Boolean");
            this.setTooltip("Check if item is enchanted");
        }
    };

    // Is wearing condition
    Blockly.Blocks['skript_is_wearing'] = {
        init: function() {
            this.setColour("#5BA55B");
            this.appendValueInput("ENTITY")
                .setCheck("String")
                .appendField("");
            this.appendDummyInput()
                .appendField(new Blockly.FieldDropdown([
                    ["is", "is"],
                    ["is not", "is not"]
                ]), "IS_WEARING")
                .appendField("wearing");
            this.appendValueInput("ITEM")
                .setCheck("String");
            this.setInputsInline(true);
            this.setOutput(true, "Boolean");
            this.setTooltip("Check if entity is wearing specific item");
        }
    };

    // Is holding condition
    Blockly.Blocks['skript_is_holding'] = {
        init: function() {
            this.setColour("#5BA55B");
            this.appendValueInput("ENTITY")
                .setCheck("String")
                .appendField("");
            this.appendDummyInput()
                .appendField(new Blockly.FieldDropdown([
                    ["is", "is"],
                    ["is not", "is not"]
                ]), "IS_HOLDING")
                .appendField("holding");
            this.appendValueInput("ITEM")
                .setCheck("String");
            this.setInputsInline(true);
            this.setOutput(true, "Boolean");
            this.setTooltip("Check if entity is holding specific item");
        }
    };

    // Contains condition
    Blockly.Blocks['skript_contains'] = {
        init: function() {
            this.setColour("#5BA55B");
            this.appendValueInput("CONTAINER")
                .setCheck("String")
                .appendField("");
            this.appendDummyInput()
                .appendField(new Blockly.FieldDropdown([
                    ["contains", "contains"],
                    ["does not contain", "does not contain"]
                ]), "CONTAINS")
                .appendField("");
            this.appendValueInput("ITEM")
                .setCheck("String");
            this.setInputsInline(true);
            this.setOutput(true, "Boolean");
            this.setTooltip("Check if container contains item");
        }
    };

    // Is empty condition
    Blockly.Blocks['skript_is_empty'] = {
        init: function() {
            this.setColour("#5BA55B");
            this.appendValueInput("CONTAINER")
                .setCheck("String")
                .appendField("");
            this.appendDummyInput()
                .appendField(new Blockly.FieldDropdown([
                    ["is", "is"],
                    ["is not", "is not"]
                ]), "IS_EMPTY")
                .appendField("empty");
            this.setInputsInline(true);
            this.setOutput(true, "Boolean");
            this.setTooltip("Check if container is empty");
        }
    };

    // Chance condition
    Blockly.Blocks['skript_chance'] = {
        init: function() {
            this.setColour("#5BA55B");
            this.appendValueInput("CHANCE")
                .setCheck("Number")
                .appendField("chance of");
            this.appendDummyInput()
                .appendField("%");
            this.setInputsInline(true);
            this.setOutput(true, "Boolean");
            this.setTooltip("Random chance condition (0-100%)");
        }
    };

    // UNCOMMON CONDITIONS BLOCK WITH DYNAMIC INPUTS
    Blockly.Blocks['skript_uncommon_conditions'] = {
        init: function() {
            this.setColour("#5BA55B");

            // Main condition dropdown
            this.appendDummyInput()
                .appendField(new SearchableDropdown([
                    // No input needed
                    ["event is cancelled", "event is cancelled"],
                    ["brewing will consume fuel", "brewing will consume fuel"],
                    ["egg will hatch", "egg will hatch"],
                    ["leash will drop", "leash will drop"],
                    ["will consume boosting firework", "will consume boosting firework"],

                    // Entity input only
                    ["entity can duplicate", "entity can duplicate"],
                    ["entity is dashing", "entity is dashing"],
                    ["entity can age", "entity can age"],
                    ["entity can breed", "entity can breed"],
                    ["entity can despawn", "entity can despawn"],
                    ["entity can pick up items", "entity can pick up items"],
                    ["entity is adult", "entity is adult"],
                    ["entity is baby", "entity is baby"],
                    ["entity is charged", "entity is charged"],
                    ["entity is climbing", "entity is climbing"],
                    ["entity is eating", "entity is eating"],
                    ["entity is in love", "entity is in love"],
                    ["entity is invisible", "entity is invisible"],
                    ["entity is leashed", "entity is leashed"],
                    ["entity is poisoned", "entity is poisoned"],
                    ["entity is riptiding", "entity is riptiding"],
                    ["entity is saddled", "entity is saddled"],
                    ["entity is screaming", "entity is screaming"],
                    ["entity is silent", "entity is silent"],
                    ["entity is tameable", "entity is tameable"],
                    ["entity is tamed", "entity is tamed"],

                    // Block input only
                    ["block is sedated", "block is sedated"],
                    ["block is resonating", "block is resonating"],
                    ["block is ringing", "block is ringing"],
                    ["block is redstone powered", "block is redstone powered"],
                    ["block is passable", "block is passable"],
                    ["block is solid", "block is solid"],
                    ["block is transparent", "block is transparent"],

                    // Player input only
                    ["player has played before", "player has played before"],
                    ["player has resource pack", "player has resource pack"],
                    ["player has scoreboard tag", "player has scoreboard tag"],
                    ["player is banned", "player is banned"],
                    ["player is operator", "player is operator"],
                    ["player is whitelisted", "player is whitelisted"],
                    ["player can build", "player can build"],
                    ["player can fly", "player can fly"],
                    ["player can see entity", "player can see entity"],
                    ["player is pressing key", "player is pressing key"],

                    // Item input only
                    ["item is block", "item is block"],
                    ["item is edible", "item is edible"],
                    ["item is flammable", "item is flammable"],
                    ["item is fuel", "item is fuel"],
                    ["item is interactable", "item is interactable"],
                    ["item is stackable", "item is stackable"],
                    ["item is unbreakable", "item is unbreakable"],

                    // Text input only
                    ["text is alphanumeric", "text is alphanumeric"],
                    ["text starts with", "text starts with"],
                    ["text ends with", "text ends with"],
                    ["text matches", "text matches"],

                    // Special cases with dropdowns
                    ["damage cause is", "damage cause is"],
                    ["weather is", "weather is"],
                    ["PvP is enabled", "PvP is enabled"],

                    // Multiple inputs
                    ["player has permission", "player has permission"],
                    ["entity is wearing", "entity is wearing"],
                    ["entity is holding", "entity is holding"],
                    ["inventory contains", "inventory contains"],
                    ["inventory can hold", "inventory can hold"],
                    ["location is within", "location is within"],
                    ["item is preferred tool", "item is preferred tool"]
                ]), "CONDITION_TYPE");

            this.setOutput(true, "Boolean");
            this.setTooltip("Select from various uncommon conditions");

            // Initialize with no additional inputs
            this.updateShape_();

            // Update inputs when condition type changes
            this.setOnChange(function(changeEvent) {
                if (changeEvent.type === Blockly.Events.BLOCK_CHANGE &&
                    changeEvent.element === 'field' &&
                    changeEvent.name === 'CONDITION_TYPE') {
                    this.updateShape_();
                }
            }.bind(this));
        },

        updateShape_: function() {
            var conditionType = this.getFieldValue('CONDITION_TYPE');

            // Remove all inputs except the first one (CONDITION_TYPE)
            while (this.inputList.length > 1) {
                this.removeInput(this.inputList[this.inputList.length - 1].name);
            }

            // Add appropriate inputs based on condition type
            switch(conditionType) {
                // No additional inputs needed
                case "event is cancelled":
                case "brewing will consume fuel":
                case "egg will hatch":
                case "leash will drop":
                case "will consume boosting firework":
                    // No inputs to add
                    break;

                // Entity input
                case "entity can duplicate":
                case "entity is dashing":
                case "entity can age":
                case "entity can breed":
                case "entity can despawn":
                case "entity can pick up items":
                case "entity is adult":
                case "entity is baby":
                case "entity is charged":
                case "entity is climbing":
                case "entity is eating":
                case "entity is in love":
                case "entity is invisible":
                case "entity is leashed":
                case "entity is poisoned":
                case "entity is riptiding":
                case "entity is saddled":
                case "entity is screaming":
                case "entity is silent":
                case "entity is tameable":
                case "entity is tamed":
                    this.appendValueInput("ENTITY")
                        .setCheck("String")
                        .appendField("entity:");
                    break;

                // Block input
                case "block is sedated":
                case "block is resonating":
                case "block is ringing":
                case "block is redstone powered":
                case "block is passable":
                case "block is solid":
                case "block is transparent":
                    this.appendValueInput("BLOCK")
                        .setCheck("String")
                        .appendField("block:");
                    break;

                // Player input
                case "player has played before":
                case "player has resource pack":
                case "player has scoreboard tag":
                case "player is banned":
                case "player is operator":
                case "player is whitelisted":
                case "player can build":
                case "player can fly":
                case "player can see entity":
                case "player is pressing key":
                    this.appendValueInput("PLAYER")
                        .setCheck("String")
                        .appendField("player:");
                    break;

                // Item input
                case "item is block":
                case "item is edible":
                case "item is flammable":
                case "item is fuel":
                case "item is interactable":
                case "item is stackable":
                case "item is unbreakable":
                    this.appendValueInput("ITEM")
                        .setCheck("String")
                        .appendField("item:");
                    break;

                // Text input
                case "text is alphanumeric":
                case "text starts with":
                case "text ends with":
                case "text matches":
                    this.appendValueInput("TEXT")
                        .setCheck("String")
                        .appendField("text:");
                    break;

                // Special cases with dropdowns
                case "damage cause is":
                    this.appendDummyInput()
                        .appendField(new Blockly.FieldDropdown([
                            ["contact", "contact"],
                            ["entity attack", "entity attack"],
                            ["projectile", "projectile"],
                            ["suffocation", "suffocation"],
                            ["fall", "fall"],
                            ["fire", "fire"],
                            ["fire tick", "fire tick"],
                            ["melting", "melting"],
                            ["lava", "lava"],
                            ["drowning", "drowning"],
                            ["block explosion", "block explosion"],
                            ["entity explosion", "entity explosion"],
                            ["void", "void"],
                            ["lightning", "lightning"],
                            ["suicide", "suicide"],
                            ["starvation", "starvation"],
                            ["poison", "poison"],
                            ["magic", "magic"],
                            ["wither", "wither"],
                            ["falling block", "falling block"],
                            ["thorns", "thorns"],
                            ["dragon breath", "dragon breath"],
                            ["custom", "custom"],
                            ["fly into wall", "fly into wall"],
                            ["hot floor", "hot floor"],
                            ["cramming", "cramming"]
                        ]), "DAMAGE_CAUSE");
                    break;

                case "weather is":
                    this.appendDummyInput()
                        .appendField(new Blockly.FieldDropdown([
                            ["clear", "clear"],
                            ["rain", "rain"],
                            ["thunder", "thunder"]
                        ]), "WEATHER_TYPE");
                    break;

                case "PvP is enabled":
                    this.appendValueInput("WORLD")
                        .setCheck("String")
                        .appendField("in world:");
                    break;

                // Multiple inputs
                case "player has permission":
                    this.appendValueInput("PLAYER")
                        .setCheck("String")
                        .appendField("player:");
                    this.appendValueInput("PERMISSION")
                        .setCheck("String")
                        .appendField("permission:");
                    break;

                case "entity is wearing":
                    this.appendValueInput("ENTITY")
                        .setCheck("String")
                        .appendField("entity:");
                    this.appendValueInput("ITEM")
                        .setCheck("String")
                        .appendField("item:");
                    break;

                case "entity is holding":
                    this.appendValueInput("ENTITY")
                        .setCheck("String")
                        .appendField("entity:");
                    this.appendValueInput("ITEM")
                        .setCheck("String")
                        .appendField("item:");
                    break;

                case "inventory contains":
                    this.appendValueInput("INVENTORY")
                        .setCheck("String")
                        .appendField("inventory:");
                    this.appendValueInput("ITEM")
                        .setCheck("String")
                        .appendField("item:");
                    break;

                case "inventory can hold":
                    this.appendValueInput("INVENTORY")
                        .setCheck("String")
                        .appendField("inventory:");
                    this.appendValueInput("ITEM")
                        .setCheck("String")
                        .appendField("item:");
                    break;

                case "location is within":
                    this.appendValueInput("LOCATION")
                        .setCheck("String")
                        .appendField("location:");
                    this.appendValueInput("AREA")
                        .setCheck("String")
                        .appendField("area:");
                    break;

                case "item is preferred tool":
                    this.appendValueInput("ITEM")
                        .setCheck("String")
                        .appendField("item:");
                    this.appendValueInput("BLOCK")
                        .setCheck("String")
                        .appendField("for block:");
                    break;
            }

            // Update the block's appearance
            if (this.workspace) {
                this.workspace.resize();
            }
        },

        mutationToDom: function() {
            var container = document.createElement('mutation');
            container.setAttribute('condition_type', this.getFieldValue('CONDITION_TYPE'));
            return container;
        },

        domToMutation: function(xmlElement) {
            var conditionType = xmlElement.getAttribute('condition_type');
            if (conditionType) {
                this.setFieldValue(conditionType, 'CONDITION_TYPE');
                this.updateShape_();
            }
        }
    };
    // LOOP BLOCKS
    Blockly.Blocks['skript_loop_times'] = {
        init: function() {
            this.setColour("#FFBF00");
            this.appendValueInput("TIMES")
                .setCheck("Number")
                .appendField("loop");
            this.appendDummyInput()
                .appendField("times:");
            this.appendStatementInput("DO")
                .setCheck(null);
            this.setPreviousStatement(true, null);
            this.setNextStatement(true, null);
            this.setTooltip("Repeat N times");
        }
    };

    Blockly.Blocks['skript_loop_players'] = {
        init: function() {
            this.setColour("#FFBF00");
            this.appendDummyInput()
                .appendField("loop all players:");
            this.appendStatementInput("DO")
                .setCheck(null);
            this.setPreviousStatement(true, null);
            this.setNextStatement(true, null);
            this.setTooltip("Loop through all players");
        }
    };

    // OBJECTS BLOCKS
    Blockly.Blocks['skript_player'] = {
        init: function() {
            this.setColour("#4EC9B0");
            this.appendDummyInput()
                .appendField("player");
            this.setOutput(true, "String");
            this.setTooltip("The current player");
        }
    };

    Blockly.Blocks['skript_event_player'] = {
        init: function() {
            this.setColour("#4EC9B0");
            this.appendDummyInput()
                .appendField("event-player");
            this.setOutput(true, "String");
            this.setTooltip("The player who triggered the event");
        }
    };

    Blockly.Blocks['skript_loop_player'] = {
        init: function() {
            this.setColour("#4EC9B0");
            this.appendDummyInput()
                .appendField("loop-player");
            this.setOutput(true, "String");
            this.setTooltip("The current player in a loop");
        }
    };

    Blockly.Blocks['skript_clicked_slot'] = {
        init: function() {
            this.setColour("#4EC9B0");
            this.appendDummyInput()
                .appendField("clicked slot");
            this.setOutput(true, "Number");
            this.setTooltip("The slot that was clicked");
        }
    };

    Blockly.Blocks['skript_item'] = {
        init: function() {
            this.setColour("#4EC9B0");
            this.appendDummyInput()
                .appendField(new Blockly.FieldDropdown([
                    ["diamond", "diamond"],
                    ["cookie", "cookie"],
                    ["red stained glass pane", "red stained glass pane"],
                    ["copper ingot", "copper ingot"],
                    ["cactus", "cactus"],
                    ["wooden pickaxe", "wooden pickaxe"],
                    ["iron ingot", "iron ingot"],
                    ["gold ingot", "gold ingot"],
                    ["oak door", "oak door"],
                    ["ender pearl", "ender pearl"],
                    ["oak boat", "oak boat"],
                    ["brewing stand", "brewing stand"],
                    ["end portal frame", "end portal frame"],
                    ["clock", "clock"],
                    ["breeze rod", "breeze rod"],
                    ["arrow", "arrow"],
                    ["spectral arrow", "spectral arrow"],
                    ["red concrete", "red concrete"]
                ]), "ITEM");
            this.setOutput(true, "String");
            this.setTooltip("An item");
        }
    };

    Blockly.Blocks['skript_player_name'] = {
        init: function() {
            this.setColour("#4EC9B0");
            this.appendDummyInput()
                .appendField("player's name");
            this.setOutput(true, "String");
            this.setTooltip("The player's name");
        }
    };

    Blockly.Blocks['skript_player_uuid'] = {
        init: function() {
            this.setColour("#4EC9B0");
            this.appendDummyInput()
                .appendField("player's uuid");
            this.setOutput(true, "String");
            this.setTooltip("The player's UUID");
        }
    };

    Blockly.Blocks['skript_variable'] = {
        init: function() {
            this.setColour("#4EC9B0");
            this.appendDummyInput()
                .appendField("{")
                .appendField(new Blockly.FieldTextInput("_variable"), "VAR")
                .appendField("}");
            this.setOutput(true);
            this.setTooltip("Get variable value");
        }
    };

    Blockly.Blocks['skript_event_world'] = {
        init: function() {
            this.setColour("#4EC9B0");
            this.appendDummyInput()
                .appendField("event-world");
            this.setOutput(true, "String");
            this.setTooltip("The world where event occurred");
        }
    };

    Blockly.Blocks['skript_event_entity'] = {
        init: function() {
            this.setColour("#4EC9B0");
            this.appendDummyInput()
                .appendField("event-entity");
            this.setOutput(true, "String");
            this.setTooltip("The entity involved in event");
        }
    };

    Blockly.Blocks['skript_event_location'] = {
        init: function() {
            this.setColour("#4EC9B0");
            this.appendDummyInput()
                .appendField("event-location");
            this.setOutput(true, "String");
            this.setTooltip("The location where event occurred");
        }
    };

    Blockly.Blocks['skript_event_block'] = {
        init: function() {
            this.setColour("#4EC9B0");
            this.appendDummyInput()
                .appendField("event-block");
            this.setOutput(true, "String");
            this.setTooltip("The block involved in event");
        }
    };

    Blockly.Blocks['skript_event_inventory'] = {
        init: function() {
            this.setColour("#4EC9B0");
            this.appendDummyInput()
                .appendField("event-inventory");
            this.setOutput(true, "String");
            this.setTooltip("The inventory involved in event");
        }
    };

    Blockly.Blocks['skript_event_item'] = {
        init: function() {
            this.setColour("#4EC9B0");
            this.appendDummyInput()
                .appendField("event-item");
            this.setOutput(true, "String");
            this.setTooltip("The item involved in event");
        }
    };

    // FUNCTION BLOCKS
    Blockly.Blocks['skript_function'] = {
        init: function() {
            this.setColour("#9A5CA6");

            // Function name and return type
            this.appendDummyInput("FUNCTION_NAME")
                .appendField("function")
                .appendField(new Blockly.FieldTextInput("myFunction"), "NAME")
                .appendField("(");

            // Hint for right-click
            var hintInput = this.appendDummyInput("HINT");
            hintInput.appendField(new Blockly.FieldLabel("Right-click to add/remove args"), "HINT_TEXT");

            // Arguments container - starts empty
            this.argCount_ = 0;
            this.arguments_ = [];

            // Close parenthesis and return type
            this.appendDummyInput("RETURN_TYPE")
                .appendField(") returns ")
                .appendField(new Blockly.FieldDropdown([
                    ["text", "text"],
                    ["number", "number"],
                    ["boolean", "boolean"],
                    ["player", "player"],
                    ["location", "location"],
                    ["item", "item"],
                    ["none", "none"]
                ]), "RETURN")
                .appendField(":");

            // Function body
            this.appendStatementInput("DO")
                .setCheck(null);

            this.setTooltip("Right-click to add/remove arguments");
            this.setPreviousStatement(false);
            this.setNextStatement(false);

            // Add context menu
            this.customContextMenu = function(options) {
                // Add argument option
                var addOption = {
                    text: "âž• Add Argument",
                    enabled: true,
                    callback: function() {
                        this.addArgument();
                    }.bind(this)
                };
                options.push(addOption);

                // Remove argument option (if we have any)
                if (this.argCount_ > 0) {
                    var removeOption = {
                        text: "âž– Remove Argument",
                        enabled: true,
                        callback: function() {
                            this.removeArgument();
                        }.bind(this)
                    };
                    options.push(removeOption);
                }
            };
        },

        addArgument: function() {
            var index = this.argCount_;
            var argInput = this.appendDummyInput("ARG_" + index)
                .appendField(index === 0 ? "" : ", ")
                .appendField(new Blockly.FieldTextInput("arg" + (index + 1)), "ARG_NAME_" + index)
                .appendField(": ")
                .appendField(new Blockly.FieldDropdown([
                    ["text", "text"],
                    ["number", "number"],
                    ["boolean", "boolean"],
                    ["player", "player"],
                    ["location", "location"],
                    ["item", "item"]
                ]), "ARG_TYPE_" + index);

            this.arguments_.push(index);
            this.argCount_++;

            // Move this input before RETURN_TYPE
            this.moveInputBefore("ARG_" + index, "RETURN_TYPE");

            // Update the workspace to refresh the block
            if (this.workspace) {
                this.workspace.resize();
            }
        },

        removeArgument: function() {
            if (this.argCount_ > 0) {
                var index = this.argCount_ - 1;
                this.removeInput("ARG_" + index);
                this.arguments_.pop();
                this.argCount_--;

                // Update the workspace to refresh the block
                if (this.workspace) {
                    this.workspace.resize();
                }
            }
        },

        mutationToDom: function() {
            var container = document.createElement('mutation');
            container.setAttribute('args', this.argCount_);
            for (var i = 0; i < this.argCount_; i++) {
                var argName = this.getFieldValue('ARG_NAME_' + i);
                var argType = this.getFieldValue('ARG_TYPE_' + i);
                container.setAttribute('arg_name_' + i, argName);
                container.setAttribute('arg_type_' + i, argType);
            }
            return container;
        },

        domToMutation: function(xmlElement) {
            var argCount = parseInt(xmlElement.getAttribute('args'), 10) || 0;

            // Clear existing arguments
            while (this.argCount_ > 0) {
                this.removeArgument();
            }

            // Add saved arguments
            for (var i = 0; i < argCount; i++) {
                this.addArgument();
                var savedName = xmlElement.getAttribute('arg_name_' + i);
                var savedType = xmlElement.getAttribute('arg_type_' + i);
                if (savedName) {
                    this.setFieldValue(savedName, 'ARG_NAME_' + i);
                }
                if (savedType) {
                    this.setFieldValue(savedType, 'ARG_TYPE_' + i);
                }
            }
        }
    };
    // ========================================
    // NEW SKRIPT HUB SYNTAX TYPE BLOCKS
    // ========================================

    // ATTRIBUTE TYPE BLOCK
    Blockly.Blocks['skript_attribute_type'] = {
        init: function() {
            this.setColour("#4EC9B0");
            this.appendDummyInput()
                .appendField(new SearchableDropdown([
                    ["attack damage", "generic.attack_damage"],
                    ["attack speed", "generic.attack_speed"],
                    ["max health", "generic.max_health"],
                    ["movement speed", "generic.movement_speed"],
                    ["armor", "generic.armor"],
                    ["armor toughness", "generic.armor_toughness"],
                    ["luck", "generic.luck"],
                    ["knockback resistance", "generic.knockback_resistance"],
                    ["follow range", "generic.follow_range"],
                    ["jump strength", "generic.jump_strength"],
                    ["gravity", "generic.gravity"]
                ]), "ATTRIBUTE_TYPE");
            this.setOutput(true, "String");
            this.setTooltip("Entity attribute type");
        }
    };

    // BANNER PATTERN TYPE BLOCK
    Blockly.Blocks['skript_banner_pattern_type'] = {
        init: function() {
            this.setColour("#4EC9B0");
            this.appendDummyInput()
                .appendField(new SearchableDropdown([
                    ["base", "base"],
                    ["border", "border"],
                    ["bricks", "bricks"],
                    ["circle", "circle"],
                    ["creeper", "creeper"],
                    ["cross", "cross"],
                    ["flower", "flower"],
                    ["globe", "globe"],
                    ["mojang", "mojang"],
                    ["skull", "skull"],
                    ["stripe", "stripe"]
                ]), "BANNER_PATTERN");
            this.setOutput(true, "String");
            this.setTooltip("Banner pattern type");
        }
    };

    // DAMAGE CAUSE BLOCK
    Blockly.Blocks['skript_damage_cause'] = {
        init: function() {
            this.setColour("#4EC9B0");
            this.appendDummyInput()
                .appendField(new SearchableDropdown([
                    ["attack", "attack"],
                    ["projectile", "projectile"],
                    ["suffocation", "suffocation"],
                    ["fall", "fall"],
                    ["fire", "fire"],
                    ["lava", "lava"],
                    ["drowning", "drowning"],
                    ["explosion", "explosion"],
                    ["void", "void"],
                    ["lightning", "lightning"],
                    ["poison", "poison"],
                    ["magic", "magic"],
                    ["wither", "wither"],
                    ["starvation", "starvation"]
                ]), "DAMAGE_CAUSE");
            this.setOutput(true, "String");
            this.setTooltip("Damage cause type");
        }
    };

    // ENCHANTMENT TYPE BLOCK
    Blockly.Blocks['skript_enchantment_type'] = {
        init: function() {
            this.setColour("#4EC9B0");
            this.appendDummyInput()
                .appendField(new SearchableDropdown([
                    ["sharpness", "sharpness"],
                    ["protection", "protection"],
                    ["efficiency", "efficiency"],
                    ["fortune", "fortune"],
                    ["silk touch", "silk_touch"],
                    ["power", "power"],
                    ["flame", "flame"],
                    ["infinity", "infinity"],
                    ["unbreaking", "unbreaking"],
                    ["mending", "mending"],
                    ["frost walker", "frost_walker"],
                    ["depth strider", "depth_strider"],
                    ["aqua affinity", "aqua_affinity"],
                    ["respiration", "respiration"]
                ]), "ENCHANTMENT");
            this.setOutput(true, "String");
            this.setTooltip("Enchantment type");
        }
    };

    // POTION EFFECT TYPE BLOCK
    Blockly.Blocks['skript_potion_effect_type'] = {
        init: function() {
            this.setColour("#4EC9B0");
            this.appendDummyInput()
                .appendField(new SearchableDropdown([
                    ["speed", "speed"],
                    ["slowness", "slowness"],
                    ["strength", "strength"],
                    ["jump boost", "jump_boost"],
                    ["regeneration", "regeneration"],
                    ["fire resistance", "fire_resistance"],
                    ["water breathing", "water_breathing"],
                    ["invisibility", "invisibility"],
                    ["night vision", "night_vision"],
                    ["poison", "poison"],
                    ["weakness", "weakness"],
                    ["instant health", "instant_health"],
                    ["instant damage", "instant_damage"]
                ]), "POTION_EFFECT");
            this.setOutput(true, "String");
            this.setTooltip("Potion effect type");
        }
    };

    // SOUND CATEGORY BLOCK
    Blockly.Blocks['skript_sound_category'] = {
        init: function() {
            this.setColour("#4EC9B0");
            this.appendDummyInput()
                .appendField(new SearchableDropdown([
                    ["master", "master"],
                    ["music", "music"],
                    ["record", "record"],
                    ["weather", "weather"],
                    ["block", "block"],
                    ["hostile", "hostile"],
                    ["neutral", "neutral"],
                    ["player", "player"],
                    ["ambient", "ambient"],
                    ["voice", "voice"]
                ]), "SOUND_CATEGORY");
            this.setOutput(true, "String");
            this.setTooltip("Sound category");
        }
    };

    // ENTITY TYPE BLOCK
    Blockly.Blocks['skript_entity_type'] = {
        init: function() {
            this.setColour("#4EC9B0");
            this.appendDummyInput()
                .appendField(new SearchableDropdown([
                    ["zombie", "zombie"],
                    ["skeleton", "skeleton"],
                    ["creeper", "creeper"],
                    ["spider", "spider"],
                    ["enderman", "enderman"],
                    ["witch", "witch"],
                    ["slime", "slime"],
                    ["cow", "cow"],
                    ["pig", "pig"],
                    ["sheep", "sheep"],
                    ["chicken", "chicken"],
                    ["wolf", "wolf"],
                    ["villager", "villager"],
                    ["horse", "horse"]
                ]), "ENTITY_TYPE");
            this.setOutput(true, "String");
            this.setTooltip("Entity type");
        }
    };

    // VISUAL EFFECT TYPE BLOCK
    Blockly.Blocks['skript_visual_effect'] = {
        init: function() {
            this.setColour("#4EC9B0");
            this.appendDummyInput()
                .appendField(new SearchableDropdown([
                    ["flame", "flame"],
                    ["heart", "heart"],
                    ["smoke", "smoke"],
                    ["critical", "critical"],
                    ["magic critical", "magic_critical"],
                    ["firework", "firework"],
                    ["lava pop", "lava_pop"],
                    ["water splash", "water_splash"],
                    ["portal", "portal"],
                    ["enchant", "enchant"],
                    ["note", "note"],
                    ["dragon breath", "dragon_breath"],
                    ["end rod", "end_rod"],
                    ["damage indicator", "damage_indicator"]
                ]), "VISUAL_EFFECT");
            this.setOutput(true, "String");
            this.setTooltip("Visual/particle effect type");
        }
    };

    // FIREWORK EFFECT TYPE BLOCK
    Blockly.Blocks['skript_firework_effect'] = {
        init: function() {
            this.setColour("#4EC9B0");
            this.appendDummyInput()
                .appendField(new SearchableDropdown([
                    ["ball", "ball"],
                    ["large ball", "large_ball"],
                    ["star", "star"],
                    ["creeper", "creeper"],
                    ["burst", "burst"]
                ]), "FIREWORK_TYPE");
            this.setOutput(true, "String");
            this.setTooltip("Firework effect type");
        }
    };

    // INVENTORY TYPE BLOCK
    Blockly.Blocks['skript_inventory_type'] = {
        init: function() {
            this.setColour("#4EC9B0");
            this.appendDummyInput()
                .appendField(new SearchableDropdown([
                    ["chest", "chest"],
                    ["ender chest", "ender_chest"],
                    ["dispenser", "dispenser"],
                    ["furnace", "furnace"],
                    ["workbench", "workbench"],
                    ["enchanting table", "enchanting_table"],
                    ["brewing stand", "brewing_stand"],
                    ["villager", "villager"],
                    ["beacon", "beacon"],
                    ["anvil", "anvil"],
                    ["hopper", "hopper"],
                    ["dropper", "dropper"],
                    ["shulker box", "shulker_box"]
                ]), "INVENTORY_TYPE");
            this.setOutput(true, "String");
            this.setTooltip("Inventory type");
        }
    };
    Blockly.Blocks['skript_return'] = {
        init: function() {
            this.setColour("#9A5CA6");
            this.appendValueInput("VALUE")
                .appendField("return");
            this.setInputsInline(true);
            this.setPreviousStatement(true, null);
            this.setTooltip("Return a value from function");
        }
    };

    Blockly.Blocks['skript_call_function'] = {
        init: function() {
            this.setColour("#9A5CA6");
            this.appendValueInput("ARG")
                .appendField(new Blockly.FieldTextInput("myFunction"), "NAME")
                .appendField("(");
            this.appendDummyInput()
                .appendField(")");
            this.setInputsInline(true);
            this.setOutput(true);
            this.setTooltip("Call a function");
        }
    };

    // VALUE BLOCKS
    Blockly.Blocks['skript_text'] = {
        init: function() {
            this.setColour("#59C059");
            this.appendDummyInput()
                .appendField('"')
                .appendField(new Blockly.FieldTextInput("Hello"), "TEXT")
                .appendField('"');
            this.setOutput(true, "String");
            this.setTooltip("A text value");
        }
    };

    Blockly.Blocks['skript_number'] = {
        init: function() {
            this.setColour("#59C059");
            this.appendDummyInput()
                .appendField(new Blockly.FieldNumber(0), "NUM");
            this.setOutput(true, "Number");
            this.setTooltip("A number value");
        }
    };

    // MATH BLOCKS
    Blockly.Blocks['skript_math_op'] = {
        init: function() {
            this.setColour("#5C68A6");
            this.appendValueInput("A")
                .setCheck("Number");
            this.appendValueInput("B")
                .setCheck("Number")
                .appendField(new Blockly.FieldDropdown([
                    ["+", "+"],
                    ["-", "-"],
                    ["*", "*"],
                    ["/", "/"]
                ]), "OP");
            this.setInputsInline(true);
            this.setOutput(true, "Number");
            this.setTooltip("Math operation");
        }
    };

    Blockly.Blocks['skript_compare'] = {
        init: function() {
            this.setColour("#5C68A6");
            this.appendValueInput("A");
            this.appendValueInput("B")
                .appendField(new Blockly.FieldDropdown([
                    ["=", "="],
                    ["â‰ ", "is not"],
                    [">", ">"],
                    ["â‰¥", ">="],
                    ["<", "<"],
                    ["â‰¤", "<="]
                ]), "OP");
            this.setInputsInline(true);
            this.setOutput(true, "Boolean");
            this.setTooltip("Compare values");
        }
    };

    Blockly.Blocks['skript_string_concat'] = {
        init: function() {
            this.setColour("#5C68A6");
            this.appendValueInput("A")
                .setCheck("String");
            this.appendValueInput("B")
                .setCheck("String")
                .appendField("+");
            this.setInputsInline(true);
            this.setOutput(true, "String");
            this.setTooltip("Concatenate strings");
        }
    };

    Blockly.Blocks['skript_round_up'] = {
        init: function() {
            this.setColour("#5C68A6");
            this.appendValueInput("NUM")
                .setCheck("Number")
                .appendField("rounded up (");
            this.appendDummyInput()
                .appendField(")");
            this.setInputsInline(true);
            this.setOutput(true, "Number");
            this.setTooltip("Round up a number");
        }
    };
    // SearchableDropdown field class - adds search to existing dropdowns
    // SearchableDropdown field class - adds search to existing dropdowns
    class SearchableDropdown extends Blockly.FieldDropdown {
        constructor(menuGenerator) {
            super(menuGenerator);
        }

        showEditor_() {
            // Store reference to this for event handlers
            const that = this;

            // Create the dropdown container
            const dropdown = document.createElement('div');
            dropdown.className = 'searchable-dropdown';

            // Create search input
            const searchInput = document.createElement('input');
            searchInput.type = 'text';
            searchInput.placeholder = 'Type to search...';
            searchInput.style.marginBottom = '5px';

            // Get the original dropdown content
            const contentDiv = Blockly.DropDownDiv.getContentDiv();
            contentDiv.innerHTML = '';

            // Add search input first
            contentDiv.appendChild(searchInput);

            // Create and populate the select element
            const select = document.createElement('select');
            select.size = 15;
            select.style.width = '100%';
            select.style.border = '1px solid #ddd';
            select.style.borderRadius = '3px';
            select.style.fontSize = '12px';

            // Populate options
            const options = this.getOptions();
            options.forEach(option => {
                const optionElement = document.createElement('option');
                optionElement.value = option[1];
                optionElement.textContent = option[0];
                select.appendChild(optionElement);
            });

            // Add select to content
            contentDiv.appendChild(select);

            // Add search functionality
            searchInput.addEventListener('input', function(e) {
                const searchTerm = e.target.value.toLowerCase();
                const options = select.options;

                for (let i = 0; i < options.length; i++) {
                    const option = options[i];
                    const text = option.textContent.toLowerCase();
                    option.style.display = text.includes(searchTerm) ? '' : 'none';
                }
            });

            // Handle selection
            select.addEventListener('click', function(e) {
                if (e.target.tagName === 'OPTION') {
                    that.setValue(e.target.value);
                    Blockly.DropDownDiv.hide();
                }
            });

            select.addEventListener('keydown', function(e) {
                if (e.key === 'Enter') {
                    that.setValue(select.value);
                    Blockly.DropDownDiv.hide();
                }
            });

            // Show the dropdown
            Blockly.DropDownDiv.showPositionedByBlock(this, this.sourceBlock_, function() {
                // Cleanup when dropdown closes
            });

            // Focus the search input
            setTimeout(() => searchInput.focus(), 0);
        }
    }
    // ========================================
    // CODE GENERATOR
    // ========================================

    var SkriptGenerator = new Blockly.Generator('Skript');
    SkriptGenerator.INDENT = '    ';
    SkriptGenerator.ORDER_ATOMIC = 0;
    SkriptGenerator.ORDER_NONE = 99;

    // Fix for deprecated generator pattern
    SkriptGenerator.forBlock = {};

    SkriptGenerator.init = function(workspace) {};
    SkriptGenerator.finish = function(code) { return code; };

    SkriptGenerator.scrub_ = function(block, code, opt_thisOnly) {
        var nextBlock = block.nextConnection && block.nextConnection.targetBlock();
        var nextCode = opt_thisOnly ? '' : SkriptGenerator.blockToCode(nextBlock);
        return code + nextCode;
    };

    function isBlockInsideEventOrFunction(block) {
        while (block) {
            var type = block.type;
            if (type === 'skript_on_join' || type === 'skript_on_rightclick' ||
                type === 'skript_on_break' || type === 'skript_on_death' ||
                type === 'skript_on_chat' || type === 'skript_on_command' ||
                type === 'skript_on_inv_click' || type === 'skript_every_second' ||
                type === 'skript_function' || type === 'skript_on_time' ||
                type === 'skript_periodical' || type === 'skript_periodical_world' ||
                type === 'skript_uncommon_events') {
                return true;
            }
            block = block.getSurroundParent();
        }
        return false;
    }

    // Helper function to properly indent statements
    function indentStatements(statements, indentLevel) {
        if (!statements) return '';
        var indent = '';
        for (var i = 0; i < indentLevel; i++) {
            indent += SkriptGenerator.INDENT;
        }
        return statements.split('\n').map(function(line) {
            return line ? indent + line : line;
        }).join('\n');
    }

    // EVENT GENERATORS
    SkriptGenerator.forBlock['skript_on_join'] = function(block) {
        var statements = SkriptGenerator.statementToCode(block, 'DO');
        return 'on join:\n' + indentStatements(statements, 1);
    };
    // ========================================
    // NEW FUNCTION CODE GENERATORS
    // ========================================
    // ========================================
    // NEW SECTION CODE GENERATORS
    // ========================================

    // CATCH ERRORS SECTION
    SkriptGenerator.forBlock['skript_section_catch_errors'] = function(block) {
        var statements = SkriptGenerator.statementToCode(block, 'DO');
        return 'catch runtime errors:\n' + indentStatements(statements, 1);
    };

    // FILTER SECTION
    SkriptGenerator.forBlock['skript_section_filter'] = function(block) {
        var list = SkriptGenerator.valueToCode(block, 'LIST', SkriptGenerator.ORDER_ATOMIC) || '{}';
        var matchType = block.getFieldValue('MATCH_TYPE');
        var conditions = SkriptGenerator.statementToCode(block, 'CONDITIONS');

        return 'filter ' + list + ' to match ' + matchType + ':\n' + indentStatements(conditions, 1);
    };
    // ========================================
    // NEW STRUCTURE CODE GENERATORS
    // ========================================

    // OPTIONS STRUCTURE
    SkriptGenerator.forBlock['skript_structure_options'] = function(block) {
        var options = SkriptGenerator.statementToCode(block, 'OPTIONS');
        return 'options:\n' + indentStatements(options, 1);
    };

    // VARIABLES STRUCTURE
    SkriptGenerator.forBlock['skript_structure_variables'] = function(block) {
        var variables = SkriptGenerator.statementToCode(block, 'VARIABLES');
        return 'variables:\n' + indentStatements(variables, 1);
    };

    // ALIASES STRUCTURE
    SkriptGenerator.forBlock['skript_structure_aliases'] = function(block) {
        var aliases = SkriptGenerator.statementToCode(block, 'ALIASES');
        return 'aliases:\n' + indentStatements(aliases, 1);
    };

    // AUTO RELOAD STRUCTURE
    SkriptGenerator.forBlock['skript_structure_auto_reload'] = function(block) {
        var recipients = block.getFieldValue('RECIPIENTS_VALUE');
        var permission = block.getFieldValue('PERMISSION_VALUE');

        var code = 'auto reload:\n';

        if (recipients && recipients.trim() !== '') {
            code += '    recipients: ' + recipients + '\n';
        }

        if (permission && permission.trim() !== '') {
            code += '    permission: ' + permission + '\n';
        }

        return code;
    };

    // EXPERIMENTAL FEATURE STRUCTURE
    SkriptGenerator.forBlock['skript_structure_experimental'] = function(block) {
        var feature = block.getFieldValue('FEATURE');
        return 'using experimental feature ' + feature;
    };

    // ENHANCED COMMAND STRUCTURE
    SkriptGenerator.forBlock['skript_structure_command_enhanced'] = function(block) {
        var cmd = block.getFieldValue('CMD');
        var usage = block.getFieldValue('USAGE_VALUE');
        var description = block.getFieldValue('DESCRIPTION_VALUE');
        var permission = block.getFieldValue('PERM_VALUE');
        var permMessage = block.getFieldValue('PERM_MESSAGE_VALUE');
        var aliases = block.getFieldValue('ALIASES_VALUE');
        var executableBy = block.getFieldValue('EXECUTABLE_BY_VALUE');
        var cooldown = block.getFieldValue('COOLDOWN_VALUE');
        var cooldownMessage = block.getFieldValue('COOLDOWN_MESSAGE_VALUE');
        var statements = SkriptGenerator.statementToCode(block, 'DO');

        var code = 'command /' + cmd + ':\n';

        if (usage && usage.trim() !== '') {
            code += '    usage: ' + usage + '\n';
        }
        if (description && description.trim() !== '') {
            code += '    description: ' + description + '\n';
        }
        if (permission && permission.trim() !== '') {
            code += '    permission: ' + permission + '\n';
        }
        if (permMessage && permMessage.trim() !== '') {
            code += '    permission message: ' + permMessage + '\n';
        }
        if (aliases && aliases.trim() !== '') {
            code += '    aliases: ' + aliases + '\n';
        }
        if (executableBy && executableBy.trim() !== '') {
            code += '    executable by: ' + executableBy + '\n';
        }
        if (cooldown && cooldown.trim() !== '') {
            code += '    cooldown: ' + cooldown + '\n';
        }
        if (cooldownMessage && cooldownMessage.trim() !== '') {
            code += '    cooldown message: ' + cooldownMessage + '\n';
        }

        code += '    trigger:\n' + indentStatements(statements, 2);

        return code;
    };

    // ENHANCED EVENT STRUCTURE
    SkriptGenerator.forBlock['skript_structure_event_enhanced'] = function(block) {
        var eventState = block.getFieldValue('EVENT_STATE');
        var eventType = block.getFieldValue('EVENT_TYPE');
        var priority = block.getFieldValue('PRIORITY');
        var statements = SkriptGenerator.statementToCode(block, 'DO');

        var code = 'on ' + eventState + ' ' + eventType;

        if (priority !== 'normal') {
            code += ' with priority ' + priority;
        }

        code += ':\n' + indentStatements(statements, 1);

        return code;
    };

    // ENHANCED FUNCTION STRUCTURE
    SkriptGenerator.forBlock['skript_structure_function_enhanced'] = function(block) {
        var scope = block.getFieldValue('SCOPE');
        var name = block.getFieldValue('NAME');
        var returnType = block.getFieldValue('RETURN');
        var statements = SkriptGenerator.statementToCode(block, 'DO');

        // Build argument string from dynamic arguments
        var args = [];
        for (var i = 0; i < block.argCount_; i++) {
            var argName = block.getFieldValue('ARG_NAME_' + i);
            var argType = block.getFieldValue('ARG_TYPE_' + i);
            if (argName && argType) {
                args.push(argName + ': ' + argType);
            }
        }
        var argString = args.join(', ');

        var code = scope + ' ' + name + '(' + argString + ')';

        if (returnType && returnType !== 'none') {
            code += ' :: ' + returnType;
        }

        code += ':\n' + indentStatements(statements, 1);

        return code;
    };
    // FOR EACH LOOP SECTION
    SkriptGenerator.forBlock['skript_section_foreach'] = function(block) {
        var loopType = block.getFieldValue('LOOP_TYPE');
        var variable = SkriptGenerator.valueToCode(block, 'VARIABLE', SkriptGenerator.ORDER_ATOMIC) || 'item';
        var list = SkriptGenerator.valueToCode(block, 'LIST', SkriptGenerator.ORDER_ATOMIC) || '{}';
        var statements = SkriptGenerator.statementToCode(block, 'DO');

        var code = '';
        switch(loopType) {
            case 'value':
                code = 'for each value ' + variable + ' in ' + list + ':\n';
                break;
            case 'key':
                code = 'for each key ' + variable + ' in ' + list + ':\n';
                break;
            case 'key_value':
                var parts = variable.split(',');
                if (parts.length === 2) {
                    code = 'for each key ' + parts[0].trim() + ' and value ' + parts[1].trim() + ' in ' + list + ':\n';
                } else {
                    code = 'for each value ' + variable + ' in ' + list + ':\n';
                }
                break;
        }

        return code + indentStatements(statements, 1);
    };

    // WHILE LOOP SECTION
    SkriptGenerator.forBlock['skript_section_while'] = function(block) {
        var condition = SkriptGenerator.valueToCode(block, 'CONDITION', SkriptGenerator.ORDER_ATOMIC) || 'true';
        var statements = SkriptGenerator.statementToCode(block, 'DO');
        return 'while ' + condition + ':\n' + indentStatements(statements, 1);
    };

    // DO WHILE LOOP SECTION
    SkriptGenerator.forBlock['skript_section_dowhile'] = function(block) {
        var condition = SkriptGenerator.valueToCode(block, 'CONDITION', SkriptGenerator.ORDER_ATOMIC) || 'true';
        var statements = SkriptGenerator.statementToCode(block, 'DO');
        return 'do:\n' + indentStatements(statements, 1) + 'while ' + condition;
    };

    // SPAWN SECTION
    SkriptGenerator.forBlock['skript_section_spawn'] = function(block) {
        var entityType = SkriptGenerator.valueToCode(block, 'ENTITY_TYPE', SkriptGenerator.ORDER_ATOMIC) || 'zombie';
        var amount = SkriptGenerator.valueToCode(block, 'AMOUNT', SkriptGenerator.ORDER_ATOMIC) || '1';
        var location = SkriptGenerator.valueToCode(block, 'LOCATION', SkriptGenerator.ORDER_ATOMIC) || 'player';
        var statements = SkriptGenerator.statementToCode(block, 'DO');

        return 'spawn ' + amount + ' of ' + entityType + ' at ' + location + ':\n' + indentStatements(statements, 1);
    };

    // SHOOT SECTION
    SkriptGenerator.forBlock['skript_section_shoot'] = function(block) {
        var projectile = SkriptGenerator.valueToCode(block, 'PROJECTILE', SkriptGenerator.ORDER_ATOMIC) || 'arrow';
        var from = SkriptGenerator.valueToCode(block, 'FROM', SkriptGenerator.ORDER_ATOMIC) || 'player';
        var speed = SkriptGenerator.valueToCode(block, 'SPEED', SkriptGenerator.ORDER_ATOMIC) || '1';
        var direction = SkriptGenerator.valueToCode(block, 'DIRECTION', SkriptGenerator.ORDER_ATOMIC) || 'player\'s direction';
        var statements = SkriptGenerator.statementToCode(block, 'DO');

        return 'shoot ' + projectile + ' from ' + from + ' with speed ' + speed + ' ' + direction + ':\n' + indentStatements(statements, 1);
    };

    // CONDITIONAL PARSE SECTION
    SkriptGenerator.forBlock['skript_section_parse_if'] = function(block) {
        var condition = SkriptGenerator.valueToCode(block, 'CONDITION', SkriptGenerator.ORDER_ATOMIC) || 'true';
        var statements = SkriptGenerator.statementToCode(block, 'THEN');
        return 'parse if ' + condition + ':\n' + indentStatements(statements, 1);
    };

    // ELSE PARSE IF SECTION
    SkriptGenerator.forBlock['skript_section_else_parse_if'] = function(block) {
        var condition = SkriptGenerator.valueToCode(block, 'CONDITION', SkriptGenerator.ORDER_ATOMIC) || 'true';
        var statements = SkriptGenerator.statementToCode(block, 'THEN');
        return 'else parse if ' + condition + ':\n' + indentStatements(statements, 1);
    };
    // Math Functions
    SkriptGenerator.forBlock['skript_function_abs'] = function(block) {
        var number = SkriptGenerator.valueToCode(block, 'NUMBER', SkriptGenerator.ORDER_ATOMIC) || '0';
        return ['abs(' + number + ')', SkriptGenerator.ORDER_ATOMIC];
    };

    SkriptGenerator.forBlock['skript_function_ceil'] = function(block) {
        var number = SkriptGenerator.valueToCode(block, 'NUMBER', SkriptGenerator.ORDER_ATOMIC) || '0';
        return ['ceil(' + number + ')', SkriptGenerator.ORDER_ATOMIC];
    };

    SkriptGenerator.forBlock['skript_function_floor'] = function(block) {
        var number = SkriptGenerator.valueToCode(block, 'NUMBER', SkriptGenerator.ORDER_ATOMIC) || '0';
        return ['floor(' + number + ')', SkriptGenerator.ORDER_ATOMIC];
    };

    SkriptGenerator.forBlock['skript_function_round'] = function(block) {
        var number = SkriptGenerator.valueToCode(block, 'NUMBER', SkriptGenerator.ORDER_ATOMIC) || '0';
        var decimals = SkriptGenerator.valueToCode(block, 'DECIMALS', SkriptGenerator.ORDER_ATOMIC) || '0';
        return ['round(' + number + ', ' + decimals + ')', SkriptGenerator.ORDER_ATOMIC];
    };

    SkriptGenerator.forBlock['skript_function_sqrt'] = function(block) {
        var number = SkriptGenerator.valueToCode(block, 'NUMBER', SkriptGenerator.ORDER_ATOMIC) || '0';
        return ['sqrt(' + number + ')', SkriptGenerator.ORDER_ATOMIC];
    };

    SkriptGenerator.forBlock['skript_function_sin'] = function(block) {
        var angle = SkriptGenerator.valueToCode(block, 'ANGLE', SkriptGenerator.ORDER_ATOMIC) || '0';
        return ['sin(' + angle + ')', SkriptGenerator.ORDER_ATOMIC];
    };

    SkriptGenerator.forBlock['skript_function_cos'] = function(block) {
        var angle = SkriptGenerator.valueToCode(block, 'ANGLE', SkriptGenerator.ORDER_ATOMIC) || '0';
        return ['cos(' + angle + ')', SkriptGenerator.ORDER_ATOMIC];
    };

    SkriptGenerator.forBlock['skript_function_tan'] = function(block) {
        var angle = SkriptGenerator.valueToCode(block, 'ANGLE', SkriptGenerator.ORDER_ATOMIC) || '0';
        return ['tan(' + angle + ')', SkriptGenerator.ORDER_ATOMIC];
    };

    SkriptGenerator.forBlock['skript_function_min'] = function(block) {
        var numbers = SkriptGenerator.valueToCode(block, 'NUMBERS', SkriptGenerator.ORDER_ATOMIC) || '0';
        return ['min(' + numbers + ')', SkriptGenerator.ORDER_ATOMIC];
    };

    SkriptGenerator.forBlock['skript_function_max'] = function(block) {
        var numbers = SkriptGenerator.valueToCode(block, 'NUMBERS', SkriptGenerator.ORDER_ATOMIC) || '0';
        return ['max(' + numbers + ')', SkriptGenerator.ORDER_ATOMIC];
    };

    SkriptGenerator.forBlock['skript_function_sum'] = function(block) {
        var numbers = SkriptGenerator.valueToCode(block, 'NUMBERS', SkriptGenerator.ORDER_ATOMIC) || '0';
        return ['sum(' + numbers + ')', SkriptGenerator.ORDER_ATOMIC];
    };

    SkriptGenerator.forBlock['skript_function_mod'] = function(block) {
        var dividend = SkriptGenerator.valueToCode(block, 'DIVIDEND', SkriptGenerator.ORDER_ATOMIC) || '0';
        var divisor = SkriptGenerator.valueToCode(block, 'DIVISOR', SkriptGenerator.ORDER_ATOMIC) || '1';
        return ['mod(' + dividend + ', ' + divisor + ')', SkriptGenerator.ORDER_ATOMIC];
    };

    // Utility Functions
    SkriptGenerator.forBlock['skript_function_location'] = function(block) {
        var x = SkriptGenerator.valueToCode(block, 'X', SkriptGenerator.ORDER_ATOMIC) || '0';
        var y = SkriptGenerator.valueToCode(block, 'Y', SkriptGenerator.ORDER_ATOMIC) || '0';
        var z = SkriptGenerator.valueToCode(block, 'Z', SkriptGenerator.ORDER_ATOMIC) || '0';
        var world = SkriptGenerator.valueToCode(block, 'WORLD', SkriptGenerator.ORDER_ATOMIC) || 'world';
        return ['location(' + x + ', ' + y + ', ' + z + ', ' + world + ')', SkriptGenerator.ORDER_ATOMIC];
    };

    SkriptGenerator.forBlock['skript_function_vector'] = function(block) {
        var x = SkriptGenerator.valueToCode(block, 'X', SkriptGenerator.ORDER_ATOMIC) || '0';
        var y = SkriptGenerator.valueToCode(block, 'Y', SkriptGenerator.ORDER_ATOMIC) || '0';
        var z = SkriptGenerator.valueToCode(block, 'Z', SkriptGenerator.ORDER_ATOMIC) || '0';
        return ['vector(' + x + ', ' + y + ', ' + z + ')', SkriptGenerator.ORDER_ATOMIC];
    };

    SkriptGenerator.forBlock['skript_function_world'] = function(block) {
        var name = SkriptGenerator.valueToCode(block, 'NAME', SkriptGenerator.ORDER_ATOMIC) || 'world';
        return ['world(' + name + ')', SkriptGenerator.ORDER_ATOMIC];
    };

    SkriptGenerator.forBlock['skript_function_player'] = function(block) {
        var nameOrUuid = SkriptGenerator.valueToCode(block, 'NAME_OR_UUID', SkriptGenerator.ORDER_ATOMIC) || 'player';
        var exact = block.getFieldValue('EXACT') === 'TRUE';
        return ['player(' + nameOrUuid + ', ' + exact + ')', SkriptGenerator.ORDER_ATOMIC];
    };

    SkriptGenerator.forBlock['skript_function_offlineplayer'] = function(block) {
        var nameOrUuid = SkriptGenerator.valueToCode(block, 'NAME_OR_UUID', SkriptGenerator.ORDER_ATOMIC) || 'player';
        var lookups = block.getFieldValue('LOOKUPS') === 'TRUE';
        return ['offlineplayer(' + nameOrUuid + ', ' + lookups + ')', SkriptGenerator.ORDER_ATOMIC];
    };

    SkriptGenerator.forBlock['skript_function_uuid'] = function(block) {
        var uuidString = SkriptGenerator.valueToCode(block, 'UUID_STRING', SkriptGenerator.ORDER_ATOMIC) || '""';
        return ['uuid(' + uuidString + ')', SkriptGenerator.ORDER_ATOMIC];
    };

    SkriptGenerator.forBlock['skript_function_rgb'] = function(block) {
        var red = SkriptGenerator.valueToCode(block, 'RED', SkriptGenerator.ORDER_ATOMIC) || '255';
        var green = SkriptGenerator.valueToCode(block, 'GREEN', SkriptGenerator.ORDER_ATOMIC) || '255';
        var blue = SkriptGenerator.valueToCode(block, 'BLUE', SkriptGenerator.ORDER_ATOMIC) || '255';
        var alpha = SkriptGenerator.valueToCode(block, 'ALPHA', SkriptGenerator.ORDER_ATOMIC) || '255';
        return ['rgb(' + red + ', ' + green + ', ' + blue + ', ' + alpha + ')', SkriptGenerator.ORDER_ATOMIC];
    };

    // Advanced Math Functions
    SkriptGenerator.forBlock['skript_function_factorial'] = function(block) {
        var number = SkriptGenerator.valueToCode(block, 'NUMBER', SkriptGenerator.ORDER_ATOMIC) || '0';
        return ['factorial(' + number + ')', SkriptGenerator.ORDER_ATOMIC];
    };

    SkriptGenerator.forBlock['skript_function_mean'] = function(block) {
        var numbers = SkriptGenerator.valueToCode(block, 'NUMBERS', SkriptGenerator.ORDER_ATOMIC) || '0';
        return ['mean(' + numbers + ')', SkriptGenerator.ORDER_ATOMIC];
    };

    SkriptGenerator.forBlock['skript_function_median'] = function(block) {
        var numbers = SkriptGenerator.valueToCode(block, 'NUMBERS', SkriptGenerator.ORDER_ATOMIC) || '0';
        return ['median(' + numbers + ')', SkriptGenerator.ORDER_ATOMIC];
    };

    SkriptGenerator.forBlock['skript_function_clamp'] = function(block) {
        var value = SkriptGenerator.valueToCode(block, 'VALUE', SkriptGenerator.ORDER_ATOMIC) || '0';
        var min = SkriptGenerator.valueToCode(block, 'MIN', SkriptGenerator.ORDER_ATOMIC) || '0';
        var max = SkriptGenerator.valueToCode(block, 'MAX', SkriptGenerator.ORDER_ATOMIC) || '100';
        return ['clamp(' + value + ', ' + min + ', ' + max + ')', SkriptGenerator.ORDER_ATOMIC];
    };
    SkriptGenerator.forBlock['skript_on_rightclick'] = function(block) {
        var statements = SkriptGenerator.statementToCode(block, 'DO');
        return 'on right click:\n' + indentStatements(statements, 1);
    };

    SkriptGenerator.forBlock['skript_on_break'] = function(block) {
        var statements = SkriptGenerator.statementToCode(block, 'DO');
        return 'on break:\n' + indentStatements(statements, 1);
    };

    SkriptGenerator.forBlock['skript_on_death'] = function(block) {
        var statements = SkriptGenerator.statementToCode(block, 'DO');
        return 'on death:\n' + indentStatements(statements, 1);
    };

    SkriptGenerator.forBlock['skript_on_chat'] = function(block) {
        var statements = SkriptGenerator.statementToCode(block, 'DO');
        return 'on chat:\n' + indentStatements(statements, 1);
    };

    SkriptGenerator.forBlock['skript_on_inv_click'] = function(block) {
        var statements = SkriptGenerator.statementToCode(block, 'DO');
        return 'on inventory click:\n' + indentStatements(statements, 1);
    };

    SkriptGenerator.forBlock['skript_every_second'] = function(block) {
        var statements = SkriptGenerator.statementToCode(block, 'DO');
        return 'every second:\n' + indentStatements(statements, 1);
    };

    SkriptGenerator.forBlock['skript_on_time'] = function(block) {
        var time = block.getFieldValue('TIME');
        var world = block.getFieldValue('WORLD');
        var statements = SkriptGenerator.statementToCode(block, 'DO');

        var code = 'at ' + time;
        if (world && world.trim() !== '') {
            code += ' in "' + world + '"';
        }
        code += ':\n' + indentStatements(statements, 1);
        return code;
    };

    SkriptGenerator.forBlock['skript_periodical'] = function(block) {
        var time = block.getFieldValue('TIME');
        var statements = SkriptGenerator.statementToCode(block, 'DO');
        return 'every ' + time + ':\n' + indentStatements(statements, 1);
    };

    SkriptGenerator.forBlock['skript_periodical_world'] = function(block) {
        var time = block.getFieldValue('TIME');
        var world = block.getFieldValue('WORLD');
        var statements = SkriptGenerator.statementToCode(block, 'DO');
        return 'every ' + time + ' in world "' + world + '":\n' + indentStatements(statements, 1);
    };

    // Add generator for uncommon events block
    SkriptGenerator.forBlock['skript_uncommon_events'] = function(block) {
        var eventType = block.getFieldValue('EVENT_TYPE');
        var statements = SkriptGenerator.statementToCode(block, 'DO');
        return 'on ' + eventType + ':\n' + indentStatements(statements, 1);
    };

    // COMMAND GENERATOR WITH DYNAMIC ARGUMENTS
    SkriptGenerator.forBlock['skript_on_command'] = function(block) {
        var cmd = block.getFieldValue('CMD');
        var perm = block.getFieldValue('PERM');
        var statements = SkriptGenerator.statementToCode(block, 'DO');

        // Build argument string from dynamic arguments
        var args = [];
        for (var i = 0; i < block.argCount_; i++) {
            var argType = block.getFieldValue('ARG_TYPE_' + i);
            if (argType && argType.trim() !== '') {
                args.push(argType);
            }
        }
        var argString = args.join(' ');

        var code = 'command /' + cmd;
        if (argString.trim() !== '') {
            code += ' ' + argString;
        }
        code += ':';

        if (perm && perm.trim() !== '') {
            code += '\n    permission: ' + perm;
        }

        code += '\n    trigger:\n' + indentStatements(statements, 2);

        return code;
    };

    // ARGUMENT USAGE BLOCKS
    SkriptGenerator.forBlock['skript_if_arg'] = function(block) {
        if (!isBlockInsideEventOrFunction(block)) return '';
        var argIndex = block.getFieldValue('ARG_INDEX');
        var value = SkriptGenerator.valueToCode(block, 'VALUE', SkriptGenerator.ORDER_ATOMIC) || '""';
        var thenStatements = SkriptGenerator.statementToCode(block, 'THEN');
        var nextStatements = SkriptGenerator.statementToCode(block, 'NEXT');

        return 'if arg-' + argIndex + ' is ' + value + ':\n' +
            indentStatements(thenStatements, 1) +
            (nextStatements ? '\n' + nextStatements : '');
    };

    // SPECIFIC ARGUMENT BLOCKS
    SkriptGenerator.forBlock['skript_get_arg_1'] = function(block) {
        return ['arg-1', SkriptGenerator.ORDER_ATOMIC];
    };

    SkriptGenerator.forBlock['skript_get_arg_2'] = function(block) {
        return ['arg-2', SkriptGenerator.ORDER_ATOMIC];
    };

    SkriptGenerator.forBlock['skript_get_arg_3'] = function(block) {
        return ['arg-3', SkriptGenerator.ORDER_ATOMIC];
    };

    SkriptGenerator.forBlock['skript_get_arg_custom'] = function(block) {
        var argIndex = block.getFieldValue('ARG_INDEX');
        return ['arg-' + argIndex, SkriptGenerator.ORDER_ATOMIC];
    };


    // ========================================
    // EFFECT CODE GENERATORS
    // ========================================

    // Common effect generators
    SkriptGenerator.forBlock['skript_send_actionbar'] = function(block) {
        if (!isBlockInsideEventOrFunction(block)) return '';
        var text = SkriptGenerator.valueToCode(block, 'TEXT', SkriptGenerator.ORDER_ATOMIC) || '""';
        var players = SkriptGenerator.valueToCode(block, 'PLAYERS', SkriptGenerator.ORDER_ATOMIC) || 'player';
        return 'send actionbar ' + text + ' to ' + players;
    };

    SkriptGenerator.forBlock['skript_send_message'] = function(block) {
        if (!isBlockInsideEventOrFunction(block)) return '';
        var message = SkriptGenerator.valueToCode(block, 'MESSAGE', SkriptGenerator.ORDER_ATOMIC) || '""';
        var players = SkriptGenerator.valueToCode(block, 'PLAYERS', SkriptGenerator.ORDER_ATOMIC) || 'player';
        return 'send ' + message + ' to ' + players;
    };

    SkriptGenerator.forBlock['skript_play_sound'] = function(block) {
        if (!isBlockInsideEventOrFunction(block)) return '';
        var sound = SkriptGenerator.valueToCode(block, 'SOUND', SkriptGenerator.ORDER_ATOMIC) || '"entity.experience_orb.pickup"';
        var location = SkriptGenerator.valueToCode(block, 'LOCATION', SkriptGenerator.ORDER_ATOMIC) || 'player';
        var players = SkriptGenerator.valueToCode(block, 'PLAYERS', SkriptGenerator.ORDER_ATOMIC) || 'player';
        return 'play sound ' + sound + ' at ' + location + ' to ' + players;
    };
    // ========================================
    // EFFECT CODE GENERATORS - ADD THESE
    // ========================================

    // Send message generator
    SkriptGenerator.forBlock['skript_send_message'] = function(block) {
        if (!isBlockInsideEventOrFunction(block)) return '';
        var message = SkriptGenerator.valueToCode(block, 'MESSAGE', SkriptGenerator.ORDER_ATOMIC) || '""';
        var players = SkriptGenerator.valueToCode(block, 'PLAYERS', SkriptGenerator.ORDER_ATOMIC) || 'player';
        return 'send ' + message + ' to ' + players;
    };

    // Broadcast generator
    SkriptGenerator.forBlock['skript_broadcast'] = function(block) {
        if (!isBlockInsideEventOrFunction(block)) return '';
        var message = SkriptGenerator.valueToCode(block, 'MESSAGE', SkriptGenerator.ORDER_ATOMIC) || '""';
        return 'broadcast ' + message;
    };

    // Teleport generator
    SkriptGenerator.forBlock['skript_teleport'] = function(block) {
        if (!isBlockInsideEventOrFunction(block)) return '';
        var entity = SkriptGenerator.valueToCode(block, 'ENTITY', SkriptGenerator.ORDER_ATOMIC) || 'player';
        var location = SkriptGenerator.valueToCode(block, 'LOCATION', SkriptGenerator.ORDER_ATOMIC) || 'location';
        return 'teleport ' + entity + ' to ' + location;
    };

    // Kill generator
    SkriptGenerator.forBlock['skript_kill'] = function(block) {
        if (!isBlockInsideEventOrFunction(block)) return '';
        var entity = SkriptGenerator.valueToCode(block, 'ENTITY', SkriptGenerator.ORDER_ATOMIC) || 'entity';
        return 'kill ' + entity;
    };

    // Give generator
    SkriptGenerator.forBlock['skript_give'] = function(block) {
        if (!isBlockInsideEventOrFunction(block)) return '';
        var item = SkriptGenerator.valueToCode(block, 'ITEM', SkriptGenerator.ORDER_ATOMIC) || '"diamond"';
        var player = SkriptGenerator.valueToCode(block, 'PLAYER', SkriptGenerator.ORDER_ATOMIC) || 'player';
        return 'give ' + item + ' to ' + player;
    };

    // Set variable generator
    SkriptGenerator.forBlock['skript_set_variable'] = function(block) {
        if (!isBlockInsideEventOrFunction(block)) return '';
        var varName = block.getFieldValue('VAR');
        var value = SkriptGenerator.valueToCode(block, 'VALUE', SkriptGenerator.ORDER_ATOMIC) || '""';
        return 'set {' + varName + '} to ' + value;
    };

    // Cancel event generator
    SkriptGenerator.forBlock['skript_cancel_event'] = function(block) {
        if (!isBlockInsideEventOrFunction(block)) return '';
        return 'cancel event';
    };

    // Play sound generator
    SkriptGenerator.forBlock['skript_play_sound'] = function(block) {
        if (!isBlockInsideEventOrFunction(block)) return '';
        var sound = SkriptGenerator.valueToCode(block, 'SOUND', SkriptGenerator.ORDER_ATOMIC) || '"entity.experience_orb.pickup"';
        var location = SkriptGenerator.valueToCode(block, 'LOCATION', SkriptGenerator.ORDER_ATOMIC) || 'player';
        var players = SkriptGenerator.valueToCode(block, 'PLAYERS', SkriptGenerator.ORDER_ATOMIC) || 'player';
        return 'play sound ' + sound + ' at ' + location + ' to ' + players;
    };

    // Play effect generator
    SkriptGenerator.forBlock['skript_play_effect'] = function(block) {
        if (!isBlockInsideEventOrFunction(block)) return '';
        var effect = SkriptGenerator.valueToCode(block, 'EFFECT', SkriptGenerator.ORDER_ATOMIC) || '"flame"';
        var location = SkriptGenerator.valueToCode(block, 'LOCATION', SkriptGenerator.ORDER_ATOMIC) || 'player';
        var players = SkriptGenerator.valueToCode(block, 'PLAYERS', SkriptGenerator.ORDER_ATOMIC) || 'player';
        return 'play ' + effect + ' effect at ' + location + ' to ' + players;
    };

    // Send title generator
    SkriptGenerator.forBlock['skript_send_title'] = function(block) {
        if (!isBlockInsideEventOrFunction(block)) return '';
        var title = SkriptGenerator.valueToCode(block, 'TITLE', SkriptGenerator.ORDER_ATOMIC) || '""';
        var subtitle = SkriptGenerator.valueToCode(block, 'SUBTITLE', SkriptGenerator.ORDER_ATOMIC) || '""';
        var players = SkriptGenerator.valueToCode(block, 'PLAYERS', SkriptGenerator.ORDER_ATOMIC) || 'player';
        return 'send title ' + title + ' with subtitle ' + subtitle + ' to ' + players;
    };

    // Potion effect generator
    SkriptGenerator.forBlock['skript_potion_effect'] = function(block) {
        if (!isBlockInsideEventOrFunction(block)) return '';
        var effect = SkriptGenerator.valueToCode(block, 'EFFECT', SkriptGenerator.ORDER_ATOMIC) || '"speed"';
        var entity = SkriptGenerator.valueToCode(block, 'ENTITY', SkriptGenerator.ORDER_ATOMIC) || 'player';
        var duration = SkriptGenerator.valueToCode(block, 'DURATION', SkriptGenerator.ORDER_ATOMIC) || '30';
        return 'apply ' + effect + ' to ' + entity + ' for ' + duration + ' seconds';
    };

    // Damage generator
    SkriptGenerator.forBlock['skript_damage'] = function(block) {
        if (!isBlockInsideEventOrFunction(block)) return '';
        var entity = SkriptGenerator.valueToCode(block, 'ENTITY', SkriptGenerator.ORDER_ATOMIC) || 'player';
        var amount = SkriptGenerator.valueToCode(block, 'AMOUNT', SkriptGenerator.ORDER_ATOMIC) || '1';
        return 'damage ' + entity + ' by ' + amount + ' hearts';
    };

    // Heal generator
    SkriptGenerator.forBlock['skript_heal'] = function(block) {
        if (!isBlockInsideEventOrFunction(block)) return '';
        var entity = SkriptGenerator.valueToCode(block, 'ENTITY', SkriptGenerator.ORDER_ATOMIC) || 'player';
        var amount = SkriptGenerator.valueToCode(block, 'AMOUNT', SkriptGenerator.ORDER_ATOMIC) || '1';
        return 'heal ' + entity + ' by ' + amount + ' hearts';
    };

    // Wait generator
    SkriptGenerator.forBlock['skript_wait'] = function(block) {
        if (!isBlockInsideEventOrFunction(block)) return '';
        var time = SkriptGenerator.valueToCode(block, 'TIME', SkriptGenerator.ORDER_ATOMIC) || '1 second';
        return 'wait ' + time;
    };

    // Command generator
    SkriptGenerator.forBlock['skript_command'] = function(block) {
        if (!isBlockInsideEventOrFunction(block)) return '';
        var command = SkriptGenerator.valueToCode(block, 'COMMAND', SkriptGenerator.ORDER_ATOMIC) || '""';
        return 'execute console command "' + command + '"';
    };

    // Send actionbar generator
    SkriptGenerator.forBlock['skript_send_actionbar'] = function(block) {
        if (!isBlockInsideEventOrFunction(block)) return '';
        var text = SkriptGenerator.valueToCode(block, 'TEXT', SkriptGenerator.ORDER_ATOMIC) || '""';
        var players = SkriptGenerator.valueToCode(block, 'PLAYERS', SkriptGenerator.ORDER_ATOMIC) || 'player';
        return 'send actionbar ' + text + ' to ' + players;
    };
    // Give generator - ADD THIS
    SkriptGenerator.forBlock['skript_give'] = function(block) {
        if (!isBlockInsideEventOrFunction(block)) return '';
        var item = SkriptGenerator.valueToCode(block, 'ITEM', SkriptGenerator.ORDER_ATOMIC) || '"diamond"';
        var player = SkriptGenerator.valueToCode(block, 'PLAYER', SkriptGenerator.ORDER_ATOMIC) || 'player';
        return 'give ' + item + ' to ' + player;
    };

    // Uncommon effects generator
    SkriptGenerator.forBlock['skript_uncommon_effects'] = function(block) {
        if (!isBlockInsideEventOrFunction(block)) return '';
        var effectType = block.getFieldValue('EFFECT_TYPE');
        var code = '';

        switch(effectType) {
            // No input effects
            case "continue loop":
                return 'continue';
            case "exit trigger":
                return 'stop';
            case "enforce whitelist":
                return 'enforce whitelist';
            case "unenforce whitelist":
                return 'unenforce whitelist';
            case "stop server":
                return 'stop server';
            case "restart server":
                return 'restart server';
            case "reset title":
                return 'reset title';

            // Entity effects
            case "lock age of entity":
                var entity = SkriptGenerator.valueToCode(block, 'ENTITY', SkriptGenerator.ORDER_ATOMIC) || 'entity';
                return 'lock age of ' + entity;
            case "allow entity to age":
                var entity = SkriptGenerator.valueToCode(block, 'ENTITY', SkriptGenerator.ORDER_ATOMIC) || 'entity';
                return 'allow ' + entity + ' to age';
            case "charge creeper":
                var entity = SkriptGenerator.valueToCode(block, 'ENTITY', SkriptGenerator.ORDER_ATOMIC) || 'entity';
                return 'charge ' + entity;

            // Player effects
            case "hide player from server list":
                var player = SkriptGenerator.valueToCode(block, 'PLAYER', SkriptGenerator.ORDER_ATOMIC) || 'player';
                return 'hide ' + player + ' from server list';

            // Multiple input effects
            case "allow entity to duplicate":
                var entity = SkriptGenerator.valueToCode(block, 'ENTITY', SkriptGenerator.ORDER_ATOMIC) || 'entity';
                return 'allow ' + entity + ' to duplicate';
            case "apply bone meal":
                var block = SkriptGenerator.valueToCode(block, 'BLOCK', SkriptGenerator.ORDER_ATOMIC) || 'block';
                return 'apply bone meal to ' + block;
            case "connect player to server":
                var player = SkriptGenerator.valueToCode(block, 'PLAYER', SkriptGenerator.ORDER_ATOMIC) || 'player';
                var server = SkriptGenerator.valueToCode(block, 'SERVER', SkriptGenerator.ORDER_ATOMIC) || '"server"';
                return 'connect ' + player + ' to ' + server;
            case "spawn entity":
                var entityType = SkriptGenerator.valueToCode(block, 'ENTITY_TYPE', SkriptGenerator.ORDER_ATOMIC) || 'zombie';
                var location = SkriptGenerator.valueToCode(block, 'LOCATION', SkriptGenerator.ORDER_ATOMIC) || 'player';
                return 'spawn ' + entityType + ' at ' + location;
            case "force teleport":
                var entity = SkriptGenerator.valueToCode(block, 'ENTITY', SkriptGenerator.ORDER_ATOMIC) || 'entity';
                var location = SkriptGenerator.valueToCode(block, 'LOCATION', SkriptGenerator.ORDER_ATOMIC) || 'location';
                return 'force teleport ' + entity + ' to ' + location;

            // Default case
            default:
                // Generic fallback
                if (block.getInput('ENTITY')) {
                    var entity = SkriptGenerator.valueToCode(block, 'ENTITY', SkriptGenerator.ORDER_ATOMIC) || 'entity';
                    return effectType.replace('entity', entity);
                } else if (block.getInput('PLAYER')) {
                    var player = SkriptGenerator.valueToCode(block, 'PLAYER', SkriptGenerator.ORDER_ATOMIC) || 'player';
                    return effectType.replace('player', player);
                } else if (block.getInput('BLOCK')) {
                    var block = SkriptGenerator.valueToCode(block, 'BLOCK', SkriptGenerator.ORDER_ATOMIC) || 'block';
                    return effectType.replace('block', block);
                } else if (block.getInput('ITEM')) {
                    var item = SkriptGenerator.valueToCode(block, 'ITEM', SkriptGenerator.ORDER_ATOMIC) || 'item';
                    return effectType.replace('item', item);
                } else {
                    return effectType;
                }
        }
    };
    // ========================================
    // CONDITION CODE GENERATORS
    // ========================================
    // Original condition generators
    SkriptGenerator.forBlock['skript_if_permission'] = function(block) {
        if (!isBlockInsideEventOrFunction(block)) return '';
        var permission = SkriptGenerator.valueToCode(block, 'PERMISSION', SkriptGenerator.ORDER_ATOMIC) || '""';
        var thenStatements = SkriptGenerator.statementToCode(block, 'THEN');
        return 'if player has permission ' + permission + ':\n' + indentStatements(thenStatements, 1);
    };

    SkriptGenerator.forBlock['skript_if_else'] = function(block) {
        if (!isBlockInsideEventOrFunction(block)) return '';
        var condition = SkriptGenerator.valueToCode(block, 'CONDITION', SkriptGenerator.ORDER_ATOMIC) || 'true';
        var thenStatements = SkriptGenerator.statementToCode(block, 'THEN');
        var elseStatements = SkriptGenerator.statementToCode(block, 'ELSE');

        var code = 'if ' + condition + ':\n' + indentStatements(thenStatements, 1);
        if (elseStatements) {
            code += 'else:\n' + indentStatements(elseStatements, 1);
        }
        return code;
    };

    SkriptGenerator.forBlock['skript_if_variable_set'] = function(block) {
        if (!isBlockInsideEventOrFunction(block)) return '';
        var varName = block.getFieldValue('VAR');
        var thenStatements = SkriptGenerator.statementToCode(block, 'THEN');
        return 'if {' + varName + '} is not set:\n' + indentStatements(thenStatements, 1);
    };

    SkriptGenerator.forBlock['skript_if_inv_name'] = function(block) {
        if (!isBlockInsideEventOrFunction(block)) return '';
        var name = SkriptGenerator.valueToCode(block, 'NAME', SkriptGenerator.ORDER_ATOMIC) || '""';
        var thenStatements = SkriptGenerator.statementToCode(block, 'THEN');
        return 'if name of event-inventory is ' + name + ':\n' + indentStatements(thenStatements, 1);
    };

    SkriptGenerator.forBlock['skript_if_slot_clicked'] = function(block) {
        if (!isBlockInsideEventOrFunction(block)) return '';
        var slot = SkriptGenerator.valueToCode(block, 'SLOT', SkriptGenerator.ORDER_ATOMIC) || '0';
        var thenStatements = SkriptGenerator.statementToCode(block, 'THEN');
        return 'if event-slot is ' + slot + ':\n' + indentStatements(thenStatements, 1);
    };

    SkriptGenerator.forBlock['skript_if_click_action'] = function(block) {
        if (!isBlockInsideEventOrFunction(block)) return '';
        var action = block.getFieldValue('ACTION');
        return 'click action is ' + action;
    };
    // Common condition generators
    SkriptGenerator.forBlock['skript_has_permission'] = function(block) {
        var player = SkriptGenerator.valueToCode(block, 'PLAYER', SkriptGenerator.ORDER_ATOMIC) || 'player';
        var hasPerm = block.getFieldValue('HAS_PERM');
        var permission = SkriptGenerator.valueToCode(block, 'PERMISSION', SkriptGenerator.ORDER_ATOMIC) || '"example.permission"';

        if (hasPerm === 'has') {
            return [player + ' has permission ' + permission, SkriptGenerator.ORDER_ATOMIC];
        } else {
            return [player + ' does not have permission ' + permission, SkriptGenerator.ORDER_ATOMIC];
        }
    };

    SkriptGenerator.forBlock['skript_is_online'] = function(block) {
        var player = SkriptGenerator.valueToCode(block, 'PLAYER', SkriptGenerator.ORDER_ATOMIC) || 'player';
        var isOnline = block.getFieldValue('IS_ONLINE');

        if (isOnline === 'is') {
            return [player + ' is online', SkriptGenerator.ORDER_ATOMIC];
        } else {
            return [player + ' is not online', SkriptGenerator.ORDER_ATOMIC];
        }
    };

    SkriptGenerator.forBlock['skript_is_sneaking'] = function(block) {
        var player = SkriptGenerator.valueToCode(block, 'PLAYER', SkriptGenerator.ORDER_ATOMIC) || 'player';
        var isSneaking = block.getFieldValue('IS_SNEAKING');

        if (isSneaking === 'is') {
            return [player + ' is sneaking', SkriptGenerator.ORDER_ATOMIC];
        } else {
            return [player + ' is not sneaking', SkriptGenerator.ORDER_ATOMIC];
        }
    };

    // Add similar generators for other common conditions...

    SkriptGenerator.forBlock['skript_chance'] = function(block) {
        var chance = SkriptGenerator.valueToCode(block, 'CHANCE', SkriptGenerator.ORDER_ATOMIC) || '50';
        return ['chance of ' + chance + '%', SkriptGenerator.ORDER_ATOMIC];
    };
    // UNCOMMON VALUES BLOCK WITH DYNAMIC INPUTS
    Blockly.Blocks['skript_uncommon_values'] = {
        init: function() {
            this.setColour("#59C059");

            this.appendDummyInput()
                .appendField(new SearchableDropdown([
                    // Math expressions
                    ["difference", "difference"],
                    ["infinity", "infinity"],
                    ["nan", "nan"],
                    ["negative infinity", "negative infinity"],
                    ["percent of", "percent of"],
                    ["pi", "pi"],
                    ["round down", "round down"],
                    ["round", "round"],
                    ["round up", "round up"],

                    // String expressions
                    ["uppercase", "uppercase"],
                    ["lowercase", "lowercase"],
                    ["capitalize", "capitalize"],
                    ["colored text", "colored text"],
                    ["uncolored text", "uncolored text"],
                    ["hash", "hash"],
                    ["join", "join"],
                    ["split", "split"],
                    ["new line", "new line"],
                    ["random character", "random character"],
                    ["raw string", "raw string"],
                    ["repeat string", "repeat string"],
                    ["substring", "substring"],
                    ["characters between", "characters between"],

                    // List expressions
                    ["alphabetical sort", "alphabetical sort"],
                    ["first element", "first element"],
                    ["last element", "last element"],
                    ["random element", "random element"],
                    ["random", "random"],
                    ["reversed list", "reversed list"],
                    ["shuffled list", "shuffled list"],
                    ["sorted list", "sorted list"],

                    // Date/Time expressions
                    ["now", "now"],
                    ["formatted date", "formatted date"],
                    ["unix timestamp", "unix timestamp"],

                    // Other expressions
                    ["random uuid", "random uuid"],
                    ["parse error", "parse error"]
                ]), "VALUE_TYPE");

            this.setOutput(true, null);
            this.setTooltip("Select from various uncommon Skript values");

            // Initialize with no additional inputs
            this.updateShape_();

            // Update inputs when value type changes
            this.setOnChange(function(changeEvent) {
                if (changeEvent.type === Blockly.Events.BLOCK_CHANGE &&
                    changeEvent.element === 'field' &&
                    changeEvent.name === 'VALUE_TYPE') {
                    this.updateShape_();
                }
            }.bind(this));
        },

        updateShape_: function() {
            var valueType = this.getFieldValue('VALUE_TYPE');

            // Remove all inputs except the first one (VALUE_TYPE)
            while (this.inputList.length > 1) {
                this.removeInput(this.inputList[this.inputList.length - 1].name);
            }

            // Add appropriate inputs based on value type
            switch(valueType) {
                // String inputs
                case "uppercase":
                case "lowercase":
                case "capitalize":
                case "colored text":
                case "uncolored text":
                case "hash":
                case "raw string":
                    this.appendValueInput("TEXT")
                        .setCheck("String")
                        .appendField("text:");
                    break;

                case "repeat string":
                    this.appendValueInput("TEXT")
                        .setCheck("String")
                        .appendField("text:");
                    this.appendValueInput("TIMES")
                        .setCheck("Number")
                        .appendField("times:");
                    break;

                case "substring":
                    this.appendValueInput("TEXT")
                        .setCheck("String")
                        .appendField("text:");
                    this.appendValueInput("FROM")
                        .setCheck("Number")
                        .appendField("from:");
                    this.appendValueInput("TO")
                        .setCheck("Number")
                        .appendField("to:");
                    break;

                case "join":
                    this.appendValueInput("LIST")
                        .setCheck(null)
                        .appendField("list:");
                    this.appendValueInput("DELIMITER")
                        .setCheck("String")
                        .appendField("with:");
                    break;

                case "split":
                    this.appendValueInput("TEXT")
                        .setCheck("String")
                        .appendField("text:");
                    this.appendValueInput("DELIMITER")
                        .setCheck("String")
                        .appendField("at:");
                    break;

                // Number inputs
                case "difference":
                    this.appendValueInput("NUMBER1")
                        .setCheck("Number")
                        .appendField("between:");
                    this.appendValueInput("NUMBER2")
                        .setCheck("Number")
                        .appendField("and:");
                    break;

                case "percent of":
                    this.appendValueInput("PERCENT")
                        .setCheck("Number")
                        .appendField("percent:");
                    this.appendValueInput("NUMBER")
                        .setCheck("Number")
                        .appendField("of:");
                    break;

                case "round down":
                case "round":
                case "round up":
                    this.appendValueInput("NUMBER")
                        .setCheck("Number")
                        .appendField("number:");
                    break;

                // List inputs
                case "alphabetical sort":
                case "reversed list":
                case "shuffled list":
                case "sorted list":
                    this.appendValueInput("LIST")
                        .setCheck(null)
                        .appendField("list:");
                    break;

                case "first element":
                case "last element":
                case "random element":
                    this.appendValueInput("LIST")
                        .setCheck(null)
                        .appendField("of:");
                    break;

                case "random":
                    this.appendValueInput("LIST")
                        .setCheck(null)
                        .appendField("from:");
                    break;

                // Date inputs
                case "formatted date":
                    this.appendValueInput("DATE")
                        .setCheck(null)
                        .appendField("date:");
                    this.appendValueInput("FORMAT")
                        .setCheck("String")
                        .appendField("format:");
                    break;

                case "unix timestamp":
                    this.appendValueInput("DATE")
                        .setCheck(null)
                        .appendField("of:");
                    break;

                // Multiple inputs
                case "characters between":
                    this.appendValueInput("CHAR1")
                        .setCheck("String")
                        .appendField("from:");
                    this.appendValueInput("CHAR2")
                        .setCheck("String")
                        .appendField("to:");
                    break;

                // Default case for simple values (no inputs)
                default:
                    // For most values, no additional inputs needed
                    break;
            }

            // Update the block's appearance
            if (this.workspace) {
                this.workspace.resize();
            }
        },

        mutationToDom: function() {
            var container = document.createElement('mutation');
            container.setAttribute('value_type', this.getFieldValue('VALUE_TYPE'));
            return container;
        },

        domToMutation: function(xmlElement) {
            var valueType = xmlElement.getAttribute('value_type');
            if (valueType) {
                this.setFieldValue(valueType, 'VALUE_TYPE');
                this.updateShape_();
            }
        }
    };
    // SIMPLIFIED UNCOMMON CONDITIONS GENERATOR
    // UNCOMMON CONDITIONS GENERATOR
    SkriptGenerator.forBlock['skript_uncommon_conditions'] = function(block) {
        var conditionType = block.getFieldValue('CONDITION_TYPE');
        var code = '';

        switch(conditionType) {
            // No input conditions
            case "event is cancelled":
                return ['event is cancelled', SkriptGenerator.ORDER_ATOMIC];
            case "brewing will consume fuel":
                return ['brewing stand will consume fuel', SkriptGenerator.ORDER_ATOMIC];
            case "egg will hatch":
                return ['egg will hatch', SkriptGenerator.ORDER_ATOMIC];
            case "leash will drop":
                return ['leash will drop', SkriptGenerator.ORDER_ATOMIC];
            case "will consume boosting firework":
                return ['will consume boosting firework', SkriptGenerator.ORDER_ATOMIC];

            // Entity conditions
            case "entity can duplicate":
                var entity = SkriptGenerator.valueToCode(block, 'ENTITY', SkriptGenerator.ORDER_ATOMIC) || 'entity';
                return [entity + ' can duplicate', SkriptGenerator.ORDER_ATOMIC];
            case "entity is dashing":
                var entity = SkriptGenerator.valueToCode(block, 'ENTITY', SkriptGenerator.ORDER_ATOMIC) || 'entity';
                return [entity + ' is dashing', SkriptGenerator.ORDER_ATOMIC];
            // Add more entity conditions here...

            // Block conditions
            case "block is sedated":
                var block = SkriptGenerator.valueToCode(block, 'BLOCK', SkriptGenerator.ORDER_ATOMIC) || 'block';
                return [block + ' is sedated', SkriptGenerator.ORDER_ATOMIC];
            // Add more block conditions here...

            // Special dropdown conditions
            case "damage cause is":
                var cause = block.getFieldValue('DAMAGE_CAUSE');
                return ['damage cause is ' + cause, SkriptGenerator.ORDER_ATOMIC];
            case "weather is":
                var weather = block.getFieldValue('WEATHER_TYPE');
                return ['is ' + weather, SkriptGenerator.ORDER_ATOMIC];
            case "PvP is enabled":
                var world = SkriptGenerator.valueToCode(block, 'WORLD', SkriptGenerator.ORDER_ATOMIC) || 'world';
                return ['PvP is enabled in ' + world, SkriptGenerator.ORDER_ATOMIC];

            // Multiple input conditions
            case "player has permission":
                var player = SkriptGenerator.valueToCode(block, 'PLAYER', SkriptGenerator.ORDER_ATOMIC) || 'player';
                var permission = SkriptGenerator.valueToCode(block, 'PERMISSION', SkriptGenerator.ORDER_ATOMIC) || '""';
                return [player + ' has permission ' + permission, SkriptGenerator.ORDER_ATOMIC];
            case "entity is wearing":
                var entity = SkriptGenerator.valueToCode(block, 'ENTITY', SkriptGenerator.ORDER_ATOMIC) || 'entity';
                var item = SkriptGenerator.valueToCode(block, 'ITEM', SkriptGenerator.ORDER_ATOMIC) || 'item';
                return [entity + ' is wearing ' + item, SkriptGenerator.ORDER_ATOMIC];
            // Add more multiple input conditions here...

            // Default case for simple conditions
            default:
                // For conditions with single inputs, use a generic approach
                if (block.getInput('ENTITY')) {
                    var entity = SkriptGenerator.valueToCode(block, 'ENTITY', SkriptGenerator.ORDER_ATOMIC) || 'entity';
                    return [entity + ' ' + conditionType, SkriptGenerator.ORDER_ATOMIC];
                } else if (block.getInput('PLAYER')) {
                    var player = SkriptGenerator.valueToCode(block, 'PLAYER', SkriptGenerator.ORDER_ATOMIC) || 'player';
                    return [player + ' ' + conditionType, SkriptGenerator.ORDER_ATOMIC];
                } else if (block.getInput('BLOCK')) {
                    var block = SkriptGenerator.valueToCode(block, 'BLOCK', SkriptGenerator.ORDER_ATOMIC) || 'block';
                    return [block + ' ' + conditionType, SkriptGenerator.ORDER_ATOMIC];
                } else if (block.getInput('ITEM')) {
                    var item = SkriptGenerator.valueToCode(block, 'ITEM', SkriptGenerator.ORDER_ATOMIC) || 'item';
                    return [item + ' ' + conditionType, SkriptGenerator.ORDER_ATOMIC];
                } else if (block.getInput('TEXT')) {
                    var text = SkriptGenerator.valueToCode(block, 'TEXT', SkriptGenerator.ORDER_ATOMIC) || 'text';
                    return [text + ' ' + conditionType, SkriptGenerator.ORDER_ATOMIC];
                } else {
                    return [conditionType, SkriptGenerator.ORDER_ATOMIC];
                }
        }
    };
    // LOOP GENERATORS
    SkriptGenerator.forBlock['skript_loop_times'] = function(block) {
        if (!isBlockInsideEventOrFunction(block)) return '';
        var times = SkriptGenerator.valueToCode(block, 'TIMES', SkriptGenerator.ORDER_ATOMIC) || '10';
        var statements = SkriptGenerator.statementToCode(block, 'DO');
        var nextStatements = SkriptGenerator.statementToCode(block, 'NEXT');

        return 'loop ' + times + ' times:\n' +
            indentStatements(statements, 1) +
            (nextStatements ? '\n' + nextStatements : '');
    };

    SkriptGenerator.forBlock['skript_loop_players'] = function(block) {
        if (!isBlockInsideEventOrFunction(block)) return '';
        var statements = SkriptGenerator.statementToCode(block, 'DO');
        var nextStatements = SkriptGenerator.statementToCode(block, 'NEXT');

        return 'loop all players:\n' +
            indentStatements(statements, 1) +
            (nextStatements ? '\n' + nextStatements : '');
    };

    // OBJECTS GENERATORS
    SkriptGenerator.forBlock['skript_player'] = function(block) {
        return ['player', SkriptGenerator.ORDER_ATOMIC];
    };

    SkriptGenerator.forBlock['skript_event_player'] = function(block) {
        return ['event-player', SkriptGenerator.ORDER_ATOMIC];
    };

    SkriptGenerator.forBlock['skript_loop_player'] = function(block) {
        return ['loop-player', SkriptGenerator.ORDER_ATOMIC];
    };

    SkriptGenerator.forBlock['skript_clicked_slot'] = function(block) {
        return ['clicked slot', SkriptGenerator.ORDER_ATOMIC];
    };

    SkriptGenerator.forBlock['skript_item'] = function(block) {
        var item = block.getFieldValue('ITEM');
        return [item, SkriptGenerator.ORDER_ATOMIC];
    };

    SkriptGenerator.forBlock['skript_player_name'] = function(block) {
        return ['player\'s name', SkriptGenerator.ORDER_ATOMIC];
    };

    SkriptGenerator.forBlock['skript_player_uuid'] = function(block) {
        return ['player\'s uuid', SkriptGenerator.ORDER_ATOMIC];
    };

    SkriptGenerator.forBlock['skript_variable'] = function(block) {
        var varName = block.getFieldValue('VAR');
        return ['{' + varName + '}', SkriptGenerator.ORDER_ATOMIC];
    };

    SkriptGenerator.forBlock['skript_event_world'] = function(block) {
        return ['event-world', SkriptGenerator.ORDER_ATOMIC];
    };

    SkriptGenerator.forBlock['skript_event_entity'] = function(block) {
        return ['event-entity', SkriptGenerator.ORDER_ATOMIC];
    };

    SkriptGenerator.forBlock['skript_event_location'] = function(block) {
        return ['event-location', SkriptGenerator.ORDER_ATOMIC];
    };

    SkriptGenerator.forBlock['skript_event_block'] = function(block) {
        return ['event-block', SkriptGenerator.ORDER_ATOMIC];
    };

    SkriptGenerator.forBlock['skript_event_inventory'] = function(block) {
        return ['event-inventory', SkriptGenerator.ORDER_ATOMIC];
    };

    SkriptGenerator.forBlock['skript_event_item'] = function(block) {
        return ['event-item', SkriptGenerator.ORDER_ATOMIC];
    };

    // FUNCTION GENERATORS
    SkriptGenerator.forBlock['skript_function'] = function(block) {
        var name = block.getFieldValue('NAME');
        var returnType = block.getFieldValue('RETURN');
        var statements = SkriptGenerator.statementToCode(block, 'DO');

        // Build argument string from dynamic arguments
        var args = [];
        for (var i = 0; i < block.argCount_; i++) {
            var argName = block.getFieldValue('ARG_NAME_' + i);
            var argType = block.getFieldValue('ARG_TYPE_' + i);
            if (argName && argType) {
                args.push(argName + ': ' + argType);
            }
        }
        var argString = args.join(', ');

        var code = 'function ' + name + '(' + argString + ')';

        if (returnType && returnType !== 'none') {
            code += ' :: ' + returnType;
        }

        code += ':\n' + indentStatements(statements, 1);

        return code;
    };

    SkriptGenerator.forBlock['skript_return'] = function(block) {
        if (!isBlockInsideEventOrFunction(block)) return '';
        var value = SkriptGenerator.valueToCode(block, 'VALUE', SkriptGenerator.ORDER_ATOMIC) || '""';
        return 'return ' + value;
    };

    SkriptGenerator.forBlock['skript_call_function'] = function(block) {
        var name = block.getFieldValue('NAME');
        var arg = SkriptGenerator.valueToCode(block, 'ARG', SkriptGenerator.ORDER_ATOMIC) || '""';
        return [name + '(' + arg + ')', SkriptGenerator.ORDER_ATOMIC];
    };

    // VALUE GENERATORS
    SkriptGenerator.forBlock['skript_text'] = function(block) {
        var text = block.getFieldValue('TEXT');
        return ['"' + text + '"', SkriptGenerator.ORDER_ATOMIC];
    };

    SkriptGenerator.forBlock['skript_number'] = function(block) {
        var num = block.getFieldValue('NUM');
        return [num, SkriptGenerator.ORDER_ATOMIC];
    };

    // MATH GENERATORS
    SkriptGenerator.forBlock['skript_math_op'] = function(block) {
        var a = SkriptGenerator.valueToCode(block, 'A', SkriptGenerator.ORDER_ATOMIC) || '0';
        var b = SkriptGenerator.valueToCode(block, 'B', SkriptGenerator.ORDER_ATOMIC) || '0';
        var op = block.getFieldValue('OP');
        return [a + ' ' + op + ' ' + b, SkriptGenerator.ORDER_ATOMIC];
    };

    SkriptGenerator.forBlock['skript_compare'] = function(block) {
        var a = SkriptGenerator.valueToCode(block, 'A', SkriptGenerator.ORDER_ATOMIC) || '0';
        var b = SkriptGenerator.valueToCode(block, 'B', SkriptGenerator.ORDER_ATOMIC) || '0';
        var op = block.getFieldValue('OP');
        return [a + ' ' + op + ' ' + b, SkriptGenerator.ORDER_ATOMIC];
    };

    SkriptGenerator.forBlock['skript_string_concat'] = function(block) {
        var a = SkriptGenerator.valueToCode(block, 'A', SkriptGenerator.ORDER_ATOMIC) || '""';
        var b = SkriptGenerator.valueToCode(block, 'B', SkriptGenerator.ORDER_ATOMIC) || '""';
        return [a + ' + ' + b, SkriptGenerator.ORDER_ATOMIC];
    };

    SkriptGenerator.forBlock['skript_round_up'] = function(block) {
        var num = SkriptGenerator.valueToCode(block, 'NUM', SkriptGenerator.ORDER_ATOMIC) || '0';
        return ['rounded up (' + num + ')', SkriptGenerator.ORDER_ATOMIC];
    };

    // Backwards compatibility for old generator pattern
    for (var blockType in SkriptGenerator.forBlock) {
        SkriptGenerator[blockType] = SkriptGenerator.forBlock[blockType];
    }

    SkriptGenerator.blockToCode = function(block) {
        if (!block) return '';
        var func = this.forBlock[block.type];
        if (func) {
            var code = func.call(this, block);
            if (Array.isArray(code)) {
                return code;
            } else if (code !== null) {
                return code;
            }
        }
        return '';
    };

    SkriptGenerator.statementToCode = function(block, name) {
        var targetBlock = block.getInputTargetBlock(name);
        var code = '';
        while (targetBlock) {
            var nextBlock = targetBlock.getNextBlock();
            var blockCode = this.blockToCode(targetBlock);
            if (Array.isArray(blockCode)) {
                blockCode = blockCode[0];
            }
            code += blockCode + '\n';
            targetBlock = nextBlock;
        }
        return code;
    };

    SkriptGenerator.workspaceToCode = function(workspace) {
        if (!workspace) return '';
        var code = [];
        this.init(workspace);
        var blocks = workspace.getTopBlocks(true);

        // Only process top-level blocks (events and functions)
        for (var i = 0; i < blocks.length; i++) {
            var block = blocks[i];
            var type = block.type;
            if (type === 'skript_on_join' || type === 'skript_on_rightclick' ||
                type === 'skript_on_break' || type === 'skript_on_death' ||
                type === 'skript_on_chat' || type === 'skript_on_command' ||
                type === 'skript_on_inv_click' || type === 'skript_every_second' ||
                type === 'skript_function' || type === 'skript_on_time' ||
                type === 'skript_periodical' || type === 'skript_periodical_world' ||
                type === 'skript_uncommon_events') {
                var line = this.blockToCode(block);
                if (Array.isArray(line)) line = line[0];
                if (line) code.push(line);
            }
        }

        code = code.join('\n\n');
        return code.trim();
    };

    // ========================================
    // WORKSPACE INITIALIZATION
    // ========================================

    var blocklyArea = document.getElementById('blocklyArea');
    var toolbox = document.getElementById('toolbox');

    var workspace = Blockly.inject(blocklyArea, {
        toolbox: toolbox,
        collapse: true,
        comments: true,
        disable: true,
        maxBlocks: Infinity,
        trashcan: true,
        horizontalLayout: false,
        toolboxPosition: 'start',
        css: true,
        media: 'https://unpkg.com/blockly@10.4.3/media/',
        scrollbars: true,
        sounds: true,
        oneBasedIndex: true,
        zoom: {
            controls: true,
            wheel: true,
            startScale: 1.0,
            maxScale: 3,
            minScale: 0.3,
            scaleSpeed: 1.2
        },
        grid: {
            spacing: 20,
            length: 3,
            colour: '#ccc',
            snap: true
        }
    });

    function highlightSkriptCode(code) {
        if (!code || code.trim() === '') {
            return '# Your Skript code will appear here\n# Drag an EVENT or FUNCTION block from the left to get started!';
        }

        // Escape HTML zuerst, um den originalen Code zu bewahren
        code = code
            .replace(/&/g, '&amp;')
            .replace(/</g, '&lt;')
            .replace(/>/g, '&gt;');

        // Dann Syntax-Highlighting anwenden
        return code
            .replace(/(".*?")/g, '<span class="skript-string">$1</span>')
            .replace(/\b(\d+)\b/g, '<span class="skript-number">$1</span>')
            .replace(/(#.*$)/gm, '<span class="skript-comment">$1</span>')
            .replace(/(\{[^}]+\})/g, '<span class="skript-variable">$1</span>')
            .replace(/(command\s+\/[^\n]+)/g, '<span class="skript-command">$1</span>')
            .replace(/(permission:\s*[^\n]+)/g, '<span class="skript-command">$1</span>')
            .replace(/(trigger:)/g, '<span class="skript-command">$1</span>')
            .replace(/(function\s+[^\n]+)/g, '<span class="skript-function">$1</span>')
            .replace(/(on\s+[^\n]+)/g, '<span class="skript-event">$1</span>')
            .replace(/(every\s+[^\n]+)/g, '<span class="skript-event">$1</span>')
            .replace(/(arg-\d+)/g, '<span class="skript-variable">$1</span>')
            .replace(/(player|event-player|loop-player|clicked slot)/g, '<span class="skript-object">$1</span>')
            .replace(/(event-world|event-entity|event-location|event-block|event-inventory|event-item)/g, '<span class="skript-object">$1</span>');
    }

    function checkForFloatingBlocks() {
        var topBlocks = workspace.getTopBlocks(false);
        var hasFloatingBlocks = false;

        for (var i = 0; i < topBlocks.length; i++) {
            var block = topBlocks[i];
            var type = block.type;
            if (type !== 'skript_on_join' && type !== 'skript_on_rightclick' &&
                type !== 'skript_on_break' && type !== 'skript_on_death' &&
                type !== 'skript_on_chat' && type !== 'skript_on_command' &&
                type !== 'skript_on_inv_click' && type !== 'skript_every_second' &&
                type !== 'skript_function' && type !== 'skript_on_time' &&
                type !== 'skript_periodical' && type !== 'skript_periodical_world' &&
                type !== 'skript_uncommon_events') {
                hasFloatingBlocks = true;
                break;
            }
        }

        var warningArea = document.getElementById('warningArea');
        if (hasFloatingBlocks) {
            warningArea.innerHTML = '<div class="warning">âš ï¸ Some blocks are not inside an event or function! They will be ignored. Put action blocks inside an event (like "on player join") or function block.</div>';
        } else {
            warningArea.innerHTML = '';
        }
    }

    function updateCode() {
        var code = SkriptGenerator.workspaceToCode(workspace);
        var highlighted = highlightSkriptCode(code);
        document.getElementById('generatedCode').innerHTML = highlighted;

        var blockCount = workspace.getAllBlocks(false).length;
        var lineCount = code.split('\n').filter(line => line.trim() !== '').length;
        document.getElementById('blockCount').textContent = 'Blocks: ' + blockCount;
        document.getElementById('lineCount').textContent = 'Lines: ' + lineCount;

        checkForFloatingBlocks();

        // Save to localStorage
        var xml = Blockly.Xml.workspaceToDom(workspace);
        var xmlText = Blockly.Xml.domToText(xml);
        localStorage.setItem('skript-blocks', xmlText);
    }

    // Load from localStorage
    var savedXml = localStorage.getItem('skript-blocks');
    if (savedXml) {
        try {
            var xml = Blockly.utils.xml.textToDom(savedXml);
            workspace.clear();
            Blockly.Xml.domToWorkspace(xml, workspace);
        } catch (e) {
            console.error('Failed to load saved blocks:', e);
            localStorage.removeItem('skript-blocks');
        }
    }

    workspace.addChangeListener(updateCode);
    updateCode();

    document.getElementById('copyBtn').addEventListener('click', function() {
        var code = SkriptGenerator.workspaceToCode(workspace);
        if (!code || code.trim() === '') {
            alert('No code to copy! Add some event or function blocks first.');
            return;
        }
        navigator.clipboard.writeText(code).then(function() {
            var btn = document.getElementById('copyBtn');
            var originalText = btn.textContent;
            btn.textContent = 'âœ“ Copied!';
            btn.style.background = '#5cb85c';
            setTimeout(function() {
                btn.textContent = originalText;
                btn.style.background = '';
            }, 2000);
        });
    });

    document.getElementById('saveBtn').addEventListener('click', function() {
        var xml = Blockly.Xml.workspaceToDom(workspace);
        var xmlText = Blockly.Xml.domToText(xml);
        var blob = new Blob([xmlText], {type: 'text/xml'});
        var url = URL.createObjectURL(blob);
        var a = document.createElement('a');
        a.href = url;
        a.download = 'skript-blocks.xml';
        a.click();
        URL.revokeObjectURL(url);
    });

    document.getElementById('loadBtn').addEventListener('click', function() {
        document.getElementById('fileInput').click();
    });

    document.getElementById('fileInput').addEventListener('change', function(e) {
        var file = e.target.files[0];
        if (!file) return;

        var reader = new FileReader();
        reader.onload = function(e) {
            try {
                var xml = Blockly.utils.xml.textToDom(e.target.result);
                workspace.clear();
                Blockly.Xml.domToWorkspace(xml, workspace);
            } catch (err) {
                alert('Failed to load file: ' + err);
            }
        };
        reader.readAsText(file);
    });

    window.addEventListener('resize', function() {
        Blockly.svgResize(workspace);
    });
    // ========================================
    // NEW SYNTAX TYPE CODE GENERATORS
    // ========================================

    SkriptGenerator.forBlock['skript_attribute_type'] = function(block) {
        var attribute = block.getFieldValue('ATTRIBUTE_TYPE');
        return [attribute, SkriptGenerator.ORDER_ATOMIC];
    };

    SkriptGenerator.forBlock['skript_banner_pattern_type'] = function(block) {
        var pattern = block.getFieldValue('BANNER_PATTERN');
        return [pattern, SkriptGenerator.ORDER_ATOMIC];
    };

    SkriptGenerator.forBlock['skript_damage_cause'] = function(block) {
        var cause = block.getFieldValue('DAMAGE_CAUSE');
        return [cause, SkriptGenerator.ORDER_ATOMIC];
    };

    SkriptGenerator.forBlock['skript_enchantment_type'] = function(block) {
        var enchantment = block.getFieldValue('ENCHANTMENT');
        return [enchantment, SkriptGenerator.ORDER_ATOMIC];
    };

    SkriptGenerator.forBlock['skript_potion_effect_type'] = function(block) {
        var effect = block.getFieldValue('POTION_EFFECT');
        return [effect, SkriptGenerator.ORDER_ATOMIC];
    };

    SkriptGenerator.forBlock['skript_sound_category'] = function(block) {
        var category = block.getFieldValue('SOUND_CATEGORY');
        return [category, SkriptGenerator.ORDER_ATOMIC];
    };

    SkriptGenerator.forBlock['skript_entity_type'] = function(block) {
        var entityType = block.getFieldValue('ENTITY_TYPE');
        return [entityType, SkriptGenerator.ORDER_ATOMIC];
    };

    SkriptGenerator.forBlock['skript_visual_effect'] = function(block) {
        var effect = block.getFieldValue('VISUAL_EFFECT');
        return [effect, SkriptGenerator.ORDER_ATOMIC];
    };

    SkriptGenerator.forBlock['skript_firework_effect'] = function(block) {
        var fireworkType = block.getFieldValue('FIREWORK_TYPE');
        return [fireworkType, SkriptGenerator.ORDER_ATOMIC];
    };

    SkriptGenerator.forBlock['skript_inventory_type'] = function(block) {
        var inventoryType = block.getFieldValue('INVENTORY_TYPE');
        return [inventoryType, SkriptGenerator.ORDER_ATOMIC];
    };
</script>
</body>
</html>